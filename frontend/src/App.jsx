import { useEffect, useState, useMemo } from "react";
import { ConnectButton } from "@rainbow-me/rainbowkit";
import { useAccount } from "wagmi";
import { ethers } from "ethers";
import "./App.css";

const DEFAULTS = {
  coordinator: "0xd5D517aBE5cF79B7e95eC98dB0f0277788aFF634",
  keyHash: "0x00b81b5a830cb0a4009fbd8904de511e28631e62ce5ad231373d3cdad373ccab",
  subId: "99565515620834636304250522028617269923610402981851221983571694477234087866635",
  owner: "0x8Bf5941d27176242745B716251943Ae4892a3C26",
};
const DEFAULT_CONTRACTS = {
  v1: "",
  v2: "0xEB793fc0D366FE7C6d0407f181CF5F6b49CE59b1",
  v3: "0xEB793fc0D366FE7C6d0407f181CF5F6b49CE59b1",
};

// ABI from forge inspect (constructor + read/openBox subset).
const V1_ABI = [
  {
    type: "constructor",
    inputs: [
      { name: "vrfCoordinator", type: "address" },
      { name: "_subscriptionId", type: "uint256" },
      { name: "_keyHash", type: "bytes32" },
      { name: "_treasury", type: "address" },
      { name: "initialOwner", type: "address" },
    ],
  },
  { type: "function", name: "standardPrice", inputs: [], outputs: [{ type: "uint256" }], stateMutability: "view" },
  { type: "function", name: "gnarlyPrice", inputs: [], outputs: [{ type: "uint256" }], stateMutability: "view" },
  { type: "function", name: "epicPrice", inputs: [], outputs: [{ type: "uint256" }], stateMutability: "view" },
  { type: "function", name: "treasury", inputs: [], outputs: [{ type: "address" }], stateMutability: "view" },
  { type: "function", name: "paused", inputs: [], outputs: [{ type: "bool" }], stateMutability: "view" },
  { type: "function", name: "subscriptionId", inputs: [], outputs: [{ type: "uint256" }], stateMutability: "view" },
  { type: "function", name: "keyHash", inputs: [], outputs: [{ type: "bytes32" }], stateMutability: "view" },
  { type: "function", name: "s_vrfCoordinator", inputs: [], outputs: [{ type: "address" }], stateMutability: "view" },
  { type: "function", name: "openBox", inputs: [{ name: "boxType", type: "uint8" }], outputs: [{ type: "uint256" }], stateMutability: "payable" },
];

// Bytecode from forge build (same as deploy.html version).
const V1_BYTECODE =
  "0x608060405266470de4df820000600f5566b1a2bc2ec5000060105567016345785d8a000060115562061a8060155f6101000a81548163ffffffff021916908363ffffffff1602179055506003601560046101000a81548161ffff021916908361ffff1602179055506001601560066101000a81548163ffffffff021916908363ffffffff160217905550348015610094575f5ffd5b506040516141b93803806141b983398181016040528101906100b69190610658565b8433805f5f73ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff1603610128576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161011f90610729565b60405180910390fd5b815f5f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505f73ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff16146101aa576101a98161037e60201b60201c565b5b5050505f73ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1603610212576040517fd92e233d00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b8060025f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550505f600260146101000a81548160ff02191690831515021790555060016003819055505f73ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff16036102e3576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016102da90610791565b60405180910390fd5b3373ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff161461032657610325816104a960201b60201c565b5b83601381905550826014819055508160125f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550505050505061087f565b3373ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff16036103ec576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016103e3906107f9565b60405180910390fd5b8060015f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508073ffffffffffffffffffffffffffffffffffffffff165f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff167fed8889f560326eb138920d842192f0eb3dd22b4f139c87a2c57538e05bae127860405160405180910390a350565b6104b76104c960201b60201c565b6104c68161037e60201b60201c565b50565b5f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610557576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161054e90610861565b60405180910390fd5b565b5f5ffd5b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f6105868261055d565b9050919050565b6105968161057c565b81146105a0575f5ffd5b50565b5f815190506105b18161058d565b92915050565b5f819050919050565b6105c9816105b7565b81146105d3575f5ffd5b50565b5f815190506105e4816105c0565b92915050565b5f819050919050565b6105fc816105ea565b8114610606575f5ffd5b50565b5f81519050610617816105f3565b92915050565b5f6106278261055d565b9050919050565b6106378161061d565b8114610641575f5ffd5b50565b5f815190506106528161062e565b92915050565b5f5f5f5f5f60a0868803121561067157610670610559565b5b5f61067e888289016105a3565b955050602061068f888289016105d6565b94505060406106a088828901610609565b93505060606106b188828901610644565b92505060806106c2888289016105a3565b9150509295509295909350565b5f82825260208201905092915050565b7f43616e6e6f7420736574206f776e657220746f207a65726f00000000000000005f82015250565b5f6107136018836106cf565b915061071e826106df565b602082019050919050565b5f6020820190508181035f83015261074081610707565b9050919050565b7f6f776e65723d30000000000000000000000000000000000000000000000000005f82015250565b5f61077b6007836106cf565b915061078682610747565b602082019050919050565b5f6020820190508181035f8301526107a88161076f565b9050919050565b7f43616e6e6f74207472616e7366657220746f2073656c660000000000000000005f82015250565b5f6107e36017836106cf565b91506107ee826107af565b602082019050919050565b5f6020820190508181035f830152610810816107d7565b9050919050565b7f4f6e6c792063616c6c61626c65206279206f776e6572000000000000000000005f82015250565b5f61084b6016836106cf565b915061085682610817565b602082019050919050565b5f6020820190508181035f8301526108788161083f565b9050919050565b61392d8061088c5f395ff3fe60806040526004361061019f575f3560e01c80637ccfd7fc116100eb578063a88fe42d11610089578063d50b378111610063578063d50b378114610540578063e75bd5551461057e578063f0f44260146105a6578063f2fde38b146105ce576101a6565b8063a88fe42d146104c4578063b0fb162f146104ec578063d0f8e81614610516576101a6565b80638ea98117116100c55780638ea98117146104205780639e9db57d146104485780639eccacf614610472578063a1bfb3071461049c576101a6565b80637ccfd7fc146103b65780638456cb59146103e05780638da5cb5b146103f6576101a6565b80632c96732c1161015857806361728f391161013257806361728f391461032457806361d027b31461034e578063776118f91461037857806379ba5097146103a0576101a6565b80632c96732c146102a85780633f4ba83a146102e45780635c975abb146102fa576101a6565b806309c1ba2e146101aa5780631f1525e2146101d45780631fe543e3146101fe578063235069b41461022657806324f746971461024e57806329ec7f1414610278576101a6565b366101a657005b5f5ffd5b3480156101b5575f5ffd5b506101be6105f6565b6040516101cb919061267b565b60405180910390f35b3480156101df575f5ffd5b506101e86105fc565b6040516101f5919061267b565b60405180910390f35b348015610209575f5ffd5b50610224600480360381019061021f9190612727565b610602565b005b348015610231575f5ffd5b5061024c60048036038101906102479190612827565b6106c6565b005b348015610259575f5ffd5b50610262610739565b60405161026f919061289a565b60405180910390f35b610292600480360381019061028d91906128d6565b61074e565b60405161029f919061267b565b60405180910390f35b3480156102b3575f5ffd5b506102ce60048036038101906102c9919061295b565b610b98565b6040516102db91906129a0565b60405180910390f35b3480156102ef575f5ffd5b506102f8610bb5565b005b348015610305575f5ffd5b5061030e610bc7565b60405161031b91906129a0565b60405180910390f35b34801561032f575f5ffd5b50610338610bdd565b60405161034591906129c8565b60405180910390f35b348015610359575f5ffd5b50610362610be3565b60405161036f9190612a01565b60405180910390f35b348015610383575f5ffd5b5061039e60048036038101906103999190612a1a565b610c08565b005b3480156103ab575f5ffd5b506103b4610eec565b005b3480156103c1575f5ffd5b506103ca61107b565b6040516103d7919061289a565b60405180910390f35b3480156103eb575f5ffd5b506103f4611091565b005b348015610401575f5ffd5b5061040a6110a3565b6040516104179190612a8d565b60405180910390f35b34801561042b575f5ffd5b506104466004803603810190610441919061295b565b6110ca565b005b348015610453575f5ffd5b5061045c6112a7565b604051610469919061267b565b60405180910390f35b34801561047d575f5ffd5b506104866112ad565b6040516104939190612b01565b60405180910390f35b3480156104a7575f5ffd5b506104c260048036038101906104bd9190612b44565b6112d2565b005b3480156104cf575f5ffd5b506104ea60048036038101906104e59190612b82565b611380565b005b3480156104f7575f5ffd5b506105006113a2565b60405161050d9190612be1565b60405180910390f35b348015610521575f5ffd5b5061052a6113b6565b604051610537919061267b565b60405180910390f35b34801561054b575f5ffd5b5061056660048036038101906105619190612bfa565b6113bc565b60405161057593929190612c98565b60405180910390f35b348015610589575f5ffd5b506105a4600480360381019061059f9190612a1a565b611419565b005b3480156105b1575f5ffd5b506105cc60048036038101906105c79190612cf7565b611781565b005b3480156105d9575f5ffd5b506105f460048036038101906105ef919061295b565b61180f565b005b60135481565b600f5481565b60025f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16146106b6573360025f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff166040517f1cf993f40000000000000000000000000000000000000000000000000000000081526004016106ad929190612d22565b60405180910390fd5b6106c1838383611823565b505050565b6106ce611d4a565b8360155f6101000a81548163ffffffff021916908363ffffffff16021790555082601560046101000a81548161ffff021916908361ffff16021790555081601560066101000a81548163ffffffff021916908363ffffffff1602179055508060148190555050505050565b60155f9054906101000a900463ffffffff1681565b5f610757611dda565b61075f611e20565b5f61076983611e61565b90508034146107ad576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016107a490612da3565b60405180910390fd5b5f6107b784611ed8565b90505f8160020154116107ff576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016107f690612e0b565b60405180910390fd5b5f816001015411610845576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161083c90612e73565b60405180910390fd5b5f60125f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163460405161088b90612ebe565b5f6040518083038185875af1925050503d805f81146108c5576040519150601f19603f3d011682016040523d82523d5f602084013e6108ca565b606091505b505090508061090e576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161090590612f1c565b60405180910390fd5b5f6040518060c0016040528060145481526020016013548152602001601560049054906101000a900461ffff1661ffff16815260200160155f9054906101000a900463ffffffff1663ffffffff168152602001601560069054906101000a900463ffffffff1663ffffffff168152602001610999604051806020016040528060011515815250611f4c565b815250905060025f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16639b1c385e826040518263ffffffff1660e01b81526004016109f8919061306c565b6020604051808303815f875af1158015610a14573d5f5f3e3d5ffd5b505050506040513d601f19601f82011682018060405250810190610a3891906130a0565b945060405180606001604052803373ffffffffffffffffffffffffffffffffffffffff168152602001876002811115610a7457610a73612c25565b5b81526020015f1515815250600d5f8781526020019081526020015f205f820151815f015f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506020820151815f0160146101000a81548160ff02191690836002811115610afe57610afd612c25565b5b02179055506040820151815f0160156101000a81548160ff021916908315150217905550905050856002811115610b3857610b37612c25565b5b3373ffffffffffffffffffffffffffffffffffffffff16867fc319f52a94c56a2b81382fbdb5f1cae77badc44ba465d4c9ceddfb6fadefe23787604051610b7f919061267b565b60405180910390a450505050610b93611fe4565b919050565b600e602052805f5260405f205f915054906101000a900460ff1681565b610bbd611d4a565b610bc5611fee565b565b5f600260149054906101000a900460ff16905090565b60145481565b60125f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b610c10611d4a565b5f8311610c52576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610c4990613115565b60405180910390fd5b5f8161ffff1611610c98576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610c8f9061317d565b60405180910390fd5b610cc53330858773ffffffffffffffffffffffffffffffffffffffff16612050909392919063ffffffff16565b5f610ccf83611ed8565b9050805f016040518060c001604052805f6001811115610cf257610cf1612c25565b5b81526020018773ffffffffffffffffffffffffffffffffffffffff1681526020018681526020015f81526020018461ffff1681526020015f1515815250908060018154018082558091505060019003905f5260205f2090600402015f909190919091505f820151815f015f6101000a81548160ff02191690836001811115610d7d57610d7c612c25565b5b02179055506020820151815f0160016101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555060408201518160010155606082015181600201556080820151816003015f6101000a81548161ffff021916908361ffff16021790555060a08201518160030160026101000a81548160ff02191690831515021790555050508161ffff16816001015f828254610e3791906131c8565b925050819055506001816002015f828254610e5291906131c8565b925050819055508473ffffffffffffffffffffffffffffffffffffffff165f6001811115610e8357610e82612c25565b5b846002811115610e9657610e95612c25565b5b7f63e2adde7dfe22281f94d83376f6a2fabce620c00bc32d8c6f68bc5abdecf6d3875f876001885f0180549050610ecd91906131fb565b604051610edd9493929190613267565b60405180910390a45050505050565b60015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610f7b576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610f72906132f4565b60405180910390fd5b5f5f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff169050335f5f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505f60015f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055503373ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e060405160405180910390a350565b601560069054906101000a900463ffffffff1681565b611099611d4a565b6110a16120d2565b565b5f5f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905090565b6110d26110a3565b73ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415801561115a575060025f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614155b156111c857336111686110a3565b60025f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff166040517f061db9c10000000000000000000000000000000000000000000000000000000081526004016111bf93929190613312565b60405180910390fd5b5f73ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff160361122d576040517fd92e233d00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b8060025f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055507fd1a6a14209a385a964d036e404cb5cfb71f4000cdb03c9366292430787261be68160405161129c9190612a8d565b60405180910390a150565b60115481565b60025f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6112da611d4a565b80600e5f8473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f6101000a81548160ff0219169083151502179055508173ffffffffffffffffffffffffffffffffffffffff167f125943306687bd440a419d5840696e2dec90955322a9f4a7fb614bec0329fe8f8260405161137491906129a0565b60405180910390a25050565b611388611d4a565b82600f819055508160108190555080601181905550505050565b601560049054906101000a900461ffff1681565b60105481565b600d602052805f5260405f205f91509050805f015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1690805f0160149054906101000a900460ff1690805f0160159054906101000a900460ff16905083565b611421611d4a565b600e5f8573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f9054906101000a900460ff166114aa576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016114a190613391565b60405180910390fd5b5f8161ffff16116114f0576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016114e79061317d565b60405180910390fd5b8373ffffffffffffffffffffffffffffffffffffffff166323b872dd3330866040518463ffffffff1660e01b815260040161152d939291906133af565b5f604051808303815f87803b158015611544575f5ffd5b505af1158015611556573d5f5f3e3d5ffd5b505050505f61156483611ed8565b9050805f016040518060c0016040528060018081111561158757611586612c25565b5b81526020018773ffffffffffffffffffffffffffffffffffffffff1681526020015f81526020018681526020018461ffff1681526020015f1515815250908060018154018082558091505060019003905f5260205f2090600402015f909190919091505f820151815f015f6101000a81548160ff0219169083600181111561161257611611612c25565b5b02179055506020820151815f0160016101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555060408201518160010155606082015181600201556080820151816003015f6101000a81548161ffff021916908361ffff16021790555060a08201518160030160026101000a81548160ff02191690831515021790555050508161ffff16816001015f8282546116cc91906131c8565b925050819055506001816002015f8282546116e791906131c8565b925050819055508473ffffffffffffffffffffffffffffffffffffffff1660018081111561171857611717612c25565b5b84600281111561172b5761172a612c25565b5b7f63e2adde7dfe22281f94d83376f6a2fabce620c00bc32d8c6f68bc5abdecf6d35f88876001885f018054905061176291906131fb565b60405161177294939291906133e4565b60405180910390a45050505050565b611789611d4a565b8060125f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508073ffffffffffffffffffffffffffffffffffffffff167f7dae230f18360d76a040c81f050aa14eb9d6dc7901b20fc5d855e2a20fe814d160405160405180910390a250565b611817611d4a565b61182081612135565b50565b5f600d5f8581526020019081526020015f2090505f73ffffffffffffffffffffffffffffffffffffffff16815f015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16036118c7576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016118be90613471565b60405180910390fd5b805f0160159054906101000a900460ff1615611918576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161190f906134d9565b60405180910390fd5b6001815f0160156101000a81548160ff0219169083151502179055505f61194e825f0160149054906101000a900460ff16611ed8565b90505f6119748286865f818110611968576119676134f7565b5b90506020020135612260565b90505f825f01828154811061198c5761198b6134f7565b5b905f5260205f20906004020190508060030160029054906101000a900460ff16156119ec576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016119e39061356e565b60405180910390fd5b60018160030160026101000a81548160ff0219169083151502179055506001836002015f828254611a1d91906131fb565b92505081905550806003015f9054906101000a900461ffff1661ffff16836001015f828254611a4c91906131fb565b925050819055505f6001811115611a6657611a65612c25565b5b815f015f9054906101000a900460ff166001811115611a8857611a87612c25565b5b03611bc957611b01845f015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff168260010154835f0160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166123599092919063ffffffff16565b835f0160149054906101000a900460ff166002811115611b2457611b23612c25565b5b845f015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16887f3259eb42ddebd6f17e7e881f47bd1a2c165cb4b1f11bb877865afb793e3498295f855f0160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff1686600101545f89604051611bbc9594939291906135d2565b60405180910390a4611d41565b805f0160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166342842e0e30865f015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1684600201546040518463ffffffff1660e01b8152600401611c4f939291906133af565b5f604051808303815f87803b158015611c66575f5ffd5b505af1158015611c78573d5f5f3e3d5ffd5b50505050835f0160149054906101000a900460ff166002811115611c9f57611c9e612c25565b5b845f015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16887f3259eb42ddebd6f17e7e881f47bd1a2c165cb4b1f11bb877865afb793e3498296001855f0160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff165f876002015489604051611d38959493929190613623565b60405180910390a45b50505050505050565b5f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614611dd8576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611dcf906136be565b60405180910390fd5b565b600260035403611e16576040517f3ee5aeb500000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b6002600381905550565b611e28610bc7565b15611e5f576040517fd93c066500000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b565b5f5f6002811115611e7557611e74612c25565b5b826002811115611e8857611e87612c25565b5b03611e9757600f549050611ed3565b60016002811115611eab57611eaa612c25565b5b826002811115611ebe57611ebd612c25565b5b03611ecd576010549050611ed3565b60115490505b919050565b5f5f6002811115611eec57611eeb612c25565b5b826002811115611eff57611efe612c25565b5b03611f0d5760049050611f47565b60016002811115611f2157611f20612c25565b5b826002811115611f3457611f33612c25565b5b03611f425760079050611f47565b600a90505b919050565b60607f92fd13387c7fe7befbc38d303d6468778fb9731bc4583f17d92989c6fcfdeaaa82604051602401611f809190613705565b604051602081830303815290604052907bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff83818316178352505050509050919050565b6001600381905550565b611ff66123d8565b5f600260146101000a81548160ff0219169083151502179055507f5db9ee0a495bf2e6ff9c91a7834c1ba4fdd244a5e8aa4e537bd38aeae4b073aa612039612418565b6040516120469190612a8d565b60405180910390a1565b6120cc848573ffffffffffffffffffffffffffffffffffffffff166323b872dd868686604051602401612085939291906133af565b604051602081830303815290604052915060e01b6020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff838183161783525050505061241f565b50505050565b6120da611e20565b6001600260146101000a81548160ff0219169083151502179055507f62e78cea01bee320cd4e420270b5ea74000d11b0c9f74754ebdbfc544b05a25861211e612418565b60405161212b9190612a8d565b60405180910390a1565b3373ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff16036121a3576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161219a90613768565b60405180910390fd5b8060015f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508073ffffffffffffffffffffffffffffffffffffffff165f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff167fed8889f560326eb138920d842192f0eb3dd22b4f139c87a2c57538e05bae127860405160405180910390a350565b5f5f83600101548361227291906137b3565b90505f5f90505f855f018054905090505f5f90505b81811015612317575f875f0182815481106122a5576122a46134f7565b5b905f5260205f20906004020190508060030160029054906101000a900460ff16156122d0575061230a565b806003015f9054906101000a900461ffff1661ffff16846122f191906131c8565b935083851015612308578195505050505050612353565b505b8080600101915050612287565b506040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161234a9061382d565b60405180910390fd5b92915050565b6123d3838473ffffffffffffffffffffffffffffffffffffffff1663a9059cbb858560405160240161238c92919061384b565b604051602081830303815290604052915060e01b6020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff838183161783525050505061241f565b505050565b6123e0610bc7565b612416576040517f8dfc202b00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b565b5f33905090565b5f612449828473ffffffffffffffffffffffffffffffffffffffff166124b490919063ffffffff16565b90505f81511415801561246d57508080602001905181019061246b9190613886565b155b156124af57826040517f5274afe70000000000000000000000000000000000000000000000000000000081526004016124a69190612a8d565b60405180910390fd5b505050565b60606124c183835f6124c9565b905092915050565b60608147101561251057306040517fcd7860590000000000000000000000000000000000000000000000000000000081526004016125079190612a8d565b60405180910390fd5b5f5f8573ffffffffffffffffffffffffffffffffffffffff16848660405161253891906138e1565b5f6040518083038185875af1925050503d805f8114612572576040519150601f19603f3d011682016040523d82523d5f602084013e612577565b606091505b5091509150612587868383612592565b925050509392505050565b6060826125a7576125a28261261f565b612617565b5f82511480156125cd57505f8473ffffffffffffffffffffffffffffffffffffffff163b145b1561260f57836040517f9996b3150000000000000000000000000000000000000000000000000000000081526004016126069190612a8d565b60405180910390fd5b819050612618565b5b9392505050565b5f815111156126315780518082602001fd5b6040517f1425ea4200000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b5f819050919050565b61267581612663565b82525050565b5f60208201905061268e5f83018461266c565b92915050565b5f5ffd5b5f5ffd5b6126a581612663565b81146126af575f5ffd5b50565b5f813590506126c08161269c565b92915050565b5f5ffd5b5f5ffd5b5f5ffd5b5f5f83601f8401126126e7576126e66126c6565b5b8235905067ffffffffffffffff811115612704576127036126ca565b5b6020830191508360208202830111156127205761271f6126ce565b5b9250929050565b5f5f5f6040848603121561273e5761273d612694565b5b5f61274b868287016126b2565b935050602084013567ffffffffffffffff81111561276c5761276b612698565b5b612778868287016126d2565b92509250509250925092565b5f63ffffffff82169050919050565b61279c81612784565b81146127a6575f5ffd5b50565b5f813590506127b781612793565b92915050565b5f61ffff82169050919050565b6127d3816127bd565b81146127dd575f5ffd5b50565b5f813590506127ee816127ca565b92915050565b5f819050919050565b612806816127f4565b8114612810575f5ffd5b50565b5f81359050612821816127fd565b92915050565b5f5f5f5f6080858703121561283f5761283e612694565b5b5f61284c878288016127a9565b945050602061285d878288016127e0565b935050604061286e878288016127a9565b925050606061287f87828801612813565b91505092959194509250565b61289481612784565b82525050565b5f6020820190506128ad5f83018461288b565b92915050565b600381106128bf575f5ffd5b50565b5f813590506128d0816128b3565b92915050565b5f602082840312156128eb576128ea612694565b5b5f6128f8848285016128c2565b91505092915050565b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f61292a82612901565b9050919050565b61293a81612920565b8114612944575f5ffd5b50565b5f8135905061295581612931565b92915050565b5f602082840312156129705761296f612694565b5b5f61297d84828501612947565b91505092915050565b5f8115159050919050565b61299a81612986565b82525050565b5f6020820190506129b35f830184612991565b92915050565b6129c2816127f4565b82525050565b5f6020820190506129db5f8301846129b9565b92915050565b5f6129eb82612901565b9050919050565b6129fb816129e1565b82525050565b5f602082019050612a145f8301846129f2565b92915050565b5f5f5f5f60808587031215612a3257612a31612694565b5b5f612a3f87828801612947565b9450506020612a50878288016126b2565b9350506040612a61878288016128c2565b9250506060612a72878288016127e0565b91505092959194509250565b612a8781612920565b82525050565b5f602082019050612aa05f830184612a7e565b92915050565b5f819050919050565b5f612ac9612ac4612abf84612901565b612aa6565b612901565b9050919050565b5f612ada82612aaf565b9050919050565b5f612aeb82612ad0565b9050919050565b612afb81612ae1565b82525050565b5f602082019050612b145f830184612af2565b92915050565b612b2381612986565b8114612b2d575f5ffd5b50565b5f81359050612b3e81612b1a565b92915050565b5f5f60408385031215612b5a57612b59612694565b5b5f612b6785828601612947565b9250506020612b7885828601612b30565b9150509250929050565b5f5f5f60608486031215612b9957612b98612694565b5b5f612ba6868287016126b2565b9350506020612bb7868287016126b2565b9250506040612bc8868287016126b2565b9150509250925092565b612bdb816127bd565b82525050565b5f602082019050612bf45f830184612bd2565b92915050565b5f60208284031215612c0f57612c0e612694565b5b5f612c1c848285016126b2565b91505092915050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52602160045260245ffd5b60038110612c6357612c62612c25565b5b50565b5f819050612c7382612c52565b919050565b5f612c8282612c66565b9050919050565b612c9281612c78565b82525050565b5f606082019050612cab5f830186612a7e565b612cb86020830185612c89565b612cc56040830184612991565b949350505050565b612cd6816129e1565b8114612ce0575f5ffd5b50565b5f81359050612cf181612ccd565b92915050565b5f60208284031215612d0c57612d0b612694565b5b5f612d1984828501612ce3565b91505092915050565b5f604082019050612d355f830185612a7e565b612d426020830184612a7e565b9392505050565b5f82825260208201905092915050565b7f77726f6e672070726963650000000000000000000000000000000000000000005f82015250565b5f612d8d600b83612d49565b9150612d9882612d59565b602082019050919050565b5f6020820190508181035f830152612dba81612d81565b9050919050565b7f656d70747920706f6f6c000000000000000000000000000000000000000000005f82015250565b5f612df5600a83612d49565b9150612e0082612dc1565b602082019050919050565b5f6020820190508181035f830152612e2281612de9565b9050919050565b7f6e6f2077656967687400000000000000000000000000000000000000000000005f82015250565b5f612e5d600983612d49565b9150612e6882612e29565b602082019050919050565b5f6020820190508181035f830152612e8a81612e51565b9050919050565b5f81905092915050565b50565b5f612ea95f83612e91565b9150612eb482612e9b565b5f82019050919050565b5f612ec882612e9e565b9150819050919050565b7f74726561737572792078666572206661696c65640000000000000000000000005f82015250565b5f612f06601483612d49565b9150612f1182612ed2565b602082019050919050565b5f6020820190508181035f830152612f3381612efa565b9050919050565b612f43816127f4565b82525050565b612f5281612663565b82525050565b612f61816127bd565b82525050565b612f7081612784565b82525050565b5f81519050919050565b5f82825260208201905092915050565b8281835e5f83830152505050565b5f601f19601f8301169050919050565b5f612fb882612f76565b612fc28185612f80565b9350612fd2818560208601612f90565b612fdb81612f9e565b840191505092915050565b5f60c083015f830151612ffb5f860182612f3a565b50602083015161300e6020860182612f49565b5060408301516130216040860182612f58565b5060608301516130346060860182612f67565b5060808301516130476080860182612f67565b5060a083015184820360a086015261305f8282612fae565b9150508091505092915050565b5f6020820190508181035f8301526130848184612fe6565b905092915050565b5f8151905061309a8161269c565b92915050565b5f602082840312156130b5576130b4612694565b5b5f6130c28482850161308c565b91505092915050565b7f616d6f756e743d300000000000000000000000000000000000000000000000005f82015250565b5f6130ff600883612d49565b915061310a826130cb565b602082019050919050565b5f6020820190508181035f83015261312c816130f3565b9050919050565b7f7765696768743d300000000000000000000000000000000000000000000000005f82015250565b5f613167600883612d49565b915061317282613133565b602082019050919050565b5f6020820190508181035f8301526131948161315b565b9050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601160045260245ffd5b5f6131d282612663565b91506131dd83612663565b92508282019050808211156131f5576131f461319b565b5b92915050565b5f61320582612663565b915061321083612663565b92508282039050818111156132285761322761319b565b5b92915050565b5f819050919050565b5f61325161324c6132478461322e565b612aa6565b612663565b9050919050565b61326181613237565b82525050565b5f60808201905061327a5f83018761266c565b6132876020830186613258565b6132946040830185612bd2565b6132a1606083018461266c565b95945050505050565b7f4d7573742062652070726f706f736564206f776e6572000000000000000000005f82015250565b5f6132de601683612d49565b91506132e9826132aa565b602082019050919050565b5f6020820190508181035f83015261330b816132d2565b9050919050565b5f6060820190506133255f830186612a7e565b6133326020830185612a7e565b61333f6040830184612a7e565b949350505050565b7f657263373231206e6f7420616c6c6f77656400000000000000000000000000005f82015250565b5f61337b601283612d49565b915061338682613347565b602082019050919050565b5f6020820190508181035f8301526133a88161336f565b9050919050565b5f6060820190506133c25f830186612a7e565b6133cf6020830185612a7e565b6133dc604083018461266c565b949350505050565b5f6080820190506133f75f830187613258565b613404602083018661266c565b6134116040830185612bd2565b61341e606083018461266c565b95945050505050565b7f756e6b6e6f776e207265717565737400000000000000000000000000000000005f82015250565b5f61345b600f83612d49565b915061346682613427565b602082019050919050565b5f6020820190508181035f8301526134888161344f565b9050919050565b7f616c72656164792066756c66696c6c65640000000000000000000000000000005f82015250565b5f6134c3601183612d49565b91506134ce8261348f565b602082019050919050565b5f6020820190508181035f8301526134f0816134b7565b9050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52603260045260245ffd5b7f636f6e73756d65640000000000000000000000000000000000000000000000005f82015250565b5f613558600883612d49565b915061356382613524565b602082019050919050565b5f6020820190508181035f8301526135858161354c565b9050919050565b6002811061359d5761359c612c25565b5b50565b5f8190506135ad8261358c565b919050565b5f6135bc826135a0565b9050919050565b6135cc816135b2565b82525050565b5f60a0820190506135e55f8301886135c3565b6135f26020830187612a7e565b6135ff604083018661266c565b61360c6060830185613258565b613619608083018461266c565b9695505050505050565b5f60a0820190506136365f8301886135c3565b6136436020830187612a7e565b6136506040830186613258565b61365d606083018561266c565b61366a608083018461266c565b9695505050505050565b7f4f6e6c792063616c6c61626c65206279206f776e6572000000000000000000005f82015250565b5f6136a8601683612d49565b91506136b382613674565b602082019050919050565b5f6020820190508181035f8301526136d58161369c565b9050919050565b6136e581612986565b82525050565b602082015f8201516136ff5f8501826136dc565b50505050565b5f6020820190506137185f8301846136eb565b92915050565b7f43616e6e6f74207472616e7366657220746f2073656c660000000000000000005f82015250565b5f613752601783612d49565b915061375d8261371e565b602082019050919050565b5f6020820190508181035f83015261377f81613746565b9050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601260045260245ffd5b5f6137bd82612663565b91506137c883612663565b9250826137d8576137d7613786565b5b828206905092915050565b7f73656c656374696f6e206661696c6564000000000000000000000000000000005f82015250565b5f613817601083612d49565b9150613822826137e3565b602082019050919050565b5f6020820190508181035f8301526138448161380b565b9050919050565b5f60408201905061385e5f830185612a7e565b61386b602083018461266c565b9392505050565b5f8151905061388081612b1a565b92915050565b5f6020828403121561389b5761389a612694565b5b5f6138a884828501613872565b91505092915050565b5f6138bb82612f76565b6138c58185612e91565b93506138d5818560208601612f90565b80840191505092915050565b5f6138ec82846138b1565b91508190509291505056fea26469706673582212208b3496d771bbb45b175ee57e4ba3672b6ae70275b251e4a47c660ff05e20851964736f6c634300081e0033";


const V2_ABI = [
  {
    type: "constructor",
    inputs: [
      { name: "vrfCoordinator", type: "address" },
      { name: "_subscriptionId", type: "uint256" },
      { name: "_keyHash", type: "bytes32" },
      { name: "_treasury", type: "address" },
      { name: "initialOwner", type: "address" },
      { name: "_gnarsToken", type: "address" },
      { name: "_gnarsUnit", type: "uint256" },
    ],
  },
  { type: "function", name: "standardPrice", inputs: [], outputs: [{ type: "uint256" }], stateMutability: "view" },
  { type: "function", name: "gnarlyPrice", inputs: [], outputs: [{ type: "uint256" }], stateMutability: "view" },
  { type: "function", name: "epicPrice", inputs: [], outputs: [{ type: "uint256" }], stateMutability: "view" },
  { type: "function", name: "treasury", inputs: [], outputs: [{ type: "address" }], stateMutability: "view" },
  { type: "function", name: "paused", inputs: [], outputs: [{ type: "bool" }], stateMutability: "view" },
  { type: "function", name: "subscriptionId", inputs: [], outputs: [{ type: "uint256" }], stateMutability: "view" },
  { type: "function", name: "keyHash", inputs: [], outputs: [{ type: "bytes32" }], stateMutability: "view" },
  { type: "function", name: "s_vrfCoordinator", inputs: [], outputs: [{ type: "address" }], stateMutability: "view" },
  { type: "function", name: "openBox", inputs: [{ name: "boxType", type: "uint8" }], outputs: [{ type: "uint256" }], stateMutability: "payable" },
  { type: "function", name: "openFlexBox", inputs: [], outputs: [{ type: "uint256" }], stateMutability: "payable" },
  { type: "function", name: "minFlexEth", inputs: [], outputs: [{ type: "uint256" }], stateMutability: "view" },
  { type: "function", name: "getFlexBalances", inputs: [], outputs: [{ type: "uint256" }, { type: "uint256" }, { type: "uint256" }], stateMutability: "view" },
  { type: "function", name: "gnarsToken", inputs: [], outputs: [{ type: "address" }], stateMutability: "view" },
  { type: "function", name: "gnarsUnit", inputs: [], outputs: [{ type: "uint256" }], stateMutability: "view" },
  { type: "function", name: "flexNothingBps", inputs: [], outputs: [{ type: "uint16" }], stateMutability: "view" },
  { type: "function", name: "flexNftBps", inputs: [], outputs: [{ type: "uint16" }], stateMutability: "view" },
  { type: "function", name: "flexGnarsBase", inputs: [], outputs: [{ type: "uint256" }], stateMutability: "view" },
  { type: "function", name: "flexGnarsPerEth", inputs: [], outputs: [{ type: "uint256" }], stateMutability: "view" },
  { type: "function", name: "totalReservedGnars", inputs: [], outputs: [{ type: "uint256" }], stateMutability: "view" },
  {
    type: "function",
    name: "getPoolBalances",
    inputs: [{ name: "boxType", type: "uint8" }],
    outputs: [{ type: "uint256" }, { type: "uint256" }, { type: "uint256" }, { type: "uint256" }],
    stateMutability: "view",
  },
  { type: "function", name: "setAllowedERC721", inputs: [{ name: "nft", type: "address" }, { name: "allowed", type: "bool" }], outputs: [], stateMutability: "nonpayable" },
  { type: "function", name: "setTreasury", inputs: [{ name: "_treasury", type: "address" }], outputs: [], stateMutability: "nonpayable" },
  {
    type: "function",
    name: "setPrices",
    inputs: [{ name: "standard", type: "uint256" }, { name: "gnarly", type: "uint256" }, { name: "epic", type: "uint256" }],
    outputs: [],
    stateMutability: "nonpayable",
  },
  {
    type: "function",
    name: "setVrfConfig",
    inputs: [
      { name: "_callbackGasLimit", type: "uint32" },
      { name: "_requestConfirmations", type: "uint16" },
      { name: "_numWords", type: "uint32" },
      { name: "_keyHash", type: "bytes32" },
    ],
    outputs: [],
    stateMutability: "nonpayable",
  },
  {
    type: "function",
    name: "setFlexConfig",
    inputs: [
      { name: "_minFlexEth", type: "uint256" },
      { name: "_flexNothingBps", type: "uint16" },
      { name: "_flexNftBps", type: "uint16" },
      { name: "_flexGnarsBase", type: "uint256" },
      { name: "_flexGnarsPerEth", type: "uint256" },
    ],
    outputs: [],
    stateMutability: "nonpayable",
  },
  { type: "function", name: "pause", inputs: [], outputs: [], stateMutability: "nonpayable" },
  { type: "function", name: "unpause", inputs: [], outputs: [], stateMutability: "nonpayable" },
  {
    type: "function",
    name: "depositBundle",
    inputs: [
      { name: "nftContracts", type: "address[]" },
      { name: "nftIds", type: "uint256[]" },
      { name: "gnarsAmount", type: "uint256" },
      { name: "boxType", type: "uint8" },
      { name: "weight", type: "uint32" },
    ],
    outputs: [],
    stateMutability: "nonpayable",
  },
  { type: "function", name: "depositFlexNft", inputs: [{ name: "nft", type: "address" }, { name: "tokenId", type: "uint256" }], outputs: [], stateMutability: "nonpayable" },
  { type: "function", name: "depositGnars", inputs: [{ name: "amount", type: "uint256" }], outputs: [], stateMutability: "nonpayable" },
];

const ERC20_ABI = [
  { type: "function", name: "approve", inputs: [{ name: "spender", type: "address" }, { name: "amount", type: "uint256" }], outputs: [{ type: "bool" }], stateMutability: "nonpayable" },
];

const ERC721_ABI = [
  { type: "function", name: "approve", inputs: [{ name: "to", type: "address" }, { name: "tokenId", type: "uint256" }], outputs: [], stateMutability: "nonpayable" },
  { type: "function", name: "setApprovalForAll", inputs: [{ name: "operator", type: "address" }, { name: "approved", type: "bool" }], outputs: [], stateMutability: "nonpayable" },
];

const V2_BYTECODE =
  "0x60c060405266470de4df82000060185566b1a2bc2ec5000060195567016345785d8a0000601a5562061a80601e5f6101000a81548163ffffffff021916908363ffffffff1602179055506003601e60046101000a81548161ffff021916908361ffff1602179055506001601e60066101000a81548163ffffffff021916908363ffffffff16021790555065b5e620f48000601f55601460205f6101000a81548161ffff021916908361ffff1602179055506032602060026101000a81548161ffff021916908361ffff1602179055503480156100d9575f5ffd5b5060405161653538038061653583398181016040528101906100fb91906107b3565b8633805f5f73ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff160361016d576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610164906108aa565b60405180910390fd5b815f5f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505f73ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff16146101ef576101ee816104d960201b60201c565b5b5050505f73ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1603610257576040517fd92e233d00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b8060025f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550505f600260146101000a81548160ff02191690831515021790555060016003819055505f73ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff1603610328576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161031f90610912565b60405180910390fd5b5f73ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff1603610396576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161038d9061097a565b60405180910390fd5b5f81116103d8576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016103cf906109e2565b60405180910390fd5b3373ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff161461041b5761041a8361060460201b60201c565b5b85601c8190555084601d8190555083601b5f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508173ffffffffffffffffffffffffffffffffffffffff1660808173ffffffffffffffffffffffffffffffffffffffff16815250508060a08181525050806101f46104b39190610a2d565b602181905550806127106104c79190610a2d565b60228190555050505050505050610b3e565b3373ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1603610547576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161053e90610ab8565b60405180910390fd5b8060015f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508073ffffffffffffffffffffffffffffffffffffffff165f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff167fed8889f560326eb138920d842192f0eb3dd22b4f139c87a2c57538e05bae127860405160405180910390a350565b61061261062460201b60201c565b610621816104d960201b60201c565b50565b5f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16146106b2576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016106a990610b20565b60405180910390fd5b565b5f5ffd5b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f6106e1826106b8565b9050919050565b6106f1816106d7565b81146106fb575f5ffd5b50565b5f8151905061070c816106e8565b92915050565b5f819050919050565b61072481610712565b811461072e575f5ffd5b50565b5f8151905061073f8161071b565b92915050565b5f819050919050565b61075781610745565b8114610761575f5ffd5b50565b5f815190506107728161074e565b92915050565b5f610782826106b8565b9050919050565b61079281610778565b811461079c575f5ffd5b50565b5f815190506107ad81610789565b92915050565b5f5f5f5f5f5f5f60e0888a0312156107ce576107cd6106b4565b5b5f6107db8a828b016106fe565b97505060206107ec8a828b01610731565b96505060406107fd8a828b01610764565b955050606061080e8a828b0161079f565b945050608061081f8a828b016106fe565b93505060a06108308a828b016106fe565b92505060c06108418a828b01610731565b91505092959891949750929550565b5f82825260208201905092915050565b7f43616e6e6f7420736574206f776e657220746f207a65726f00000000000000005f82015250565b5f610894601883610850565b915061089f82610860565b602082019050919050565b5f6020820190508181035f8301526108c181610888565b9050919050565b7f6f776e65723d30000000000000000000000000000000000000000000000000005f82015250565b5f6108fc600783610850565b9150610907826108c8565b602082019050919050565b5f6020820190508181035f830152610929816108f0565b9050919050565b7f676e6172733d30000000000000000000000000000000000000000000000000005f82015250565b5f610964600783610850565b915061096f82610930565b602082019050919050565b5f6020820190508181035f83015261099181610958565b9050919050565b7f756e69743d3000000000000000000000000000000000000000000000000000005f82015250565b5f6109cc600683610850565b91506109d782610998565b602082019050919050565b5f6020820190508181035f8301526109f9816109c0565b9050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601160045260245ffd5b5f610a3782610712565b9150610a4283610712565b9250828202610a5081610712565b91508282048414831517610a6757610a66610a00565b5b5092915050565b7f43616e6e6f74207472616e7366657220746f2073656c660000000000000000005f82015250565b5f610aa2601783610850565b9150610aad82610a6e565b602082019050919050565b5f6020820190508181035f830152610acf81610a96565b9050919050565b7f4f6e6c792063616c6c61626c65206279206f776e6572000000000000000000005f82015250565b5f610b0a601683610850565b9150610b1582610ad6565b602082019050919050565b5f6020820190508181035f830152610b3781610afe565b9050919050565b60805160a051615997610b9e5f395f8181611b240152818161333b01528181613371015281816133a801526133df01525f8181610a32015281816113e501528181611abf01528181612cea0152818161347d015261386001526159975ff3fe608060405260043610610275575f3560e01c80637ccfd7fc1161014e578063a3bb35ae116100c0578063c3aee8d311610079578063c3aee8d3146108cb578063d0f8e816146108f5578063d50b37811461091f578063d858ef4d14610960578063f0f442601461098a578063f2fde38b146109b25761027c565b8063a3bb35ae146107df578063a50195fa14610809578063a88fe42d14610831578063ad8b140114610859578063b0fb162f14610877578063b74593d8146108a15761027c565b80638ea98117116101125780638ea98117146106e557806393079af51461070d5780639b302a8b146107395780639e9db57d146107635780639eccacf61461078d578063a1bfb307146107b75761027c565b80637ccfd7fc14610629578063806762a0146106535780638456cb591461067b578063890daa94146106915780638da5cb5b146106bb5761027c565b8063399efda3116101e75780635332f46a116101ab5780635332f46a146105415780635c975abb1461056b57806361728f391461059557806361d027b3146105bf5780636a7ebb9d146105e957806379ba5097146106135761027c565b8063399efda31461045e5780633d79ee41146104885780633f4ba83a146104c75780634d0af475146104dd5780634f009378146105055761027c565b80631fe543e3116102395780631fe543e314610350578063235069b41461037857806324f74697146103a057806329ec7f14146103ca5780632c96732c146103fa5780633156c7c4146104365761027c565b806309c1ba2e1461028057806318658621146102aa5780631cd2de0e146102d25780631d08ee4f146102fc5780631f1525e2146103265761027c565b3661027c57005b5f5ffd5b34801561028b575f5ffd5b506102946109da565b6040516102a19190614108565b60405180910390f35b3480156102b5575f5ffd5b506102d060048036038101906102cb9190614153565b6109e0565b005b3480156102dd575f5ffd5b506102e6610ab1565b6040516102f39190614108565b60405180910390f35b348015610307575f5ffd5b50610310610ab7565b60405161031d919061419a565b60405180910390f35b348015610331575f5ffd5b5061033a610acb565b6040516103479190614108565b60405180910390f35b34801561035b575f5ffd5b5061037660048036038101906103719190614214565b610ad1565b005b348015610383575f5ffd5b5061039e60048036038101906103999190614307565b610b95565b005b3480156103ab575f5ffd5b506103b4610c08565b6040516103c1919061437a565b60405180910390f35b6103e460048036038101906103df91906143b6565b610c1d565b6040516103f19190614108565b60405180910390f35b348015610405575f5ffd5b50610420600480360381019061041b919061443b565b610f31565b60405161042d9190614480565b60405180910390f35b348015610441575f5ffd5b5061045c60048036038101906104579190614499565b610f4e565b005b348015610469575f5ffd5b50610472611190565b60405161047f9190614108565b60405180910390f35b348015610493575f5ffd5b506104ae60048036038101906104a991906143b6565b611196565b6040516104be94939291906144d7565b60405180910390f35b3480156104d2575f5ffd5b506104db611230565b005b3480156104e8575f5ffd5b5061050360048036038101906104fe919061456f565b611242565b005b348015610510575f5ffd5b5061052b60048036038101906105269190614153565b6117e1565b6040516105389190614108565b60405180910390f35b34801561054c575f5ffd5b50610555611abd565b6040516105629190614681565b60405180910390f35b348015610576575f5ffd5b5061057f611ae1565b60405161058c9190614480565b60405180910390f35b3480156105a0575f5ffd5b506105a9611af7565b6040516105b691906146a9565b60405180910390f35b3480156105ca575f5ffd5b506105d3611afd565b6040516105e091906146e2565b60405180910390f35b3480156105f4575f5ffd5b506105fd611b22565b60405161060a9190614108565b60405180910390f35b34801561061e575f5ffd5b50610627611b46565b005b348015610634575f5ffd5b5061063d611cd5565b60405161064a919061437a565b60405180910390f35b34801561065e575f5ffd5b5061067960048036038101906106749190614153565b611ceb565b005b348015610686575f5ffd5b5061068f611f7e565b005b34801561069c575f5ffd5b506106a5611f90565b6040516106b29190614108565b60405180910390f35b3480156106c6575f5ffd5b506106cf611f96565b6040516106dc919061470a565b60405180910390f35b3480156106f0575f5ffd5b5061070b6004803603810190610706919061443b565b611fbd565b005b348015610718575f5ffd5b5061072161219a565b60405161073093929190614723565b60405180910390f35b348015610744575f5ffd5b5061074d6121c3565b60405161075a9190614108565b60405180910390f35b34801561076e575f5ffd5b506107776121c9565b6040516107849190614108565b60405180910390f35b348015610798575f5ffd5b506107a16121cf565b6040516107ae9190614778565b60405180910390f35b3480156107c2575f5ffd5b506107dd60048036038101906107d891906147bb565b6121f4565b005b3480156107ea575f5ffd5b506107f36122a2565b6040516108009190614108565b60405180910390f35b348015610814575f5ffd5b5061082f600480360381019061082a91906147f9565b6122a8565b005b34801561083c575f5ffd5b5061085760048036038101906108529190614870565b612398565b005b6108616123ba565b60405161086e9190614108565b60405180910390f35b348015610882575f5ffd5b5061088b6126e2565b604051610898919061419a565b60405180910390f35b3480156108ac575f5ffd5b506108b56126f6565b6040516108c2919061419a565b60405180910390f35b3480156108d6575f5ffd5b506108df612709565b6040516108ec9190614108565b60405180910390f35b348015610900575f5ffd5b5061090961270f565b6040516109169190614108565b60405180910390f35b34801561092a575f5ffd5b5061094560048036038101906109409190614153565b612715565b60405161095796959493929190614933565b60405180910390f35b34801561096b575f5ffd5b50610974612791565b6040516109819190614108565b60405180910390f35b348015610995575f5ffd5b506109b060048036038101906109ab91906149bc565b612797565b005b3480156109bd575f5ffd5b506109d860048036038101906109d3919061443b565b612825565b005b601c5481565b6109e8612839565b5f8111610a2a576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610a2190614a41565b60405180910390fd5b610a773330837f000000000000000000000000000000000000000000000000000000000000000073ffffffffffffffffffffffffffffffffffffffff166128c9909392919063ffffffff16565b7fdc43ded692123b8025480c68c7c3231145336450d1fa0dffec50b812c983207a81604051610aa69190614108565b60405180910390a150565b60145481565b602060029054906101000a900461ffff1681565b60185481565b60025f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610b85573360025f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff166040517f1cf993f4000000000000000000000000000000000000000000000000000000008152600401610b7c929190614a5f565b60405180910390fd5b610b9083838361294b565b505050565b610b9d612839565b83601e5f6101000a81548163ffffffff021916908363ffffffff16021790555082601e60046101000a81548161ffff021916908361ffff16021790555081601e60066101000a81548163ffffffff021916908363ffffffff16021790555080601d8190555050505050565b601e5f9054906101000a900463ffffffff1681565b5f610c26612f5c565b610c2e612fa2565b600380811115610c4157610c406148c0565b5b826003811115610c5457610c536148c0565b5b03610c94576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610c8b90614ad0565b60405180910390fd5b5f610c9e83612fe3565b9050803414610ce2576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610cd990614b38565b60405180910390fd5b5f610cec8461305a565b90505f816002015411610d34576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610d2b90614ba0565b60405180910390fd5b5f816001015411610d7a576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610d7190614c08565b60405180910390fd5b610d83346130ce565b610d8b61319b565b92506040518060c001604052803373ffffffffffffffffffffffffffffffffffffffff168152602001856003811115610dc757610dc66148c0565b5b81526020013481526020015f81526020015f151581526020015f151581525060165f8581526020019081526020015f205f820151815f015f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506020820151815f0160146101000a81548160ff02191690836003811115610e6557610e646148c0565b5b021790555060408201518160010155606082015181600201556080820151816003015f6101000a81548160ff02191690831515021790555060a08201518160030160016101000a81548160ff021916908315150217905550905050836003811115610ed357610ed26148c0565b5b3373ffffffffffffffffffffffffffffffffffffffff16847fc319f52a94c56a2b81382fbdb5f1cae77badc44ba465d4c9ceddfb6fadefe23734604051610f1a9190614108565b60405180910390a45050610f2c6132cc565b919050565b6017602052805f5260405f205f915054906101000a900460ff1681565b610f56612839565b60175f8373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f9054906101000a900460ff16610fdf576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610fd690614c70565b60405180910390fd5b8173ffffffffffffffffffffffffffffffffffffffff166323b872dd3330846040518463ffffffff1660e01b815260040161101c93929190614c8e565b5f604051808303815f87803b158015611033575f5ffd5b505af1158015611045573d5f5f3e3d5ffd5b50505050601360405180606001604052808473ffffffffffffffffffffffffffffffffffffffff1681526020018381526020015f1515815250908060018154018082558091505060019003905f5260205f2090600302015f909190919091505f820151815f015f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550602082015181600101556040820151816002015f6101000a81548160ff0219169083151502179055505050600160145f8282546111259190614cf0565b92505081905550808273ffffffffffffffffffffffffffffffffffffffff167f56b10e6266684448e8ae6bf288f6605b21a25123f716c0368942eaac127c75f560016013805490506111779190614d23565b6040516111849190614108565b60405180910390a35050565b60225481565b5f5f5f5f6003808111156111ad576111ac6148c0565b5b8560038111156111c0576111bf6148c0565b5b03611200576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016111f790614ad0565b60405180910390fd5b5f61120a8661305a565b905080600301548160040154826002015483600101549450945094509450509193509193565b611238612839565b6112406132d6565b565b61124a612839565b60038081111561125d5761125c6148c0565b5b8260038111156112705761126f6148c0565b5b036112b0576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016112a790614da0565b60405180910390fd5b5f8163ffffffff16116112f8576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016112ef90614e08565b60405180910390fd5b848490508787905014611340576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161133790614e70565b60405180910390fd5b5f87879050118015611356575060038787905011155b611395576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161138c90614ed8565b60405180910390fd5b61139e83613338565b6113dd576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016113d490614f40565b60405180910390fd5b61142a3330857f000000000000000000000000000000000000000000000000000000000000000073ffffffffffffffffffffffffffffffffffffffff166128c9909392919063ffffffff16565b5f5f90505b8787905081101561157f575f88888381811061144e5761144d614f5e565b5b9050602002016020810190611463919061443b565b905060175f8273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f9054906101000a900460ff166114ee576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016114e590614c70565b60405180910390fd5b8073ffffffffffffffffffffffffffffffffffffffff166323b872dd33308a8a8781811061151f5761151e614f5e565b5b905060200201356040518463ffffffff1660e01b815260040161154493929190614c8e565b5f604051808303815f87803b15801561155b575f5ffd5b505af115801561156d573d5f5f3e3d5ffd5b5050505050808060010191505061142f565b505f61158a8361305a565b9050805f016040518060a001604052808463ffffffff1681526020018681526020018a8a808060200260200160405190810160405280939291908181526020018383602002808284375f81840152601f19601f8201169050808301925050505050505081526020018888808060200260200160405190810160405280939291908181526020018383602002808284375f81840152601f19601f8201169050808301925050505050505081526020015f1515815250908060018154018082558091505060019003905f5260205f2090600502015f909190919091505f820151815f015f6101000a81548163ffffffff021916908363ffffffff1602179055506020820151816001015560408201518160020190805190602001906116ae929190613fcd565b5060608201518160030190805190602001906116cb929190614054565b506080820151816004015f6101000a81548160ff02191690831515021790555050508163ffffffff16816001015f8282546117069190614cf0565b925050819055506001816002015f8282546117219190614cf0565b9250508190555083816003015f82825461173b9190614cf0565b9250508190555087879050816004015f8282546117589190614cf0565b925050819055508360235f8282546117709190614cf0565b9250508190555082600381111561178a576117896148c0565b5b7f435f3dcde66483bed34aaedb4b0f46d649ef23412bcd2a717ae8c8e3ca6f09e685846001855f01805490506117c09190614d23565b6040516117cf93929190614f8b565b60405180910390a25050505050505050565b5f6117ea612839565b5f60165f8481526020019081526020015f2090505f73ffffffffffffffffffffffffffffffffffffffff16815f015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff160361188e576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016118859061500a565b60405180910390fd5b806003015f9054906101000a900460ff16156118df576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016118d690615072565b60405180910390fd5b6118e761319b565b91508060165f8481526020019081526020015f205f82015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff16815f015f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505f820160149054906101000a900460ff16815f0160146101000a81548160ff02191690836003811115611994576119936148c0565b5b02179055506001820154816001015560028201548160020155600382015f9054906101000a900460ff16816003015f6101000a81548160ff0219169083151502179055506003820160019054906101000a900460ff168160030160016101000a81548160ff02191690831515021790555090505060165f8481526020019081526020015f205f5f82015f6101000a81549073ffffffffffffffffffffffffffffffffffffffff02191690555f820160146101000a81549060ff0219169055600182015f9055600282015f9055600382015f6101000a81549060ff02191690556003820160016101000a81549060ff0219169055505081837ff43c934b0ed8f580991dc90bdf7b93f65f773b924030581946e19281ac4bd90460405160405180910390a350919050565b7f000000000000000000000000000000000000000000000000000000000000000081565b5f600260149054906101000a900460ff16905090565b601d5481565b601b5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b7f000000000000000000000000000000000000000000000000000000000000000081565b60015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614611bd5576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611bcc906150da565b60405180910390fd5b5f5f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff169050335f5f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505f60015f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055503373ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e060405160405180910390a350565b601e60069054906101000a900463ffffffff1681565b611cf3612839565b5f60165f8381526020019081526020015f2090505f73ffffffffffffffffffffffffffffffffffffffff16815f015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1603611d97576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611d8e9061500a565b60405180910390fd5b806003015f9054906101000a900460ff1615611de8576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611ddf90615072565b60405180910390fd5b8060030160019054906101000a900460ff168015611e0757505f601554115b15611e2657600160155f828254611e1e9190614d23565b925050819055505b5f8160020154118015611e3f5750806002015460245410155b15611e6157806002015460245f828254611e599190614d23565b925050819055505b805f0160149054906101000a900460ff166003811115611e8457611e836148c0565b5b815f015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16837f2ccae9e8e0244a74d74ef1ea042e16aa6596c6cd44c10b3d61dfc74d20e60db38460010154604051611ef19190614108565b60405180910390a460165f8381526020019081526020015f205f5f82015f6101000a81549073ffffffffffffffffffffffffffffffffffffffff02191690555f820160146101000a81549060ff0219169055600182015f9055600282015f9055600382015f6101000a81549060ff02191690556003820160016101000a81549060ff021916905550505050565b611f86612839565b611f8e613416565b565b60235481565b5f5f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905090565b611fc5611f96565b73ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415801561204d575060025f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614155b156120bb573361205b611f96565b60025f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff166040517f061db9c10000000000000000000000000000000000000000000000000000000081526004016120b2939291906150f8565b60405180910390fd5b5f73ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1603612120576040517fd92e233d00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b8060025f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055507fd1a6a14209a385a964d036e404cb5cfb71f4000cdb03c9366292430787261be68160405161218f919061470a565b60405180910390a150565b5f5f5f6015546014546121ad9190614d23565b6121b5613479565b602354925092509250909192565b60245481565b601a5481565b60025f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6121fc612839565b8060175f8473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f6101000a81548160ff0219169083151502179055508173ffffffffffffffffffffffffffffffffffffffff167f125943306687bd440a419d5840696e2dec90955322a9f4a7fb614bec0329fe8f826040516122969190614480565b60405180910390a25050565b60155481565b6122b0612839565b61271083856122bf919061512d565b61ffff161115612304576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016122fb906151ac565b60405180910390fd5b84601f819055508360205f6101000a81548161ffff021916908361ffff16021790555082602060026101000a81548161ffff021916908361ffff16021790555081602181905550806022819055507f2c89e2446de99c396ee1409e3389640540099767a5156fcb80727c3e918bbefb85858585856040516123899594939291906151ca565b60405180910390a15050505050565b6123a0612839565b826018819055508160198190555080601a81905550505050565b5f6123c3612f5c565b6123cb612fa2565b601f54341015612410576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161240790615265565b60405180910390fd5b5f602060029054906101000a900461ffff1661ffff1614806124355750601554601454115b612474576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161246b906152cd565b60405180910390fd5b5f61247e34613556565b905080612489613479565b10156124ca576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016124c190615335565b60405180910390fd5b5f602060029054906101000a900461ffff1661ffff16111561250057600160155f8282546124f89190614cf0565b925050819055505b8060245f8282546125119190614cf0565b92505081905550612521346130ce565b61252961319b565b91506040518060c001604052803373ffffffffffffffffffffffffffffffffffffffff168152602001600380811115612565576125646148c0565b5b81526020013481526020018281526020015f151581526020015f602060029054906101000a900461ffff1661ffff1611151581525060165f8481526020019081526020015f205f820151815f015f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506020820151815f0160146101000a81548160ff02191690836003811115612619576126186148c0565b5b021790555060408201518160010155606082015181600201556080820151816003015f6101000a81548160ff02191690831515021790555060a08201518160030160016101000a81548160ff021916908315150217905550905050600380811115612687576126866148c0565b5b3373ffffffffffffffffffffffffffffffffffffffff16837fc319f52a94c56a2b81382fbdb5f1cae77badc44ba465d4c9ceddfb6fadefe237346040516126ce9190614108565b60405180910390a4506126df6132cc565b90565b601e60049054906101000a900461ffff1681565b60205f9054906101000a900461ffff1681565b60215481565b60195481565b6016602052805f5260405f205f91509050805f015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1690805f0160149054906101000a900460ff1690806001015490806002015490806003015f9054906101000a900460ff16908060030160019054906101000a900460ff16905086565b601f5481565b61279f612839565b80601b5f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508073ffffffffffffffffffffffffffffffffffffffff167f7dae230f18360d76a040c81f050aa14eb9d6dc7901b20fc5d855e2a20fe814d160405160405180910390a250565b61282d612839565b6128368161358c565b50565b5f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16146128c7576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016128be9061539d565b60405180910390fd5b565b612945848573ffffffffffffffffffffffffffffffffffffffff166323b872dd8686866040516024016128fe93929190614c8e565b604051602081830303815290604052915060e01b6020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff83818316178352505050506136b7565b50505050565b5f60165f8581526020019081526020015f2090505f73ffffffffffffffffffffffffffffffffffffffff16815f015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16036129ef576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016129e69061500a565b60405180910390fd5b806003015f9054906101000a900460ff1615612a40576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401612a3790615072565b60405180910390fd5b6001816003015f6101000a81548160ff021916908315150217905550600380811115612a6f57612a6e6148c0565b5b815f0160149054906101000a900460ff166003811115612a9257612a916148c0565b5b03612b4257612abb848285855f818110612aaf57612aae614f5e565b5b9050602002013561374c565b60165f8581526020019081526020015f205f5f82015f6101000a81549073ffffffffffffffffffffffffffffffffffffffff02191690555f820160146101000a81549060ff0219169055600182015f9055600282015f9055600382015f6101000a81549060ff02191690556003820160016101000a81549060ff0219169055505050612f57565b5f612b5c825f0160149054906101000a900460ff1661305a565b90505f612b828286865f818110612b7657612b75614f5e565b5b905060200201356139dd565b90505f825f018281548110612b9a57612b99614f5e565b5b905f5260205f2090600502019050806004015f9054906101000a900460ff1615612bf9576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401612bf090615405565b60405180910390fd5b6001816004015f6101000a81548160ff0219169083151502179055506001836002015f828254612c299190614d23565b92505081905550805f015f9054906101000a900463ffffffff1663ffffffff16836001015f828254612c5b9190614d23565b925050819055508060010154836003015f828254612c799190614d23565b925050819055508060020180549050836004015f828254612c9a9190614d23565b92505081905550806001015460235f828254612cb69190614d23565b92505081905550612d2e845f015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1682600101547f000000000000000000000000000000000000000000000000000000000000000073ffffffffffffffffffffffffffffffffffffffff16613ad89092919063ffffffff16565b5f5f90505b8160020180549050811015612e3657816002018181548110612d5857612d57614f5e565b5b905f5260205f20015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166342842e0e30875f015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff16856003018581548110612dd557612dd4614f5e565b5b905f5260205f2001546040518463ffffffff1660e01b8152600401612dfc93929190614c8e565b5f604051808303815f87803b158015612e13575f5ffd5b505af1158015612e25573d5f5f3e3d5ffd5b505050508080600101915050612d33565b50835f0160149054906101000a900460ff166003811115612e5a57612e596148c0565b5b845f015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16887f87cd9b8e9082bdac2da7d9dba51c5b244d9c3b99891b84b12ee18cb674cd3181846001015486604051612ec9929190615423565b60405180910390a460165f8881526020019081526020015f205f5f82015f6101000a81549073ffffffffffffffffffffffffffffffffffffffff02191690555f820160146101000a81549060ff0219169055600182015f9055600282015f9055600382015f6101000a81549060ff02191690556003820160016101000a81549060ff02191690555050505050505b505050565b600260035403612f98576040517f3ee5aeb500000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b6002600381905550565b612faa611ae1565b15612fe1576040517fd93c066500000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b565b5f5f6003811115612ff757612ff66148c0565b5b82600381111561300a576130096148c0565b5b03613019576018549050613055565b6001600381111561302d5761302c6148c0565b5b8260038111156130405761303f6148c0565b5b0361304f576019549050613055565b601a5490505b919050565b5f5f600381111561306e5761306d6148c0565b5b826003811115613081576130806148c0565b5b0361308f57600490506130c9565b600160038111156130a3576130a26148c0565b5b8260038111156130b6576130b56148c0565b5b036130c457600990506130c9565b600e90505b919050565b5f601b5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168260405161311490615477565b5f6040518083038185875af1925050503d805f811461314e576040519150601f19603f3d011682016040523d82523d5f602084013e613153565b606091505b5050905080613197576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161318e906154d5565b60405180910390fd5b5050565b5f5f6040518060c00160405280601d548152602001601c548152602001601e60049054906101000a900461ffff1661ffff168152602001601e5f9054906101000a900463ffffffff1663ffffffff168152602001601e60069054906101000a900463ffffffff1663ffffffff168152602001613227604051806020016040528060011515815250613b57565b815250905060025f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16639b1c385e826040518263ffffffff1660e01b81526004016132869190615625565b6020604051808303815f875af11580156132a2573d5f5f3e3d5ffd5b505050506040513d601f19601f820116820180604052508101906132c69190615659565b91505090565b6001600381905550565b6132de613bef565b5f600260146101000a81548160ff0219169083151502179055507f5db9ee0a495bf2e6ff9c91a7834c1ba4fdd244a5e8aa4e537bd38aeae4b073aa613321613c2f565b60405161332e919061470a565b60405180910390a1565b5f7f00000000000000000000000000000000000000000000000000000000000000006103e86133679190615684565b8214806133a057507f000000000000000000000000000000000000000000000000000000000000000061138861339d9190615684565b82145b806133d757507f00000000000000000000000000000000000000000000000000000000000000006127106133d49190615684565b82145b8061340f57507f0000000000000000000000000000000000000000000000000000000000000000620186a061340c9190615684565b82145b9050919050565b61341e612fa2565b6001600260146101000a81548160ff0219169083151502179055507f62e78cea01bee320cd4e420270b5ea74000d11b0c9f74754ebdbfc544b05a258613462613c2f565b60405161346f919061470a565b60405180910390a1565b5f5f7f000000000000000000000000000000000000000000000000000000000000000073ffffffffffffffffffffffffffffffffffffffff166370a08231306040518263ffffffff1660e01b81526004016134d4919061470a565b602060405180830381865afa1580156134ef573d5f5f3e3d5ffd5b505050506040513d601f19601f820116820180604052508101906135139190615659565b90506024546023546135259190614cf0565b8111613534575f915050613553565b602454602354826135459190614d23565b61354f9190614d23565b9150505b90565b5f670de0b6b3a76400006022548361356e9190615684565b61357891906156f2565b6021546135859190614cf0565b9050919050565b3373ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff16036135fa576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016135f19061576c565b60405180910390fd5b8060015f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508073ffffffffffffffffffffffffffffffffffffffff165f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff167fed8889f560326eb138920d842192f0eb3dd22b4f139c87a2c57538e05bae127860405160405180910390a350565b5f6136e1828473ffffffffffffffffffffffffffffffffffffffff16613c3690919063ffffffff16565b90505f815114158015613705575080806020019051810190613703919061579e565b155b1561374757826040517f5274afe700000000000000000000000000000000000000000000000000000000815260040161373e919061470a565b60405180910390fd5b505050565b5f6127108261375b91906157c9565b90505f612710808461376d91906156f2565b61377791906157c9565b90505f612710808561378991906156f2565b61379391906156f2565b90505f60205f9054906101000a900461ffff1661ffff16841090505f811580156137d05750602060029054906101000a900461ffff1661ffff1684105b90505f5f90505f5f90505f5f9050896002015460245f8282546137f39190614d23565b925050819055508960030160019054906101000a900460ff161561382b57600160155f8282546138239190614d23565b925050819055505b846138a557896002015492506138a48a5f015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff16847f000000000000000000000000000000000000000000000000000000000000000073ffffffffffffffffffffffffffffffffffffffff16613ad89092919063ffffffff16565b5b8315613953575f6138b587613c4b565b509050805f01519250806020015191508273ffffffffffffffffffffffffffffffffffffffff166342842e0e308d5f015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff16856040518463ffffffff1660e01b815260040161392493929190614c8e565b5f604051808303815f87803b15801561393b575f5ffd5b505af115801561394d573d5f5f3e3d5ffd5b50505050505b895f015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168b7fe1fc2e622d9cbf4b1f97e6ebda4067d5dbd68c6c1d0a78bf2bda7d1e0c5246768c600101548686868b6040516139c89594939291906157f9565b60405180910390a35050505050505050505050565b5f5f8360010154836139ef91906157c9565b90505f5f90505f855f018054905090505f5f90505b81811015613a96575f875f018281548110613a2257613a21614f5e565b5b905f5260205f2090600502019050806004015f9054906101000a900460ff1615613a4c5750613a89565b805f015f9054906101000a900463ffffffff1663ffffffff1684613a709190614cf0565b935083851015613a87578195505050505050613ad2565b505b8080600101915050613a04565b506040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401613ac990615894565b60405180910390fd5b92915050565b613b52838473ffffffffffffffffffffffffffffffffffffffff1663a9059cbb8585604051602401613b0b9291906158b2565b604051602081830303815290604052915060e01b6020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff83818316178352505050506136b7565b505050565b60607f92fd13387c7fe7befbc38d303d6468778fb9731bc4583f17d92989c6fcfdeaaa82604051602401613b8b9190615902565b604051602081830303815290604052907bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff83818316178352505050509050919050565b613bf7611ae1565b613c2d576040517f8dfc202b00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b565b5f33905090565b6060613c4383835f613e33565b905092915050565b613c5361409f565b5f5f60145411613c98576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401613c8f906152cd565b60405180910390fd5b5f60145484613ca791906157c9565b90505f5f90505f60138054905090505f5f90505b81811015613df2575f60138281548110613cd857613cd7614f5e565b5b905f5260205f2090600302019050806002015f9054906101000a900460ff1615613d025750613de5565b848403613dd4576001816002015f6101000a81548160ff021916908315150217905550600160145f828254613d379190614d23565b925050819055508082816040518060600160405290815f82015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200160018201548152602001600282015f9054906101000a900460ff1615151515815250509150965096505050505050613e2e565b600184613de19190614cf0565b9350505b8080600101915050613cbb565b506040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401613e2590615894565b60405180910390fd5b915091565b606081471015613e7a57306040517fcd786059000000000000000000000000000000000000000000000000000000008152600401613e71919061470a565b60405180910390fd5b5f5f8573ffffffffffffffffffffffffffffffffffffffff168486604051613ea2919061594b565b5f6040518083038185875af1925050503d805f8114613edc576040519150601f19603f3d011682016040523d82523d5f602084013e613ee1565b606091505b5091509150613ef1868383613efc565b925050509392505050565b606082613f1157613f0c82613f89565b613f81565b5f8251148015613f3757505f8473ffffffffffffffffffffffffffffffffffffffff163b145b15613f7957836040517f9996b315000000000000000000000000000000000000000000000000000000008152600401613f70919061470a565b60405180910390fd5b819050613f82565b5b9392505050565b5f81511115613f9b5780518082602001fd5b6040517f1425ea4200000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b828054828255905f5260205f20908101928215614043579160200282015b82811115614042578251825f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555091602001919060010190613feb565b5b50905061405091906140d5565b5090565b828054828255905f5260205f2090810192821561408e579160200282015b8281111561408d578251825591602001919060010190614072565b5b50905061409b91906140d5565b5090565b60405180606001604052805f73ffffffffffffffffffffffffffffffffffffffff1681526020015f81526020015f151581525090565b5b808211156140ec575f815f9055506001016140d6565b5090565b5f819050919050565b614102816140f0565b82525050565b5f60208201905061411b5f8301846140f9565b92915050565b5f5ffd5b5f5ffd5b614132816140f0565b811461413c575f5ffd5b50565b5f8135905061414d81614129565b92915050565b5f6020828403121561416857614167614121565b5b5f6141758482850161413f565b91505092915050565b5f61ffff82169050919050565b6141948161417e565b82525050565b5f6020820190506141ad5f83018461418b565b92915050565b5f5ffd5b5f5ffd5b5f5ffd5b5f5f83601f8401126141d4576141d36141b3565b5b8235905067ffffffffffffffff8111156141f1576141f06141b7565b5b60208301915083602082028301111561420d5761420c6141bb565b5b9250929050565b5f5f5f6040848603121561422b5761422a614121565b5b5f6142388682870161413f565b935050602084013567ffffffffffffffff81111561425957614258614125565b5b614265868287016141bf565b92509250509250925092565b5f63ffffffff82169050919050565b61428981614271565b8114614293575f5ffd5b50565b5f813590506142a481614280565b92915050565b6142b38161417e565b81146142bd575f5ffd5b50565b5f813590506142ce816142aa565b92915050565b5f819050919050565b6142e6816142d4565b81146142f0575f5ffd5b50565b5f81359050614301816142dd565b92915050565b5f5f5f5f6080858703121561431f5761431e614121565b5b5f61432c87828801614296565b945050602061433d878288016142c0565b935050604061434e87828801614296565b925050606061435f878288016142f3565b91505092959194509250565b61437481614271565b82525050565b5f60208201905061438d5f83018461436b565b92915050565b6004811061439f575f5ffd5b50565b5f813590506143b081614393565b92915050565b5f602082840312156143cb576143ca614121565b5b5f6143d8848285016143a2565b91505092915050565b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f61440a826143e1565b9050919050565b61441a81614400565b8114614424575f5ffd5b50565b5f8135905061443581614411565b92915050565b5f602082840312156144505761444f614121565b5b5f61445d84828501614427565b91505092915050565b5f8115159050919050565b61447a81614466565b82525050565b5f6020820190506144935f830184614471565b92915050565b5f5f604083850312156144af576144ae614121565b5b5f6144bc85828601614427565b92505060206144cd8582860161413f565b9150509250929050565b5f6080820190506144ea5f8301876140f9565b6144f760208301866140f9565b61450460408301856140f9565b61451160608301846140f9565b95945050505050565b5f5f83601f84011261452f5761452e6141b3565b5b8235905067ffffffffffffffff81111561454c5761454b6141b7565b5b602083019150836020820283011115614568576145676141bb565b5b9250929050565b5f5f5f5f5f5f5f60a0888a03121561458a57614589614121565b5b5f88013567ffffffffffffffff8111156145a7576145a6614125565b5b6145b38a828b0161451a565b9750975050602088013567ffffffffffffffff8111156145d6576145d5614125565b5b6145e28a828b016141bf565b955095505060406145f58a828b0161413f565b93505060606146068a828b016143a2565b92505060806146178a828b01614296565b91505092959891949750929550565b5f819050919050565b5f61464961464461463f846143e1565b614626565b6143e1565b9050919050565b5f61465a8261462f565b9050919050565b5f61466b82614650565b9050919050565b61467b81614661565b82525050565b5f6020820190506146945f830184614672565b92915050565b6146a3816142d4565b82525050565b5f6020820190506146bc5f83018461469a565b92915050565b5f6146cc826143e1565b9050919050565b6146dc816146c2565b82525050565b5f6020820190506146f55f8301846146d3565b92915050565b61470481614400565b82525050565b5f60208201905061471d5f8301846146fb565b92915050565b5f6060820190506147365f8301866140f9565b61474360208301856140f9565b61475060408301846140f9565b949350505050565b5f61476282614650565b9050919050565b61477281614758565b82525050565b5f60208201905061478b5f830184614769565b92915050565b61479a81614466565b81146147a4575f5ffd5b50565b5f813590506147b581614791565b92915050565b5f5f604083850312156147d1576147d0614121565b5b5f6147de85828601614427565b92505060206147ef858286016147a7565b9150509250929050565b5f5f5f5f5f60a0868803121561481257614811614121565b5b5f61481f8882890161413f565b9550506020614830888289016142c0565b9450506040614841888289016142c0565b93505060606148528882890161413f565b92505060806148638882890161413f565b9150509295509295909350565b5f5f5f6060848603121561488757614886614121565b5b5f6148948682870161413f565b93505060206148a58682870161413f565b92505060406148b68682870161413f565b9150509250925092565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52602160045260245ffd5b600481106148fe576148fd6148c0565b5b50565b5f81905061490e826148ed565b919050565b5f61491d82614901565b9050919050565b61492d81614913565b82525050565b5f60c0820190506149465f8301896146fb565b6149536020830188614924565b61496060408301876140f9565b61496d60608301866140f9565b61497a6080830185614471565b61498760a0830184614471565b979650505050505050565b61499b816146c2565b81146149a5575f5ffd5b50565b5f813590506149b681614992565b92915050565b5f602082840312156149d1576149d0614121565b5b5f6149de848285016149a8565b91505092915050565b5f82825260208201905092915050565b7f616d6f756e743d300000000000000000000000000000000000000000000000005f82015250565b5f614a2b6008836149e7565b9150614a36826149f7565b602082019050919050565b5f6020820190508181035f830152614a5881614a1f565b9050919050565b5f604082019050614a725f8301856146fb565b614a7f60208301846146fb565b9392505050565b7f75736520666c65780000000000000000000000000000000000000000000000005f82015250565b5f614aba6008836149e7565b9150614ac582614a86565b602082019050919050565b5f6020820190508181035f830152614ae781614aae565b9050919050565b7f77726f6e672070726963650000000000000000000000000000000000000000005f82015250565b5f614b22600b836149e7565b9150614b2d82614aee565b602082019050919050565b5f6020820190508181035f830152614b4f81614b16565b9050919050565b7f656d70747920706f6f6c000000000000000000000000000000000000000000005f82015250565b5f614b8a600a836149e7565b9150614b9582614b56565b602082019050919050565b5f6020820190508181035f830152614bb781614b7e565b9050919050565b7f6e6f2077656967687400000000000000000000000000000000000000000000005f82015250565b5f614bf26009836149e7565b9150614bfd82614bbe565b602082019050919050565b5f6020820190508181035f830152614c1f81614be6565b9050919050565b7f657263373231206e6f7420616c6c6f77656400000000000000000000000000005f82015250565b5f614c5a6012836149e7565b9150614c6582614c26565b602082019050919050565b5f6020820190508181035f830152614c8781614c4e565b9050919050565b5f606082019050614ca15f8301866146fb565b614cae60208301856146fb565b614cbb60408301846140f9565b949350505050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601160045260245ffd5b5f614cfa826140f0565b9150614d05836140f0565b9250828201905080821115614d1d57614d1c614cc3565b5b92915050565b5f614d2d826140f0565b9150614d38836140f0565b9250828203905081811115614d5057614d4f614cc3565b5b92915050565b7f666c65782075736573206f776e20706f6f6c00000000000000000000000000005f82015250565b5f614d8a6012836149e7565b9150614d9582614d56565b602082019050919050565b5f6020820190508181035f830152614db781614d7e565b9050919050565b7f7765696768743d300000000000000000000000000000000000000000000000005f82015250565b5f614df26008836149e7565b9150614dfd82614dbe565b602082019050919050565b5f6020820190508181035f830152614e1f81614de6565b9050919050565b7f6c656e677468206d69736d6174636800000000000000000000000000000000005f82015250565b5f614e5a600f836149e7565b9150614e6582614e26565b602082019050919050565b5f6020820190508181035f830152614e8781614e4e565b9050919050565b7f6e667420636f756e7400000000000000000000000000000000000000000000005f82015250565b5f614ec26009836149e7565b9150614ecd82614e8e565b602082019050919050565b5f6020820190508181035f830152614eef81614eb6565b9050919050565b7f62616420676e61727320616d6f756e74000000000000000000000000000000005f82015250565b5f614f2a6010836149e7565b9150614f3582614ef6565b602082019050919050565b5f6020820190508181035f830152614f5781614f1e565b9050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52603260045260245ffd5b5f606082019050614f9e5f8301866140f9565b614fab602083018561436b565b614fb860408301846140f9565b949350505050565b7f756e6b6e6f776e207265717565737400000000000000000000000000000000005f82015250565b5f614ff4600f836149e7565b9150614fff82614fc0565b602082019050919050565b5f6020820190508181035f83015261502181614fe8565b9050919050565b7f616c72656164792066756c66696c6c65640000000000000000000000000000005f82015250565b5f61505c6011836149e7565b915061506782615028565b602082019050919050565b5f6020820190508181035f83015261508981615050565b9050919050565b7f4d7573742062652070726f706f736564206f776e6572000000000000000000005f82015250565b5f6150c46016836149e7565b91506150cf82615090565b602082019050919050565b5f6020820190508181035f8301526150f1816150b8565b9050919050565b5f60608201905061510b5f8301866146fb565b61511860208301856146fb565b61512560408301846146fb565b949350505050565b5f6151378261417e565b91506151428361417e565b9250828201905061ffff81111561515c5761515b614cc3565b5b92915050565b7f62616420627073000000000000000000000000000000000000000000000000005f82015250565b5f6151966007836149e7565b91506151a182615162565b602082019050919050565b5f6020820190508181035f8301526151c38161518a565b9050919050565b5f60a0820190506151dd5f8301886140f9565b6151ea602083018761418b565b6151f7604083018661418b565b61520460608301856140f9565b61521160808301846140f9565b9695505050505050565b7f6d696e20666c65780000000000000000000000000000000000000000000000005f82015250565b5f61524f6008836149e7565b915061525a8261521b565b602082019050919050565b5f6020820190508181035f83015261527c81615243565b9050919050565b7f666c6578206e667420656d7074790000000000000000000000000000000000005f82015250565b5f6152b7600e836149e7565b91506152c282615283565b602082019050919050565b5f6020820190508181035f8301526152e4816152ab565b9050919050565b7f696e73756666696369656e7420676e61727300000000000000000000000000005f82015250565b5f61531f6012836149e7565b915061532a826152eb565b602082019050919050565b5f6020820190508181035f83015261534c81615313565b9050919050565b7f4f6e6c792063616c6c61626c65206279206f776e6572000000000000000000005f82015250565b5f6153876016836149e7565b915061539282615353565b602082019050919050565b5f6020820190508181035f8301526153b48161537b565b9050919050565b7f636f6e73756d65640000000000000000000000000000000000000000000000005f82015250565b5f6153ef6008836149e7565b91506153fa826153bb565b602082019050919050565b5f6020820190508181035f83015261541c816153e3565b9050919050565b5f6040820190506154365f8301856140f9565b61544360208301846140f9565b9392505050565b5f81905092915050565b50565b5f6154625f8361544a565b915061546d82615454565b5f82019050919050565b5f61548182615457565b9150819050919050565b7f74726561737572792078666572206661696c65640000000000000000000000005f82015250565b5f6154bf6014836149e7565b91506154ca8261548b565b602082019050919050565b5f6020820190508181035f8301526154ec816154b3565b9050919050565b6154fc816142d4565b82525050565b61550b816140f0565b82525050565b61551a8161417e565b82525050565b61552981614271565b82525050565b5f81519050919050565b5f82825260208201905092915050565b8281835e5f83830152505050565b5f601f19601f8301169050919050565b5f6155718261552f565b61557b8185615539565b935061558b818560208601615549565b61559481615557565b840191505092915050565b5f60c083015f8301516155b45f8601826154f3565b5060208301516155c76020860182615502565b5060408301516155da6040860182615511565b5060608301516155ed6060860182615520565b5060808301516156006080860182615520565b5060a083015184820360a08601526156188282615567565b9150508091505092915050565b5f6020820190508181035f83015261563d818461559f565b905092915050565b5f8151905061565381614129565b92915050565b5f6020828403121561566e5761566d614121565b5b5f61567b84828501615645565b91505092915050565b5f61568e826140f0565b9150615699836140f0565b92508282026156a7816140f0565b915082820484148315176156be576156bd614cc3565b5b5092915050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601260045260245ffd5b5f6156fc826140f0565b9150615707836140f0565b925082615717576157166156c5565b5b828204905092915050565b7f43616e6e6f74207472616e7366657220746f2073656c660000000000000000005f82015250565b5f6157566017836149e7565b915061576182615722565b602082019050919050565b5f6020820190508181035f8301526157838161574a565b9050919050565b5f8151905061579881614791565b92915050565b5f602082840312156157b3576157b2614121565b5b5f6157c08482850161578a565b91505092915050565b5f6157d3826140f0565b91506157de836140f0565b9250826157ee576157ed6156c5565b5b828206905092915050565b5f60a08201905061580c5f8301886140f9565b61581960208301876140f9565b61582660408301866146fb565b61583360608301856140f9565b6158406080830184614471565b9695505050505050565b7f73656c656374696f6e206661696c6564000000000000000000000000000000005f82015250565b5f61587e6010836149e7565b91506158898261584a565b602082019050919050565b5f6020820190508181035f8301526158ab81615872565b9050919050565b5f6040820190506158c55f8301856146fb565b6158d260208301846140f9565b9392505050565b6158e281614466565b82525050565b602082015f8201516158fc5f8501826158d9565b50505050565b5f6020820190506159155f8301846158e8565b92915050565b5f6159258261552f565b61592f818561544a565b935061593f818560208601615549565b80840191505092915050565b5f615956828461591b565b91508190509291505056fea264697066735822122054d7d6f7b7dc0d6c5d5fcb96e6285e6d4a66c93d98d77674d3bf9317b16736fa64736f6c634300081e0033";

const V3_ABI = [
  {
    type: "constructor",
    inputs: [
      { name: "vrfCoordinator", type: "address" },
      { name: "_subscriptionId", type: "uint256" },
      { name: "_keyHash", type: "bytes32" },
      { name: "_treasury", type: "address" },
      { name: "initialOwner", type: "address" },
      { name: "_gnarsToken", type: "address" },
      { name: "_gnarsUnit", type: "uint256" },
    ],
  },
  { type: "function", name: "standardPrice", inputs: [], outputs: [{ type: "uint256" }], stateMutability: "view" },
  { type: "function", name: "gnarlyPrice", inputs: [], outputs: [{ type: "uint256" }], stateMutability: "view" },
  { type: "function", name: "epicPrice", inputs: [], outputs: [{ type: "uint256" }], stateMutability: "view" },
  { type: "function", name: "treasury", inputs: [], outputs: [{ type: "address" }], stateMutability: "view" },
  { type: "function", name: "paused", inputs: [], outputs: [{ type: "bool" }], stateMutability: "view" },
  { type: "function", name: "subscriptionId", inputs: [], outputs: [{ type: "uint256" }], stateMutability: "view" },
  { type: "function", name: "keyHash", inputs: [], outputs: [{ type: "bytes32" }], stateMutability: "view" },
  { type: "function", name: "s_vrfCoordinator", inputs: [], outputs: [{ type: "address" }], stateMutability: "view" },
  { type: "function", name: "openBox", inputs: [{ name: "boxType", type: "uint8" }], outputs: [{ type: "uint256" }], stateMutability: "payable" },
  { type: "function", name: "openFlexBox", inputs: [], outputs: [{ type: "uint256" }], stateMutability: "payable" },
  { type: "function", name: "minFlexEth", inputs: [], outputs: [{ type: "uint256" }], stateMutability: "view" },
  {
    type: "function",
    name: "getFlexBalances",
    inputs: [],
    outputs: [{ type: "uint256" }, { type: "uint256" }, { type: "uint256" }],
    stateMutability: "view",
  },
  {
    type: "function",
    name: "getFlexPreview",
    inputs: [{ name: "paid", type: "uint256" }],
    outputs: [{ type: "uint16" }, { type: "uint16" }, { type: "uint256" }],
    stateMutability: "view",
  },
  { type: "function", name: "gnarsToken", inputs: [], outputs: [{ type: "address" }], stateMutability: "view" },
  { type: "function", name: "gnarsUnit", inputs: [], outputs: [{ type: "uint256" }], stateMutability: "view" },
  { type: "function", name: "flexNothingBps", inputs: [], outputs: [{ type: "uint16" }], stateMutability: "view" },
  { type: "function", name: "flexNftBpsMin", inputs: [], outputs: [{ type: "uint16" }], stateMutability: "view" },
  { type: "function", name: "flexNftBpsMax", inputs: [], outputs: [{ type: "uint16" }], stateMutability: "view" },
  { type: "function", name: "flexNftBpsPerEth", inputs: [], outputs: [{ type: "uint32" }], stateMutability: "view" },
  { type: "function", name: "flexGnarsBase", inputs: [], outputs: [{ type: "uint256" }], stateMutability: "view" },
  { type: "function", name: "flexGnarsPerEth", inputs: [], outputs: [{ type: "uint256" }], stateMutability: "view" },
  { type: "function", name: "totalReservedGnars", inputs: [], outputs: [{ type: "uint256" }], stateMutability: "view" },
  { type: "function", name: "setPrices", inputs: [{ type: "uint256" }, { type: "uint256" }, { type: "uint256" }], outputs: [], stateMutability: "nonpayable" },
  { type: "function", name: "setTreasury", inputs: [{ type: "address" }], outputs: [], stateMutability: "nonpayable" },
  { type: "function", name: "setAllowedERC721", inputs: [{ type: "address" }, { type: "bool" }], outputs: [], stateMutability: "nonpayable" },
  {
    type: "function",
    name: "setVrfConfig",
    inputs: [{ type: "uint32" }, { type: "uint16" }, { type: "uint32" }, { type: "bytes32" }],
    outputs: [],
    stateMutability: "nonpayable",
  },
  {
    type: "function",
    name: "setFlexConfig",
    inputs: [
      { type: "uint256" },
      { type: "uint16" },
      { type: "uint16" },
      { type: "uint16" },
      { type: "uint32" },
      { type: "uint256" },
      { type: "uint256" },
    ],
    outputs: [],
    stateMutability: "nonpayable",
  },
  { type: "function", name: "setSubscriptionId", inputs: [{ type: "uint256" }], outputs: [], stateMutability: "nonpayable" },
  { type: "function", name: "pause", inputs: [], outputs: [], stateMutability: "nonpayable" },
  { type: "function", name: "unpause", inputs: [], outputs: [], stateMutability: "nonpayable" },
  { type: "function", name: "depositGnars", inputs: [{ type: "uint256" }], outputs: [], stateMutability: "nonpayable" },
  { type: "function", name: "depositFlexNft", inputs: [{ type: "address" }, { type: "uint256" }], outputs: [], stateMutability: "nonpayable" },
  {
    type: "function",
    name: "depositBundle",
    inputs: [
      { type: "address[]" },
      { type: "uint256[]" },
      { type: "uint256" },
      { type: "uint8" },
      { type: "uint32" },
    ],
    outputs: [],
    stateMutability: "nonpayable",
  },
  {
    type: "function",
    name: "getPoolBalances",
    inputs: [{ type: "uint8" }],
    outputs: [{ type: "uint256" }, { type: "uint256" }, { type: "uint256" }, { type: "uint256" }],
    stateMutability: "view",
  },
];

const V3_BYTECODE = "0x60c060405266470de4df82000060185566b1a2bc2ec5000060195567016345785d8a0000601a5562061a80601e5f6101000a81548163ffffffff021916908363ffffffff1602179055506003601e60046101000a81548161ffff021916908361ffff1602179055506001601e60066101000a81548163ffffffff021916908363ffffffff16021790555065b5e620f48000601f55601460205f6101000a81548161ffff021916908361ffff1602179055506032602060026101000a81548161ffff021916908361ffff1602179055506032602060046101000a81548161ffff021916908361ffff1602179055505f602060066101000a81548163ffffffff021916908363ffffffff160217905550348015610118575f5ffd5b50604051616b88380380616b88833981810160405281019061013a91906107f2565b8633805f5f73ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff16036101ac576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016101a3906108e9565b60405180910390fd5b815f5f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505f73ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff161461022e5761022d8161051860201b60201c565b5b5050505f73ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1603610296576040517fd92e233d00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b8060025f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550505f600260146101000a81548160ff02191690831515021790555060016003819055505f73ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff1603610367576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161035e90610951565b60405180910390fd5b5f73ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff16036103d5576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016103cc906109b9565b60405180910390fd5b5f8111610417576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161040e90610a21565b60405180910390fd5b3373ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff161461045a576104598361064360201b60201c565b5b85601c8190555084601d8190555083601b5f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508173ffffffffffffffffffffffffffffffffffffffff1660808173ffffffffffffffffffffffffffffffffffffffff16815250508060a08181525050806101f46104f29190610a6c565b602181905550806127106105069190610a6c565b60228190555050505050505050610b7d565b3373ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1603610586576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161057d90610af7565b60405180910390fd5b8060015f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508073ffffffffffffffffffffffffffffffffffffffff165f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff167fed8889f560326eb138920d842192f0eb3dd22b4f139c87a2c57538e05bae127860405160405180910390a350565b61065161066360201b60201c565b6106608161051860201b60201c565b50565b5f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16146106f1576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016106e890610b5f565b60405180910390fd5b565b5f5ffd5b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f610720826106f7565b9050919050565b61073081610716565b811461073a575f5ffd5b50565b5f8151905061074b81610727565b92915050565b5f819050919050565b61076381610751565b811461076d575f5ffd5b50565b5f8151905061077e8161075a565b92915050565b5f819050919050565b61079681610784565b81146107a0575f5ffd5b50565b5f815190506107b18161078d565b92915050565b5f6107c1826106f7565b9050919050565b6107d1816107b7565b81146107db575f5ffd5b50565b5f815190506107ec816107c8565b92915050565b5f5f5f5f5f5f5f60e0888a03121561080d5761080c6106f3565b5b5f61081a8a828b0161073d565b975050602061082b8a828b01610770565b965050604061083c8a828b016107a3565b955050606061084d8a828b016107de565b945050608061085e8a828b0161073d565b93505060a061086f8a828b0161073d565b92505060c06108808a828b01610770565b91505092959891949750929550565b5f82825260208201905092915050565b7f43616e6e6f7420736574206f776e657220746f207a65726f00000000000000005f82015250565b5f6108d360188361088f565b91506108de8261089f565b602082019050919050565b5f6020820190508181035f830152610900816108c7565b9050919050565b7f6f776e65723d30000000000000000000000000000000000000000000000000005f82015250565b5f61093b60078361088f565b915061094682610907565b602082019050919050565b5f6020820190508181035f8301526109688161092f565b9050919050565b7f676e6172733d30000000000000000000000000000000000000000000000000005f82015250565b5f6109a360078361088f565b91506109ae8261096f565b602082019050919050565b5f6020820190508181035f8301526109d081610997565b9050919050565b7f756e69743d3000000000000000000000000000000000000000000000000000005f82015250565b5f610a0b60068361088f565b9150610a16826109d7565b602082019050919050565b5f6020820190508181035f830152610a38816109ff565b9050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601160045260245ffd5b5f610a7682610751565b9150610a8183610751565b9250828202610a8f81610751565b91508282048414831517610aa657610aa5610a3f565b5b5092915050565b7f43616e6e6f74207472616e7366657220746f2073656c660000000000000000005f82015250565b5f610ae160178361088f565b9150610aec82610aad565b602082019050919050565b5f6020820190508181035f830152610b0e81610ad5565b9050919050565b7f4f6e6c792063616c6c61626c65206279206f776e6572000000000000000000005f82015250565b5f610b4960168361088f565b9150610b5482610b15565b602082019050919050565b5f6020820190508181035f830152610b7681610b3d565b9050919050565b60805160a051615fab610bdd5f395f8181611d4b01528181613885015281816138bb015281816138f2015261392901525f8181610b530152818161157f01528181611ce6015281816130c2015281816139c70152613d780152615fab5ff3fe6080604052600436106102b0575f3560e01c80637ccfd7fc11610174578063a3bb35ae116100db578063c1e0d23611610094578063d50b37811161006e578063d50b378114610a14578063d858ef4d14610a57578063f0f4426014610a81578063f2fde38b14610aa9576102b7565b8063c1e0d23614610998578063c3aee8d3146109c0578063d0f8e816146109ea576102b7565b8063a3bb35ae146108aa578063a88fe42d146108d4578063ad8b1401146108fc578063ae8da8681461091a578063b0fb162f14610944578063b74593d81461096e576102b7565b80638f3115f51161012d5780638f3115f5146107b057806393079af5146107d85780639b302a8b146108045780639e9db57d1461082e5780639eccacf614610858578063a1bfb30714610882576102b7565b80637ccfd7fc146106cc578063806762a0146106f65780638456cb591461071e578063890daa94146107345780638da5cb5b1461075e5780638ea9811714610788576102b7565b8063399efda3116102185780635332f46a116101d15780635332f46a146105e45780635c975abb1461060e57806361728f391461063857806361d027b3146106625780636a7ebb9d1461068c57806379ba5097146106b6576102b7565b8063399efda3146104c35780633ad423a4146104ed5780633d79ee411461052b5780633f4ba83a1461056a5780634d0af475146105805780634f009378146105a8576102b7565b80631fe543e31161026a5780631fe543e3146103b5578063235069b4146103dd57806324f746971461040557806329ec7f141461042f5780632c96732c1461045f5780633156c7c41461049b576102b7565b8062ab18c8146102bb57806309c1ba2e146102e55780630bac21a01461030f57806318658621146103395780631cd2de0e146103615780631f1525e21461038b576102b7565b366102b757005b5f5ffd5b3480156102c6575f5ffd5b506102cf610ad1565b6040516102dc9190614624565b60405180910390f35b3480156102f0575f5ffd5b506102f9610ae5565b6040516103069190614655565b60405180910390f35b34801561031a575f5ffd5b50610323610aeb565b604051610330919061468c565b60405180910390f35b348015610344575f5ffd5b5061035f600480360381019061035a91906146d7565b610b01565b005b34801561036c575f5ffd5b50610375610bd2565b6040516103829190614655565b60405180910390f35b348015610396575f5ffd5b5061039f610bd8565b6040516103ac9190614655565b60405180910390f35b3480156103c0575f5ffd5b506103db60048036038101906103d69190614763565b610bde565b005b3480156103e8575f5ffd5b5061040360048036038101906103fe9190614847565b610ca2565b005b348015610410575f5ffd5b50610419610d15565b604051610426919061468c565b60405180910390f35b610449600480360381019061044491906148ce565b610d2a565b6040516104569190614655565b60405180910390f35b34801561046a575f5ffd5b5061048560048036038101906104809190614953565b611099565b6040516104929190614998565b60405180910390f35b3480156104a6575f5ffd5b506104c160048036038101906104bc91906149b1565b6110b6565b005b3480156104ce575f5ffd5b506104d76112f8565b6040516104e49190614655565b60405180910390f35b3480156104f8575f5ffd5b50610513600480360381019061050e91906146d7565b6112fe565b604051610522939291906149ef565b60405180910390f35b348015610536575f5ffd5b50610551600480360381019061054c91906148ce565b611330565b6040516105619493929190614a24565b60405180910390f35b348015610575575f5ffd5b5061057e6113ca565b005b34801561058b575f5ffd5b506105a660048036038101906105a19190614abc565b6113dc565b005b3480156105b3575f5ffd5b506105ce60048036038101906105c991906146d7565b61197b565b6040516105db9190614655565b60405180910390f35b3480156105ef575f5ffd5b506105f8611ce4565b6040516106059190614bce565b60405180910390f35b348015610619575f5ffd5b50610622611d08565b60405161062f9190614998565b60405180910390f35b348015610643575f5ffd5b5061064c611d1e565b6040516106599190614bf6565b60405180910390f35b34801561066d575f5ffd5b50610676611d24565b6040516106839190614c2f565b60405180910390f35b348015610697575f5ffd5b506106a0611d49565b6040516106ad9190614655565b60405180910390f35b3480156106c1575f5ffd5b506106ca611d6d565b005b3480156106d7575f5ffd5b506106e0611efc565b6040516106ed919061468c565b60405180910390f35b348015610701575f5ffd5b5061071c600480360381019061071791906146d7565b611f12565b005b348015610729575f5ffd5b506107326121d0565b005b34801561073f575f5ffd5b506107486121e2565b6040516107559190614655565b60405180910390f35b348015610769575f5ffd5b506107726121e8565b60405161077f9190614c57565b60405180910390f35b348015610793575f5ffd5b506107ae60048036038101906107a99190614953565b61220f565b005b3480156107bb575f5ffd5b506107d660048036038101906107d19190614c70565b6123ec565b005b3480156107e3575f5ffd5b506107ec61256b565b6040516107fb93929190614d0d565b60405180910390f35b34801561080f575f5ffd5b50610818612594565b6040516108259190614655565b60405180910390f35b348015610839575f5ffd5b5061084261259a565b60405161084f9190614655565b60405180910390f35b348015610863575f5ffd5b5061086c6125a0565b6040516108799190614d62565b60405180910390f35b34801561088d575f5ffd5b506108a860048036038101906108a39190614da5565b6125c5565b005b3480156108b5575f5ffd5b506108be612673565b6040516108cb9190614655565b60405180910390f35b3480156108df575f5ffd5b506108fa60048036038101906108f59190614de3565b612679565b005b61090461269b565b6040516109119190614655565b60405180910390f35b348015610925575f5ffd5b5061092e612a09565b60405161093b9190614624565b60405180910390f35b34801561094f575f5ffd5b50610958612a1d565b6040516109659190614624565b60405180910390f35b348015610979575f5ffd5b50610982612a31565b60405161098f9190614624565b60405180910390f35b3480156109a3575f5ffd5b506109be60048036038101906109b991906146d7565b612a44565b005b3480156109cb575f5ffd5b506109d4612a8d565b6040516109e19190614655565b60405180910390f35b3480156109f5575f5ffd5b506109fe612a93565b604051610a0b9190614655565b60405180910390f35b348015610a1f575f5ffd5b50610a3a6004803603810190610a3591906146d7565b612a99565b604051610a4e989796959493929190614ea6565b60405180910390f35b348015610a62575f5ffd5b50610a6b612b3d565b604051610a789190614655565b60405180910390f35b348015610a8c575f5ffd5b50610aa76004803603810190610aa29190614f4c565b612b43565b005b348015610ab4575f5ffd5b50610acf6004803603810190610aca9190614953565b612bd1565b005b602060029054906101000a900461ffff1681565b601c5481565b602060069054906101000a900463ffffffff1681565b610b09612be5565b5f8111610b4b576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610b4290614fd1565b60405180910390fd5b610b983330837f000000000000000000000000000000000000000000000000000000000000000073ffffffffffffffffffffffffffffffffffffffff16612c75909392919063ffffffff16565b7fdc43ded692123b8025480c68c7c3231145336450d1fa0dffec50b812c983207a81604051610bc79190614655565b60405180910390a150565b60145481565b60185481565b60025f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610c92573360025f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff166040517f1cf993f4000000000000000000000000000000000000000000000000000000008152600401610c89929190614fef565b60405180910390fd5b610c9d838383612cf7565b505050565b610caa612be5565b83601e5f6101000a81548163ffffffff021916908363ffffffff16021790555082601e60046101000a81548161ffff021916908361ffff16021790555081601e60066101000a81548163ffffffff021916908363ffffffff16021790555080601d8190555050505050565b601e5f9054906101000a900463ffffffff1681565b5f610d3361335e565b610d3b6133a4565b600380811115610d4e57610d4d614e33565b5b826003811115610d6157610d60614e33565b5b03610da1576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610d9890615060565b60405180910390fd5b5f610dab836133e5565b9050803414610def576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610de6906150c8565b60405180910390fd5b5f610df98461345c565b90505f816002015411610e41576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610e3890615130565b60405180910390fd5b5f816001015411610e87576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610e7e90615198565b60405180910390fd5b610e90346134d0565b610e9861359d565b92506040518061010001604052803373ffffffffffffffffffffffffffffffffffffffff168152602001856003811115610ed557610ed4614e33565b5b81526020013481526020015f81526020015f61ffff1681526020015f61ffff1681526020015f151581526020015f151581525060165f8581526020019081526020015f205f820151815f015f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506020820151815f0160146101000a81548160ff02191690836003811115610f8757610f86614e33565b5b021790555060408201518160010155606082015181600201556080820151816003015f6101000a81548161ffff021916908361ffff16021790555060a08201518160030160026101000a81548161ffff021916908361ffff16021790555060c08201518160030160046101000a81548160ff02191690831515021790555060e08201518160030160056101000a81548160ff02191690831515021790555090505083600381111561103b5761103a614e33565b5b3373ffffffffffffffffffffffffffffffffffffffff16847fc319f52a94c56a2b81382fbdb5f1cae77badc44ba465d4c9ceddfb6fadefe237346040516110829190614655565b60405180910390a450506110946136ce565b919050565b6017602052805f5260405f205f915054906101000a900460ff1681565b6110be612be5565b60175f8373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f9054906101000a900460ff16611147576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161113e90615200565b60405180910390fd5b8173ffffffffffffffffffffffffffffffffffffffff166323b872dd3330846040518463ffffffff1660e01b81526004016111849392919061521e565b5f604051808303815f87803b15801561119b575f5ffd5b505af11580156111ad573d5f5f3e3d5ffd5b50505050601360405180606001604052808473ffffffffffffffffffffffffffffffffffffffff1681526020018381526020015f1515815250908060018154018082558091505060019003905f5260205f2090600302015f909190919091505f820151815f015f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550602082015181600101556040820151816002015f6101000a81548160ff0219169083151502179055505050600160145f82825461128d9190615280565b92505081905550808273ffffffffffffffffffffffffffffffffffffffff167f56b10e6266684448e8ae6bf288f6605b21a25123f716c0368942eaac127c75f560016013805490506112df91906152b3565b6040516112ec9190614655565b60405180910390a35050565b60225481565b5f5f5f60205f9054906101000a900461ffff1661131a856136d8565b611323866137ea565b9250925092509193909250565b5f5f5f5f60038081111561134757611346614e33565b5b85600381111561135a57611359614e33565b5b0361139a576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161139190615060565b60405180910390fd5b5f6113a48661345c565b905080600301548160040154826002015483600101549450945094509450509193509193565b6113d2612be5565b6113da613820565b565b6113e4612be5565b6003808111156113f7576113f6614e33565b5b82600381111561140a57611409614e33565b5b0361144a576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161144190615330565b60405180910390fd5b5f8163ffffffff1611611492576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161148990615398565b60405180910390fd5b8484905087879050146114da576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016114d190615400565b60405180910390fd5b5f878790501180156114f0575060038787905011155b61152f576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161152690615468565b60405180910390fd5b61153883613882565b611577576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161156e906154d0565b60405180910390fd5b6115c43330857f000000000000000000000000000000000000000000000000000000000000000073ffffffffffffffffffffffffffffffffffffffff16612c75909392919063ffffffff16565b5f5f90505b87879050811015611719575f8888838181106115e8576115e76154ee565b5b90506020020160208101906115fd9190614953565b905060175f8273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f9054906101000a900460ff16611688576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161167f90615200565b60405180910390fd5b8073ffffffffffffffffffffffffffffffffffffffff166323b872dd33308a8a878181106116b9576116b86154ee565b5b905060200201356040518463ffffffff1660e01b81526004016116de9392919061521e565b5f604051808303815f87803b1580156116f5575f5ffd5b505af1158015611707573d5f5f3e3d5ffd5b505050505080806001019150506115c9565b505f6117248361345c565b9050805f016040518060a001604052808463ffffffff1681526020018681526020018a8a808060200260200160405190810160405280939291908181526020018383602002808284375f81840152601f19601f8201169050808301925050505050505081526020018888808060200260200160405190810160405280939291908181526020018383602002808284375f81840152601f19601f8201169050808301925050505050505081526020015f1515815250908060018154018082558091505060019003905f5260205f2090600502015f909190919091505f820151815f015f6101000a81548163ffffffff021916908363ffffffff1602179055506020820151816001015560408201518160020190805190602001906118489291906144e5565b50606082015181600301908051906020019061186592919061456c565b506080820151816004015f6101000a81548160ff02191690831515021790555050508163ffffffff16816001015f8282546118a09190615280565b925050819055506001816002015f8282546118bb9190615280565b9250508190555083816003015f8282546118d59190615280565b9250508190555087879050816004015f8282546118f29190615280565b925050819055508360235f82825461190a9190615280565b9250508190555082600381111561192457611923614e33565b5b7f435f3dcde66483bed34aaedb4b0f46d649ef23412bcd2a717ae8c8e3ca6f09e685846001855f018054905061195a91906152b3565b6040516119699392919061551b565b60405180910390a25050505050505050565b5f611984612be5565b5f60165f8481526020019081526020015f2090505f73ffffffffffffffffffffffffffffffffffffffff16815f015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1603611a28576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611a1f9061559a565b60405180910390fd5b8060030160049054906101000a900460ff1615611a7a576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611a7190615602565b60405180910390fd5b611a8261359d565b91508060165f8481526020019081526020015f205f82015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff16815f015f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505f820160149054906101000a900460ff16815f0160146101000a81548160ff02191690836003811115611b2f57611b2e614e33565b5b02179055506001820154816001015560028201548160020155600382015f9054906101000a900461ffff16816003015f6101000a81548161ffff021916908361ffff1602179055506003820160029054906101000a900461ffff168160030160026101000a81548161ffff021916908361ffff1602179055506003820160049054906101000a900460ff168160030160046101000a81548160ff0219169083151502179055506003820160059054906101000a900460ff168160030160056101000a81548160ff02191690831515021790555090505060165f8481526020019081526020015f205f5f82015f6101000a81549073ffffffffffffffffffffffffffffffffffffffff02191690555f820160146101000a81549060ff0219169055600182015f9055600282015f9055600382015f6101000a81549061ffff02191690556003820160026101000a81549061ffff02191690556003820160046101000a81549060ff02191690556003820160056101000a81549060ff0219169055505081837ff43c934b0ed8f580991dc90bdf7b93f65f773b924030581946e19281ac4bd90460405160405180910390a350919050565b7f000000000000000000000000000000000000000000000000000000000000000081565b5f600260149054906101000a900460ff16905090565b601d5481565b601b5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b7f000000000000000000000000000000000000000000000000000000000000000081565b60015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614611dfc576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611df39061566a565b60405180910390fd5b5f5f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff169050335f5f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505f60015f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055503373ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e060405160405180910390a350565b601e60069054906101000a900463ffffffff1681565b611f1a612be5565b5f60165f8381526020019081526020015f2090505f73ffffffffffffffffffffffffffffffffffffffff16815f015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1603611fbe576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611fb59061559a565b60405180910390fd5b8060030160049054906101000a900460ff1615612010576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161200790615602565b60405180910390fd5b8060030160059054906101000a900460ff16801561202f57505f601554115b1561204e57600160155f82825461204691906152b3565b925050819055505b5f81600201541180156120675750806002015460245410155b1561208957806002015460245f82825461208191906152b3565b925050819055505b805f0160149054906101000a900460ff1660038111156120ac576120ab614e33565b5b815f015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16837f2ccae9e8e0244a74d74ef1ea042e16aa6596c6cd44c10b3d61dfc74d20e60db384600101546040516121199190614655565b60405180910390a460165f8381526020019081526020015f205f5f82015f6101000a81549073ffffffffffffffffffffffffffffffffffffffff02191690555f820160146101000a81549060ff0219169055600182015f9055600282015f9055600382015f6101000a81549061ffff02191690556003820160026101000a81549061ffff02191690556003820160046101000a81549060ff02191690556003820160056101000a81549060ff021916905550505050565b6121d8612be5565b6121e0613960565b565b60235481565b5f5f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905090565b6122176121e8565b73ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415801561229f575060025f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614155b1561230d57336122ad6121e8565b60025f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff166040517f061db9c100000000000000000000000000000000000000000000000000000000815260040161230493929190615688565b60405180910390fd5b5f73ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1603612372576040517fd92e233d00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b8060025f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055507fd1a6a14209a385a964d036e404cb5cfb71f4000cdb03c9366292430787261be6816040516123e19190614c57565b60405180910390a150565b6123f4612be5565b8361ffff168561ffff16111561243f576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161243690615707565b60405180910390fd5b612710848761244e9190615725565b61ffff161115612493576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161248a906157a4565b60405180910390fd5b86601f819055508560205f6101000a81548161ffff021916908361ffff16021790555084602060026101000a81548161ffff021916908361ffff16021790555083602060046101000a81548161ffff021916908361ffff16021790555082602060066101000a81548163ffffffff021916908363ffffffff16021790555081602181905550806022819055507f08994c1102f01af7c536e89078a408ddaa574f6c43d22abc72e6e1896ffb74808787878787878760405161255a97969594939291906157c2565b60405180910390a150505050505050565b5f5f5f60155460145461257e91906152b3565b6125866139c3565b602354925092509250909192565b60245481565b601a5481565b60025f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6125cd612be5565b8060175f8473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f6101000a81548160ff0219169083151502179055508173ffffffffffffffffffffffffffffffffffffffff167f125943306687bd440a419d5840696e2dec90955322a9f4a7fb614bec0329fe8f826040516126679190614998565b60405180910390a25050565b60155481565b612681612be5565b826018819055508160198190555080601a81905550505050565b5f6126a461335e565b6126ac6133a4565b601f543410156126f1576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016126e890615879565b60405180910390fd5b5f6126fb346136d8565b90505f8161ffff161115612750576015546014541161274f576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401612746906158e1565b60405180910390fd5b5b5f61275a346137ea565b9050806127656139c3565b10156127a6576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161279d90615949565b60405180910390fd5b5f8261ffff1611156127cc57600160155f8282546127c49190615280565b925050819055505b8060245f8282546127dd9190615280565b925050819055506127ed346134d0565b6127f561359d565b92506040518061010001604052803373ffffffffffffffffffffffffffffffffffffffff16815260200160038081111561283257612831614e33565b5b815260200134815260200182815260200160205f9054906101000a900461ffff1661ffff1681526020018361ffff1681526020015f151581526020015f8461ffff1611151581525060165f8581526020019081526020015f205f820151815f015f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506020820151815f0160146101000a81548160ff021916908360038111156128f9576128f8614e33565b5b021790555060408201518160010155606082015181600201556080820151816003015f6101000a81548161ffff021916908361ffff16021790555060a08201518160030160026101000a81548161ffff021916908361ffff16021790555060c08201518160030160046101000a81548160ff02191690831515021790555060e08201518160030160056101000a81548160ff0219169083151502179055509050506003808111156129ad576129ac614e33565b5b3373ffffffffffffffffffffffffffffffffffffffff16847fc319f52a94c56a2b81382fbdb5f1cae77badc44ba465d4c9ceddfb6fadefe237346040516129f49190614655565b60405180910390a45050612a066136ce565b90565b602060049054906101000a900461ffff1681565b601e60049054906101000a900461ffff1681565b60205f9054906101000a900461ffff1681565b612a4c612be5565b80601c819055507f7ea6cbffd5da057ee15cc796ceaf3001805dd6bb292cc55872b305d73517257d81604051612a829190614655565b60405180910390a150565b60215481565b60195481565b6016602052805f5260405f205f91509050805f015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1690805f0160149054906101000a900460ff1690806001015490806002015490806003015f9054906101000a900461ffff16908060030160029054906101000a900461ffff16908060030160049054906101000a900460ff16908060030160059054906101000a900460ff16905088565b601f5481565b612b4b612be5565b80601b5f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508073ffffffffffffffffffffffffffffffffffffffff167f7dae230f18360d76a040c81f050aa14eb9d6dc7901b20fc5d855e2a20fe814d160405160405180910390a250565b612bd9612be5565b612be281613aa0565b50565b5f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614612c73576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401612c6a906159b1565b60405180910390fd5b565b612cf1848573ffffffffffffffffffffffffffffffffffffffff166323b872dd868686604051602401612caa9392919061521e565b604051602081830303815290604052915060e01b6020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff8381831617835250505050613bcb565b50505050565b5f60165f8581526020019081526020015f2090505f73ffffffffffffffffffffffffffffffffffffffff16815f015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1603612d9b576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401612d929061559a565b60405180910390fd5b8060030160049054906101000a900460ff1615612ded576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401612de490615602565b60405180910390fd5b60018160030160046101000a81548160ff021916908315150217905550600380811115612e1d57612e1c614e33565b5b815f0160149054906101000a900460ff166003811115612e4057612e3f614e33565b5b03612f1a57612e69848285855f818110612e5d57612e5c6154ee565b5b90506020020135613c60565b60165f8581526020019081526020015f205f5f82015f6101000a81549073ffffffffffffffffffffffffffffffffffffffff02191690555f820160146101000a81549060ff0219169055600182015f9055600282015f9055600382015f6101000a81549061ffff02191690556003820160026101000a81549061ffff02191690556003820160046101000a81549060ff02191690556003820160056101000a81549060ff0219169055505050613359565b5f612f34825f0160149054906101000a900460ff1661345c565b90505f612f5a8286865f818110612f4e57612f4d6154ee565b5b90506020020135613ef5565b90505f825f018281548110612f7257612f716154ee565b5b905f5260205f2090600502019050806004015f9054906101000a900460ff1615612fd1576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401612fc890615a19565b60405180910390fd5b6001816004015f6101000a81548160ff0219169083151502179055506001836002015f82825461300191906152b3565b92505081905550805f015f9054906101000a900463ffffffff1663ffffffff16836001015f82825461303391906152b3565b925050819055508060010154836003015f82825461305191906152b3565b925050819055508060020180549050836004015f82825461307291906152b3565b92505081905550806001015460235f82825461308e91906152b3565b92505081905550613106845f015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1682600101547f000000000000000000000000000000000000000000000000000000000000000073ffffffffffffffffffffffffffffffffffffffff16613ff09092919063ffffffff16565b5f5f90505b816002018054905081101561320e578160020181815481106131305761312f6154ee565b5b905f5260205f20015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166342842e0e30875f015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff168560030185815481106131ad576131ac6154ee565b5b905f5260205f2001546040518463ffffffff1660e01b81526004016131d49392919061521e565b5f604051808303815f87803b1580156131eb575f5ffd5b505af11580156131fd573d5f5f3e3d5ffd5b50505050808060010191505061310b565b50835f0160149054906101000a900460ff16600381111561323257613231614e33565b5b845f015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16887f87cd9b8e9082bdac2da7d9dba51c5b244d9c3b99891b84b12ee18cb674cd31818460010154866040516132a1929190615a37565b60405180910390a460165f8881526020019081526020015f205f5f82015f6101000a81549073ffffffffffffffffffffffffffffffffffffffff02191690555f820160146101000a81549060ff0219169055600182015f9055600282015f9055600382015f6101000a81549061ffff02191690556003820160026101000a81549061ffff02191690556003820160046101000a81549060ff02191690556003820160056101000a81549060ff02191690555050505050505b505050565b60026003540361339a576040517f3ee5aeb500000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b6002600381905550565b6133ac611d08565b156133e3576040517fd93c066500000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b565b5f5f60038111156133f9576133f8614e33565b5b82600381111561340c5761340b614e33565b5b0361341b576018549050613457565b6001600381111561342f5761342e614e33565b5b82600381111561344257613441614e33565b5b03613451576019549050613457565b601a5490505b919050565b5f5f60038111156134705761346f614e33565b5b82600381111561348357613482614e33565b5b0361349157600490506134cb565b600160038111156134a5576134a4614e33565b5b8260038111156134b8576134b7614e33565b5b036134c657600990506134cb565b600e90505b919050565b5f601b5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168260405161351690615a8b565b5f6040518083038185875af1925050503d805f8114613550576040519150601f19603f3d011682016040523d82523d5f602084013e613555565b606091505b5050905080613599576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161359090615ae9565b60405180910390fd5b5050565b5f5f6040518060c00160405280601d548152602001601c548152602001601e60049054906101000a900461ffff1661ffff168152602001601e5f9054906101000a900463ffffffff1663ffffffff168152602001601e60069054906101000a900463ffffffff1663ffffffff16815260200161362960405180602001604052806001151581525061406f565b815250905060025f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16639b1c385e826040518263ffffffff1660e01b81526004016136889190615c39565b6020604051808303815f875af11580156136a4573d5f5f3e3d5ffd5b505050506040513d601f19601f820116820180604052508101906136c89190615c6d565b91505090565b6001600381905550565b5f5f602060049054906101000a900461ffff1661ffff16036136fc575f90506137e5565b601f548211158061372457505f602060069054906101000a900463ffffffff1663ffffffff16145b1561374157602060029054906101000a900461ffff1690506137e5565b5f670de0b6b3a7640000602060069054906101000a900463ffffffff1663ffffffff16601f548561377291906152b3565b61377c9190615c98565b6137869190615d06565b90505f81602060029054906101000a900461ffff1661ffff166137a99190615280565b9050602060049054906101000a900461ffff1661ffff168111156137df57602060049054906101000a900461ffff1661ffff1690505b80925050505b919050565b5f670de0b6b3a7640000602254836138029190615c98565b61380c9190615d06565b6021546138199190615280565b9050919050565b613828614107565b5f600260146101000a81548160ff0219169083151502179055507f5db9ee0a495bf2e6ff9c91a7834c1ba4fdd244a5e8aa4e537bd38aeae4b073aa61386b614147565b6040516138789190614c57565b60405180910390a1565b5f7f00000000000000000000000000000000000000000000000000000000000000006103e86138b19190615c98565b8214806138ea57507f00000000000000000000000000000000000000000000000000000000000000006113886138e79190615c98565b82145b8061392157507f000000000000000000000000000000000000000000000000000000000000000061271061391e9190615c98565b82145b8061395957507f0000000000000000000000000000000000000000000000000000000000000000620186a06139569190615c98565b82145b9050919050565b6139686133a4565b6001600260146101000a81548160ff0219169083151502179055507f62e78cea01bee320cd4e420270b5ea74000d11b0c9f74754ebdbfc544b05a2586139ac614147565b6040516139b99190614c57565b60405180910390a1565b5f5f7f000000000000000000000000000000000000000000000000000000000000000073ffffffffffffffffffffffffffffffffffffffff166370a08231306040518263ffffffff1660e01b8152600401613a1e9190614c57565b602060405180830381865afa158015613a39573d5f5f3e3d5ffd5b505050506040513d601f19601f82011682018060405250810190613a5d9190615c6d565b9050602454602354613a6f9190615280565b8111613a7e575f915050613a9d565b60245460235482613a8f91906152b3565b613a9991906152b3565b9150505b90565b3373ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1603613b0e576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401613b0590615d80565b60405180910390fd5b8060015f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508073ffffffffffffffffffffffffffffffffffffffff165f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff167fed8889f560326eb138920d842192f0eb3dd22b4f139c87a2c57538e05bae127860405160405180910390a350565b5f613bf5828473ffffffffffffffffffffffffffffffffffffffff1661414e90919063ffffffff16565b90505f815114158015613c19575080806020019051810190613c179190615db2565b155b15613c5b57826040517f5274afe7000000000000000000000000000000000000000000000000000000008152600401613c529190614c57565b60405180910390fd5b505050565b5f61271082613c6f9190615ddd565b90505f6127108084613c819190615d06565b613c8b9190615ddd565b90505f6127108085613c9d9190615d06565b613ca79190615d06565b90505f856003015f9054906101000a900461ffff1661ffff16841090505f81158015613ce857508660030160029054906101000a900461ffff1661ffff1684105b90505f5f90505f5f90505f5f9050896002015460245f828254613d0b91906152b3565b925050819055508960030160059054906101000a900460ff1615613d4357600160155f828254613d3b91906152b3565b925050819055505b84613dbd5789600201549250613dbc8a5f015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff16847f000000000000000000000000000000000000000000000000000000000000000073ffffffffffffffffffffffffffffffffffffffff16613ff09092919063ffffffff16565b5b8315613e6b575f613dcd87614163565b509050805f01519250806020015191508273ffffffffffffffffffffffffffffffffffffffff166342842e0e308d5f015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff16856040518463ffffffff1660e01b8152600401613e3c9392919061521e565b5f604051808303815f87803b158015613e53575f5ffd5b505af1158015613e65573d5f5f3e3d5ffd5b50505050505b895f015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168b7fe1fc2e622d9cbf4b1f97e6ebda4067d5dbd68c6c1d0a78bf2bda7d1e0c5246768c600101548686868b604051613ee0959493929190615e0d565b60405180910390a35050505050505050505050565b5f5f836001015483613f079190615ddd565b90505f5f90505f855f018054905090505f5f90505b81811015613fae575f875f018281548110613f3a57613f396154ee565b5b905f5260205f2090600502019050806004015f9054906101000a900460ff1615613f645750613fa1565b805f015f9054906101000a900463ffffffff1663ffffffff1684613f889190615280565b935083851015613f9f578195505050505050613fea565b505b8080600101915050613f1c565b506040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401613fe190615ea8565b60405180910390fd5b92915050565b61406a838473ffffffffffffffffffffffffffffffffffffffff1663a9059cbb8585604051602401614023929190615ec6565b604051602081830303815290604052915060e01b6020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff8381831617835250505050613bcb565b505050565b60607f92fd13387c7fe7befbc38d303d6468778fb9731bc4583f17d92989c6fcfdeaaa826040516024016140a39190615f16565b604051602081830303815290604052907bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff83818316178352505050509050919050565b61410f611d08565b614145576040517f8dfc202b00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b565b5f33905090565b606061415b83835f61434b565b905092915050565b61416b6145b7565b5f5f601454116141b0576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016141a7906158e1565b60405180910390fd5b5f601454846141bf9190615ddd565b90505f5f90505f60138054905090505f5f90505b8181101561430a575f601382815481106141f0576141ef6154ee565b5b905f5260205f2090600302019050806002015f9054906101000a900460ff161561421a57506142fd565b8484036142ec576001816002015f6101000a81548160ff021916908315150217905550600160145f82825461424f91906152b3565b925050819055508082816040518060600160405290815f82015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200160018201548152602001600282015f9054906101000a900460ff1615151515815250509150965096505050505050614346565b6001846142f99190615280565b9350505b80806001019150506141d3565b506040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161433d90615ea8565b60405180910390fd5b915091565b60608147101561439257306040517fcd7860590000000000000000000000000000000000000000000000000000000081526004016143899190614c57565b60405180910390fd5b5f5f8573ffffffffffffffffffffffffffffffffffffffff1684866040516143ba9190615f5f565b5f6040518083038185875af1925050503d805f81146143f4576040519150601f19603f3d011682016040523d82523d5f602084013e6143f9565b606091505b5091509150614409868383614414565b925050509392505050565b60608261442957614424826144a1565b614499565b5f825114801561444f57505f8473ffffffffffffffffffffffffffffffffffffffff163b145b1561449157836040517f9996b3150000000000000000000000000000000000000000000000000000000081526004016144889190614c57565b60405180910390fd5b81905061449a565b5b9392505050565b5f815111156144b35780518082602001fd5b6040517f1425ea4200000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b828054828255905f5260205f2090810192821561455b579160200282015b8281111561455a578251825f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555091602001919060010190614503565b5b50905061456891906145ed565b5090565b828054828255905f5260205f209081019282156145a6579160200282015b828111156145a557825182559160200191906001019061458a565b5b5090506145b391906145ed565b5090565b60405180606001604052805f73ffffffffffffffffffffffffffffffffffffffff1681526020015f81526020015f151581525090565b5b80821115614604575f815f9055506001016145ee565b5090565b5f61ffff82169050919050565b61461e81614608565b82525050565b5f6020820190506146375f830184614615565b92915050565b5f819050919050565b61464f8161463d565b82525050565b5f6020820190506146685f830184614646565b92915050565b5f63ffffffff82169050919050565b6146868161466e565b82525050565b5f60208201905061469f5f83018461467d565b92915050565b5f5ffd5b5f5ffd5b6146b68161463d565b81146146c0575f5ffd5b50565b5f813590506146d1816146ad565b92915050565b5f602082840312156146ec576146eb6146a5565b5b5f6146f9848285016146c3565b91505092915050565b5f5ffd5b5f5ffd5b5f5ffd5b5f5f83601f84011261472357614722614702565b5b8235905067ffffffffffffffff8111156147405761473f614706565b5b60208301915083602082028301111561475c5761475b61470a565b5b9250929050565b5f5f5f6040848603121561477a576147796146a5565b5b5f614787868287016146c3565b935050602084013567ffffffffffffffff8111156147a8576147a76146a9565b5b6147b48682870161470e565b92509250509250925092565b6147c98161466e565b81146147d3575f5ffd5b50565b5f813590506147e4816147c0565b92915050565b6147f381614608565b81146147fd575f5ffd5b50565b5f8135905061480e816147ea565b92915050565b5f819050919050565b61482681614814565b8114614830575f5ffd5b50565b5f813590506148418161481d565b92915050565b5f5f5f5f6080858703121561485f5761485e6146a5565b5b5f61486c878288016147d6565b945050602061487d87828801614800565b935050604061488e878288016147d6565b925050606061489f87828801614833565b91505092959194509250565b600481106148b7575f5ffd5b50565b5f813590506148c8816148ab565b92915050565b5f602082840312156148e3576148e26146a5565b5b5f6148f0848285016148ba565b91505092915050565b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f614922826148f9565b9050919050565b61493281614918565b811461493c575f5ffd5b50565b5f8135905061494d81614929565b92915050565b5f60208284031215614968576149676146a5565b5b5f6149758482850161493f565b91505092915050565b5f8115159050919050565b6149928161497e565b82525050565b5f6020820190506149ab5f830184614989565b92915050565b5f5f604083850312156149c7576149c66146a5565b5b5f6149d48582860161493f565b92505060206149e5858286016146c3565b9150509250929050565b5f606082019050614a025f830186614615565b614a0f6020830185614615565b614a1c6040830184614646565b949350505050565b5f608082019050614a375f830187614646565b614a446020830186614646565b614a516040830185614646565b614a5e6060830184614646565b95945050505050565b5f5f83601f840112614a7c57614a7b614702565b5b8235905067ffffffffffffffff811115614a9957614a98614706565b5b602083019150836020820283011115614ab557614ab461470a565b5b9250929050565b5f5f5f5f5f5f5f60a0888a031215614ad757614ad66146a5565b5b5f88013567ffffffffffffffff811115614af457614af36146a9565b5b614b008a828b01614a67565b9750975050602088013567ffffffffffffffff811115614b2357614b226146a9565b5b614b2f8a828b0161470e565b95509550506040614b428a828b016146c3565b9350506060614b538a828b016148ba565b9250506080614b648a828b016147d6565b91505092959891949750929550565b5f819050919050565b5f614b96614b91614b8c846148f9565b614b73565b6148f9565b9050919050565b5f614ba782614b7c565b9050919050565b5f614bb882614b9d565b9050919050565b614bc881614bae565b82525050565b5f602082019050614be15f830184614bbf565b92915050565b614bf081614814565b82525050565b5f602082019050614c095f830184614be7565b92915050565b5f614c19826148f9565b9050919050565b614c2981614c0f565b82525050565b5f602082019050614c425f830184614c20565b92915050565b614c5181614918565b82525050565b5f602082019050614c6a5f830184614c48565b92915050565b5f5f5f5f5f5f5f60e0888a031215614c8b57614c8a6146a5565b5b5f614c988a828b016146c3565b9750506020614ca98a828b01614800565b9650506040614cba8a828b01614800565b9550506060614ccb8a828b01614800565b9450506080614cdc8a828b016147d6565b93505060a0614ced8a828b016146c3565b92505060c0614cfe8a828b016146c3565b91505092959891949750929550565b5f606082019050614d205f830186614646565b614d2d6020830185614646565b614d3a6040830184614646565b949350505050565b5f614d4c82614b9d565b9050919050565b614d5c81614d42565b82525050565b5f602082019050614d755f830184614d53565b92915050565b614d848161497e565b8114614d8e575f5ffd5b50565b5f81359050614d9f81614d7b565b92915050565b5f5f60408385031215614dbb57614dba6146a5565b5b5f614dc88582860161493f565b9250506020614dd985828601614d91565b9150509250929050565b5f5f5f60608486031215614dfa57614df96146a5565b5b5f614e07868287016146c3565b9350506020614e18868287016146c3565b9250506040614e29868287016146c3565b9150509250925092565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52602160045260245ffd5b60048110614e7157614e70614e33565b5b50565b5f819050614e8182614e60565b919050565b5f614e9082614e74565b9050919050565b614ea081614e86565b82525050565b5f61010082019050614eba5f83018b614c48565b614ec7602083018a614e97565b614ed46040830189614646565b614ee16060830188614646565b614eee6080830187614615565b614efb60a0830186614615565b614f0860c0830185614989565b614f1560e0830184614989565b9998505050505050505050565b614f2b81614c0f565b8114614f35575f5ffd5b50565b5f81359050614f4681614f22565b92915050565b5f60208284031215614f6157614f606146a5565b5b5f614f6e84828501614f38565b91505092915050565b5f82825260208201905092915050565b7f616d6f756e743d300000000000000000000000000000000000000000000000005f82015250565b5f614fbb600883614f77565b9150614fc682614f87565b602082019050919050565b5f6020820190508181035f830152614fe881614faf565b9050919050565b5f6040820190506150025f830185614c48565b61500f6020830184614c48565b9392505050565b7f75736520666c65780000000000000000000000000000000000000000000000005f82015250565b5f61504a600883614f77565b915061505582615016565b602082019050919050565b5f6020820190508181035f8301526150778161503e565b9050919050565b7f77726f6e672070726963650000000000000000000000000000000000000000005f82015250565b5f6150b2600b83614f77565b91506150bd8261507e565b602082019050919050565b5f6020820190508181035f8301526150df816150a6565b9050919050565b7f656d70747920706f6f6c000000000000000000000000000000000000000000005f82015250565b5f61511a600a83614f77565b9150615125826150e6565b602082019050919050565b5f6020820190508181035f8301526151478161510e565b9050919050565b7f6e6f2077656967687400000000000000000000000000000000000000000000005f82015250565b5f615182600983614f77565b915061518d8261514e565b602082019050919050565b5f6020820190508181035f8301526151af81615176565b9050919050565b7f657263373231206e6f7420616c6c6f77656400000000000000000000000000005f82015250565b5f6151ea601283614f77565b91506151f5826151b6565b602082019050919050565b5f6020820190508181035f830152615217816151de565b9050919050565b5f6060820190506152315f830186614c48565b61523e6020830185614c48565b61524b6040830184614646565b949350505050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601160045260245ffd5b5f61528a8261463d565b91506152958361463d565b92508282019050808211156152ad576152ac615253565b5b92915050565b5f6152bd8261463d565b91506152c88361463d565b92508282039050818111156152e0576152df615253565b5b92915050565b7f666c65782075736573206f776e20706f6f6c00000000000000000000000000005f82015250565b5f61531a601283614f77565b9150615325826152e6565b602082019050919050565b5f6020820190508181035f8301526153478161530e565b9050919050565b7f7765696768743d300000000000000000000000000000000000000000000000005f82015250565b5f615382600883614f77565b915061538d8261534e565b602082019050919050565b5f6020820190508181035f8301526153af81615376565b9050919050565b7f6c656e677468206d69736d6174636800000000000000000000000000000000005f82015250565b5f6153ea600f83614f77565b91506153f5826153b6565b602082019050919050565b5f6020820190508181035f830152615417816153de565b9050919050565b7f6e667420636f756e7400000000000000000000000000000000000000000000005f82015250565b5f615452600983614f77565b915061545d8261541e565b602082019050919050565b5f6020820190508181035f83015261547f81615446565b9050919050565b7f62616420676e61727320616d6f756e74000000000000000000000000000000005f82015250565b5f6154ba601083614f77565b91506154c582615486565b602082019050919050565b5f6020820190508181035f8301526154e7816154ae565b9050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52603260045260245ffd5b5f60608201905061552e5f830186614646565b61553b602083018561467d565b6155486040830184614646565b949350505050565b7f756e6b6e6f776e207265717565737400000000000000000000000000000000005f82015250565b5f615584600f83614f77565b915061558f82615550565b602082019050919050565b5f6020820190508181035f8301526155b181615578565b9050919050565b7f616c72656164792066756c66696c6c65640000000000000000000000000000005f82015250565b5f6155ec601183614f77565b91506155f7826155b8565b602082019050919050565b5f6020820190508181035f830152615619816155e0565b9050919050565b7f4d7573742062652070726f706f736564206f776e6572000000000000000000005f82015250565b5f615654601683614f77565b915061565f82615620565b602082019050919050565b5f6020820190508181035f83015261568181615648565b9050919050565b5f60608201905061569b5f830186614c48565b6156a86020830185614c48565b6156b56040830184614c48565b949350505050565b7f626164206e66742072616e6765000000000000000000000000000000000000005f82015250565b5f6156f1600d83614f77565b91506156fc826156bd565b602082019050919050565b5f6020820190508181035f83015261571e816156e5565b9050919050565b5f61572f82614608565b915061573a83614608565b9250828201905061ffff81111561575457615753615253565b5b92915050565b7f62616420627073000000000000000000000000000000000000000000000000005f82015250565b5f61578e600783614f77565b91506157998261575a565b602082019050919050565b5f6020820190508181035f8301526157bb81615782565b9050919050565b5f60e0820190506157d55f83018a614646565b6157e26020830189614615565b6157ef6040830188614615565b6157fc6060830187614615565b615809608083018661467d565b61581660a0830185614646565b61582360c0830184614646565b98975050505050505050565b7f6d696e20666c65780000000000000000000000000000000000000000000000005f82015250565b5f615863600883614f77565b915061586e8261582f565b602082019050919050565b5f6020820190508181035f83015261589081615857565b9050919050565b7f666c6578206e667420656d7074790000000000000000000000000000000000005f82015250565b5f6158cb600e83614f77565b91506158d682615897565b602082019050919050565b5f6020820190508181035f8301526158f8816158bf565b9050919050565b7f696e73756666696369656e7420676e61727300000000000000000000000000005f82015250565b5f615933601283614f77565b915061593e826158ff565b602082019050919050565b5f6020820190508181035f83015261596081615927565b9050919050565b7f4f6e6c792063616c6c61626c65206279206f776e6572000000000000000000005f82015250565b5f61599b601683614f77565b91506159a682615967565b602082019050919050565b5f6020820190508181035f8301526159c88161598f565b9050919050565b7f636f6e73756d65640000000000000000000000000000000000000000000000005f82015250565b5f615a03600883614f77565b9150615a0e826159cf565b602082019050919050565b5f6020820190508181035f830152615a30816159f7565b9050919050565b5f604082019050615a4a5f830185614646565b615a576020830184614646565b9392505050565b5f81905092915050565b50565b5f615a765f83615a5e565b9150615a8182615a68565b5f82019050919050565b5f615a9582615a6b565b9150819050919050565b7f74726561737572792078666572206661696c65640000000000000000000000005f82015250565b5f615ad3601483614f77565b9150615ade82615a9f565b602082019050919050565b5f6020820190508181035f830152615b0081615ac7565b9050919050565b615b1081614814565b82525050565b615b1f8161463d565b82525050565b615b2e81614608565b82525050565b615b3d8161466e565b82525050565b5f81519050919050565b5f82825260208201905092915050565b8281835e5f83830152505050565b5f601f19601f8301169050919050565b5f615b8582615b43565b615b8f8185615b4d565b9350615b9f818560208601615b5d565b615ba881615b6b565b840191505092915050565b5f60c083015f830151615bc85f860182615b07565b506020830151615bdb6020860182615b16565b506040830151615bee6040860182615b25565b506060830151615c016060860182615b34565b506080830151615c146080860182615b34565b5060a083015184820360a0860152615c2c8282615b7b565b9150508091505092915050565b5f6020820190508181035f830152615c518184615bb3565b905092915050565b5f81519050615c67816146ad565b92915050565b5f60208284031215615c8257615c816146a5565b5b5f615c8f84828501615c59565b91505092915050565b5f615ca28261463d565b9150615cad8361463d565b9250828202615cbb8161463d565b91508282048414831517615cd257615cd1615253565b5b5092915050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601260045260245ffd5b5f615d108261463d565b9150615d1b8361463d565b925082615d2b57615d2a615cd9565b5b828204905092915050565b7f43616e6e6f74207472616e7366657220746f2073656c660000000000000000005f82015250565b5f615d6a601783614f77565b9150615d7582615d36565b602082019050919050565b5f6020820190508181035f830152615d9781615d5e565b9050919050565b5f81519050615dac81614d7b565b92915050565b5f60208284031215615dc757615dc66146a5565b5b5f615dd484828501615d9e565b91505092915050565b5f615de78261463d565b9150615df28361463d565b925082615e0257615e01615cd9565b5b828206905092915050565b5f60a082019050615e205f830188614646565b615e2d6020830187614646565b615e3a6040830186614c48565b615e476060830185614646565b615e546080830184614989565b9695505050505050565b7f73656c656374696f6e206661696c6564000000000000000000000000000000005f82015250565b5f615e92601083614f77565b9150615e9d82615e5e565b602082019050919050565b5f6020820190508181035f830152615ebf81615e86565b9050919050565b5f604082019050615ed95f830185614c48565b615ee66020830184614646565b9392505050565b615ef68161497e565b82525050565b602082015f820151615f105f850182615eed565b50505050565b5f602082019050615f295f830184615efc565b92915050565b5f615f3982615b43565b615f438185615a5e565b9350615f53818560208601615b5d565b80840191505092915050565b5f615f6a8284615f2f565b91508190509291505056fea264697066735822122062a7c0db0b7d2ba9f025769f0243a20a78907ab338f10f014b4e270e7fbecfa364736f6c634300081e0033";

const CONTRACTS = {
  v1: { label: "V1", abi: V1_ABI, bytecode: V1_BYTECODE },
  v2: { label: "V2", abi: V2_ABI, bytecode: V2_BYTECODE },
  v3: { label: "V3", abi: V3_ABI, bytecode: V3_BYTECODE },
};

function App() {
  const { address, isConnected } = useAccount();
  const [activeTab, setActiveTab] = useState("test");
  const [contractKey, setContractKey] = useState("v2");
  const [contractAddress, setContractAddress] = useState(DEFAULT_CONTRACTS.v2);
  const [form, setForm] = useState({
    coordinator: DEFAULTS.coordinator,
    subId: DEFAULTS.subId,
    keyHash: DEFAULTS.keyHash,
    treasury: "0x8Bf5941d27176242745B716251943Ae4892a3C26",
    owner: DEFAULTS.owner,
    gnarsToken: "0x0cf0c3b75d522290d7d12c74d7f1f0cc47ccb23b",
    gnarsUnit: "1000000000000000000",
    gasLimit: "12000000",
  });
  const [treasuryPreset, setTreasuryPreset] = useState("test");
  const [status, setStatus] = useState("Status: idle");
  const [readings, setReadings] = useState({
    standardPrice: null,
    gnarlyPrice: null,
    epicPrice: null,
    treasury: null,
    paused: null,
    subscriptionId: null,
    keyHash: null,
    coordinator: null,
    minFlexEth: null,
    flexBalances: null,
    flexPreview: null,
    gnarsToken: null,
    gnarsUnit: null,
    flexNothingBps: null,
    flexNftBps: null,
    flexNftBpsMin: null,
    flexNftBpsMax: null,
    flexNftBpsPerEth: null,
    flexGnarsBase: null,
    flexGnarsPerEth: null,
    totalReservedGnars: null,
  });
  const [openBoxType, setOpenBoxType] = useState("0");
  const [flexEth, setFlexEth] = useState("0.0002");
  const [openStatus, setOpenStatus] = useState("OpenBox: idle");
  const [debugLog, setDebugLog] = useState([]);
  const [adminStatus, setAdminStatus] = useState("Admin: idle");
  const [poolBalances, setPoolBalances] = useState(null);
  const [poolBalancesAll, setPoolBalancesAll] = useState(null);
  const [adminForm, setAdminForm] = useState({
    standardPriceEth: "0.0001",
    gnarlyPriceEth: "0.0002",
    epicPriceEth: "0.0003",
    newTreasury: "0x8Bf5941d27176242745B716251943Ae4892a3C26",
    allowedNft: "",
    allowedValue: "true",
    callbackGasLimit: "400000",
    requestConfirmations: "3",
    numWords: "1",
    vrfKeyHash: DEFAULTS.keyHash,
    minFlexEth: "0.0002",
    flexNothingBps: "20",
    flexNftBps: "50",
    flexNftBpsMin: "50",
    flexNftBpsMax: "50",
    flexNftBpsPerEth: "0",
    flexGnarsBase: "500",
    flexGnarsPerEth: "10000",
    newSubscriptionId: DEFAULTS.subId,
    approveErc20Token: "0x0cf0c3b75d522290d7d12c74d7f1f0cc47ccb23b",
    approveErc20Spender: "",
    approveErc20Amount: "1000",
    approveErc721Token: "",
    approveErc721Spender: "",
    approveErc721TokenId: "",
    approveErc721Operator: "",
    approveErc721Approved: "true",
    depositGnarsAmount: "1000",
    flexNftAddress: "",
    flexNftTokenId: "",
    bundleBoxType: "0",
    bundleWeight: "1",
    bundleGnarsAmount: "1000",
    bundleNftContracts: "",
    bundleNftIds: "",
    poolBoxType: "0",
  });

  const activeContract = CONTRACTS[contractKey];
  const deployIssues = useMemo(() => {
    const issues = [];
    if (!form.coordinator || !ethers.isAddress(form.coordinator)) issues.push("Coordinator");
    if (!form.subId) issues.push("Subscription ID");
    if (!form.keyHash || form.keyHash.length !== 66) issues.push("Key Hash");
    if (!form.treasury || !ethers.isAddress(form.treasury)) issues.push("Treasury");
    if (!form.owner || !ethers.isAddress(form.owner)) issues.push("Initial Owner");
    if (contractKey !== "v1") {
      if (!form.gnarsToken || !ethers.isAddress(form.gnarsToken)) issues.push("GNARS Token");
      if (!form.gnarsUnit) issues.push("GNARS Unit");
    }
    return issues;
  }, [form, contractKey]);

  useEffect(() => {
    setContractAddress(DEFAULT_CONTRACTS[contractKey] || "");
  }, [contractKey]);
  const isReady = useMemo(() => {
    const baseReady = form.coordinator && form.subId && form.keyHash && form.treasury && form.owner;
    if (contractKey === "v1") return baseReady;
    return baseReady && form.gnarsToken && form.gnarsUnit;
  }, [form, contractKey]);

  const onChange = (e) => {
    const { name, value } = e.target;
    setForm((prev) => ({ ...prev, [name]: value }));
  };

  const onTreasuryPresetChange = (e) => {
    const { value } = e.target;
    setTreasuryPreset(value);
    if (value === "test") {
      setForm((prev) => ({ ...prev, treasury: "0x8Bf5941d27176242745B716251943Ae4892a3C26" }));
    } else if (value === "gnars") {
      setForm((prev) => ({ ...prev, treasury: "0x72ad986ebac0246d2b3c565ab2a1ce3a14ce6f88" }));
    }
  };

  const log = (msg) => {
    setDebugLog((prev) => [...prev, `[${new Date().toISOString()}] ${msg}`].slice(-200));
  };

  const handleAdminChange = (e) => {
    const { name, value } = e.target;
    setAdminForm((prev) => ({ ...prev, [name]: value }));
  };

  const parseCsv = (value) =>
    value
      .split(",")
      .map((item) => item.trim())
      .filter((item) => item.length);

  const parseCsvNumbers = (value) => parseCsv(value).map((item) => BigInt(item));

  const parseWhole = (label, value) => {
    if (!value || !/^\d+$/.test(value)) {
      throw new Error(`${label} must be a whole number`);
    }
    return BigInt(value);
  };

  const formatGnars = (value) => {
    if (value === null || value === undefined) return "-";
    const raw = BigInt(value);
    const unit = readings.gnarsUnit ?? form.gnarsUnit;
    if (!unit) return raw.toString();
    const divisor = BigInt(unit);
    const tokens = divisor > 0n ? (raw / divisor).toString() : "-";
    return `${raw.toString()} wei (${tokens} tokens)`;
  };

  const toGnarsWei = (label, value) => {
    const unit = readings.gnarsUnit ?? form.gnarsUnit;
    if (!unit) throw new Error("GNARS unit not loaded");
    return parseWhole(label, value) * BigInt(unit);
  };

  const getReadContract = async () => {
    if (!window.ethereum) throw new Error("No injected wallet found.");
    const provider = new ethers.BrowserProvider(window.ethereum);
    const network = await provider.getNetwork();
    if (network.chainId !== 8453n) {
      throw new Error(`Wrong network. Switch to Base mainnet (8453). Current: ${network.chainId}`);
    }
    return new ethers.Contract(contractAddress, activeContract.abi, provider);
  };

  const getSignerContract = async () => {
    if (!window.ethereum) throw new Error("No injected wallet found.");
    const provider = new ethers.BrowserProvider(window.ethereum);
    const network = await provider.getNetwork();
    if (network.chainId !== 8453n) {
      throw new Error(`Wrong network. Switch to Base mainnet (8453). Current: ${network.chainId}`);
    }
    const signer = await provider.getSigner();
    return new ethers.Contract(contractAddress, activeContract.abi, signer);
  };

  const submitAdminTx = async (label, fn) => {
    try {
      setAdminStatus(`Admin: ${label} submitting...`);
      log(`admin: ${label} submit`);
      const tx = await fn();
      log(`admin: ${label} tx ${tx.hash}`);
      setAdminStatus(`Admin: ${label} submitted ${tx.hash}`);
      await tx.wait();
      log(`admin: ${label} confirmed ${tx.hash}`);
      setAdminStatus(`Admin: ${label} confirmed ${tx.hash}`);
    } catch (err) {
      const msg = err.shortMessage || err.reason || err.message || err;
      log(`admin: ${label} error ${msg}`);
      setAdminStatus(`Admin: ${label} error ${msg}`);
    }
  };

  const setPrices = async () =>
    submitAdminTx("setPrices", async () => {
      const contract = await getSignerContract();
      const standard = ethers.parseEther(adminForm.standardPriceEth || "0");
      const gnarly = ethers.parseEther(adminForm.gnarlyPriceEth || "0");
      const epic = ethers.parseEther(adminForm.epicPriceEth || "0");
      return contract.setPrices(standard, gnarly, epic);
    });

  const setTreasury = async () =>
    submitAdminTx("setTreasury", async () => {
      const contract = await getSignerContract();
      const treasury = ethers.getAddress(adminForm.newTreasury);
      return contract.setTreasury(treasury);
    });

  const setAllowedERC721 = async () =>
    submitAdminTx("setAllowedERC721", async () => {
      const contract = await getSignerContract();
      const nft = ethers.getAddress(adminForm.allowedNft);
      const allowed = adminForm.allowedValue === "true";
      return contract.setAllowedERC721(nft, allowed);
    });

  const setVrfConfig = async () =>
    submitAdminTx("setVrfConfig", async () => {
      const contract = await getSignerContract();
      const callbackGasLimit = Number.parseInt(adminForm.callbackGasLimit, 10);
      const requestConfirmations = Number.parseInt(adminForm.requestConfirmations, 10);
      const numWords = Number.parseInt(adminForm.numWords, 10);
      return contract.setVrfConfig(callbackGasLimit, requestConfirmations, numWords, adminForm.vrfKeyHash);
    });

  const setSubscriptionId = async () =>
    submitAdminTx("setSubscriptionId", async () => {
      const contract = await getSignerContract();
      const subscriptionId = parseWhole("subscriptionId", adminForm.newSubscriptionId);
      return contract.setSubscriptionId(subscriptionId);
    });

  const setFlexConfig = async () =>
    submitAdminTx("setFlexConfig", async () => {
      const contract = await getSignerContract();
      const minFlexEth = ethers.parseEther(adminForm.minFlexEth || "0");
      const flexNothingBps = Number.parseInt(adminForm.flexNothingBps, 10);
      const flexGnarsBase = toGnarsWei("flexGnarsBase", adminForm.flexGnarsBase);
      const flexGnarsPerEth = toGnarsWei("flexGnarsPerEth", adminForm.flexGnarsPerEth);
      if (contractKey === "v3") {
        const flexNftBpsMin = Number.parseInt(adminForm.flexNftBpsMin, 10);
        const flexNftBpsMax = Number.parseInt(adminForm.flexNftBpsMax, 10);
        const flexNftBpsPerEth = Number.parseInt(adminForm.flexNftBpsPerEth, 10);
        return contract.setFlexConfig(
          minFlexEth,
          flexNothingBps,
          flexNftBpsMin,
          flexNftBpsMax,
          flexNftBpsPerEth,
          flexGnarsBase,
          flexGnarsPerEth
        );
      }
      const flexNftBps = Number.parseInt(adminForm.flexNftBps, 10);
      return contract.setFlexConfig(minFlexEth, flexNothingBps, flexNftBps, flexGnarsBase, flexGnarsPerEth);
    });

  const pauseContract = async () =>
    submitAdminTx("pause", async () => {
      const contract = await getSignerContract();
      return contract.pause();
    });

  const unpauseContract = async () =>
    submitAdminTx("unpause", async () => {
      const contract = await getSignerContract();
      return contract.unpause();
    });

  const approveErc20 = async () =>
    submitAdminTx("approveERC20", async () => {
      if (!window.ethereum) throw new Error("No injected wallet found.");
      const provider = new ethers.BrowserProvider(window.ethereum);
      const signer = await provider.getSigner();
      const token = ethers.getAddress(adminForm.approveErc20Token || readings.gnarsToken);
      const spender = ethers.getAddress(adminForm.approveErc20Spender || contractAddress);
      const amount = toGnarsWei("approveErc20Amount", adminForm.approveErc20Amount);
      const erc20 = new ethers.Contract(token, ERC20_ABI, signer);
      return erc20.approve(spender, amount);
    });

  const approveErc721 = async () =>
    submitAdminTx("approveERC721", async () => {
      if (!window.ethereum) throw new Error("No injected wallet found.");
      const provider = new ethers.BrowserProvider(window.ethereum);
      const signer = await provider.getSigner();
      const token = ethers.getAddress(adminForm.approveErc721Token);
      const spender = ethers.getAddress(adminForm.approveErc721Spender || contractAddress);
      const tokenId = BigInt(adminForm.approveErc721TokenId);
      const erc721 = new ethers.Contract(token, ERC721_ABI, signer);
      return erc721.approve(spender, tokenId);
    });

  const approveErc721ForAll = async () =>
    submitAdminTx("setApprovalForAll", async () => {
      if (!window.ethereum) throw new Error("No injected wallet found.");
      const provider = new ethers.BrowserProvider(window.ethereum);
      const signer = await provider.getSigner();
      const token = ethers.getAddress(adminForm.approveErc721Token);
      const operator = ethers.getAddress(adminForm.approveErc721Operator || contractAddress);
      const approved = adminForm.approveErc721Approved === "true";
      const erc721 = new ethers.Contract(token, ERC721_ABI, signer);
      return erc721.setApprovalForAll(operator, approved);
    });

  const depositGnars = async () =>
    submitAdminTx("depositGnars", async () => {
      const contract = await getSignerContract();
      const amount = toGnarsWei("depositGnarsAmount", adminForm.depositGnarsAmount);
      return contract.depositGnars(amount);
    });

  const depositFlexNft = async () =>
    submitAdminTx("depositFlexNft", async () => {
      const contract = await getSignerContract();
      const nft = ethers.getAddress(adminForm.flexNftAddress);
      const tokenId = BigInt(adminForm.flexNftTokenId);
      return contract.depositFlexNft(nft, tokenId);
    });

  const depositBundle = async () =>
    submitAdminTx("depositBundle", async () => {
      const contract = await getSignerContract();
      const nftContracts = parseCsv(adminForm.bundleNftContracts).map((item) => ethers.getAddress(item));
      const nftIds = parseCsvNumbers(adminForm.bundleNftIds);
      const gnarsAmount = toGnarsWei("bundleGnarsAmount", adminForm.bundleGnarsAmount);
      const boxType = Number.parseInt(adminForm.bundleBoxType, 10);
      const weight = Number.parseInt(adminForm.bundleWeight, 10);
      return contract.depositBundle(nftContracts, nftIds, gnarsAmount, boxType, weight);
    });

  const fetchPoolBalances = async () => {
    try {
      setAdminStatus("Admin: reading pool balances...");
      const contract = await getReadContract();
      const boxType = Number.parseInt(adminForm.poolBoxType, 10);
      const balances = await contract.getPoolBalances(boxType);
      setPoolBalances({ boxType, balances });
      setAdminStatus("Admin: pool balances read");
      log(`admin: pool balances ${balances.map((v) => v.toString()).join(" / ")}`);
    } catch (err) {
      const msg = err.shortMessage || err.reason || err.message || err;
      setAdminStatus(`Admin: pool balances error ${msg}`);
      log(`admin: pool balances error ${msg}`);
    }
  };

  const fetchAllPoolBalances = async () => {
    try {
      setAdminStatus("Admin: reading all pool balances...");
      const contract = await getReadContract();
      const [standard, gnarly, epic] = await Promise.all([
        contract.getPoolBalances(0),
        contract.getPoolBalances(1),
        contract.getPoolBalances(2),
      ]);
      setPoolBalancesAll({ standard, gnarly, epic });
      setAdminStatus("Admin: all pool balances read");
      log(
        `admin: pool balances all s=${standard.map((v) => v.toString()).join("/")} g=${gnarly
          .map((v) => v.toString())
          .join("/")} e=${epic.map((v) => v.toString()).join("/")}`
      );
    } catch (err) {
      const msg = err.shortMessage || err.reason || err.message || err;
      setAdminStatus(`Admin: pool balances error ${msg}`);
      log(`admin: pool balances error ${msg}`);
    }
  };

  const readContract = async () => {
    if (!window.ethereum) {
      setStatus("No injected wallet found (try MetaMask/Rabby on http://localhost).");
      log("read: no injected wallet");
      return;
    }
    try {
      const provider = new ethers.BrowserProvider(window.ethereum);
      const network = await provider.getNetwork();
      if (network.chainId !== 8453n) {
        setStatus(`Wrong network. Please switch to Base mainnet (8453). Current: ${network.chainId}`);
        log(`read: wrong network ${network.chainId}`);
        return;
      }
      log(`read: network ok ${network.chainId}`);
      log(`read: contract ${contractAddress}`);
      const contract = new ethers.Contract(contractAddress, activeContract.abi, provider);
      const [
        standardPrice,
        gnarlyPrice,
        epicPrice,
        treasury,
        paused,
        subscriptionId,
        keyHash,
        coordinator,
      ] = await Promise.all([
        contract.standardPrice(),
        contract.gnarlyPrice(),
        contract.epicPrice(),
        contract.treasury(),
        contract.paused(),
        contract.subscriptionId(),
        contract.keyHash(),
        contract.s_vrfCoordinator(),
      ]);
      let minFlexEth = null;
      let flexBalances = null;
      let flexPreview = null;
      let gnarsToken = null;
      let gnarsUnit = null;
      let flexNothingBps = null;
      let flexNftBps = null;
      let flexNftBpsMin = null;
      let flexNftBpsMax = null;
      let flexNftBpsPerEth = null;
      let flexGnarsBase = null;
      let flexGnarsPerEth = null;
      let totalReservedGnars = null;
      if (contractKey === "v2") {
        [
          minFlexEth,
          flexBalances,
          gnarsToken,
          gnarsUnit,
          flexNothingBps,
          flexNftBps,
          flexGnarsBase,
          flexGnarsPerEth,
          totalReservedGnars,
        ] = await Promise.all([
          contract.minFlexEth(),
          contract.getFlexBalances(),
          contract.gnarsToken(),
          contract.gnarsUnit(),
          contract.flexNothingBps(),
          contract.flexNftBps(),
          contract.flexGnarsBase(),
          contract.flexGnarsPerEth(),
          contract.totalReservedGnars(),
        ]);
      } else if (contractKey === "v3") {
        [
          minFlexEth,
          flexBalances,
          gnarsToken,
          gnarsUnit,
          flexNothingBps,
          flexNftBpsMin,
          flexNftBpsMax,
          flexNftBpsPerEth,
          flexGnarsBase,
          flexGnarsPerEth,
          totalReservedGnars,
        ] = await Promise.all([
          contract.minFlexEth(),
          contract.getFlexBalances(),
          contract.gnarsToken(),
          contract.gnarsUnit(),
          contract.flexNothingBps(),
          contract.flexNftBpsMin(),
          contract.flexNftBpsMax(),
          contract.flexNftBpsPerEth(),
          contract.flexGnarsBase(),
          contract.flexGnarsPerEth(),
          contract.totalReservedGnars(),
        ]);
        try {
          const paid = ethers.parseEther(flexEth || "0");
          flexPreview = await contract.getFlexPreview(paid);
        } catch (err) {
          log(`read: flex preview error ${err.shortMessage || err.message || err}`);
        }
      }
      setReadings({
        standardPrice,
        gnarlyPrice,
        epicPrice,
        treasury,
        paused,
        subscriptionId,
        keyHash,
        coordinator,
        minFlexEth,
        flexBalances,
        flexPreview,
        gnarsToken,
        gnarsUnit,
        flexNothingBps,
        flexNftBps,
        flexNftBpsMin,
        flexNftBpsMax,
        flexNftBpsPerEth,
        flexGnarsBase,
        flexGnarsPerEth,
        totalReservedGnars,
      });
      log(`read: standardPrice ${standardPrice.toString()}`);
      log(`read: treasury ${treasury}`);
      log(`read: paused ${paused}`);
      setStatus("Status: read ok");
    } catch (err) {
      console.error(err);
      setStatus(`Status error: ${err.message || err}`);
      log(`read error: ${err.shortMessage || err.message || err}`);
    }
  };

  const previewFlex = async () => {
    if (contractKey !== "v3") return;
    try {
      const contract = await getReadContract();
      const paid = ethers.parseEther(flexEth || "0");
      const preview = await contract.getFlexPreview(paid);
      setReadings((prev) => ({ ...prev, flexPreview: preview }));
      log(`read: flexPreview ${preview.map((v) => v.toString()).join(" / ")}`);
    } catch (err) {
      const msg = err.shortMessage || err.reason || err.message || err;
      log(`read: flexPreview error ${msg}`);
    }
  };

  const openBox = async (forceSend = false) => {
    if (!window.ethereum) {
      setOpenStatus("No injected wallet found.");
      log("openBox: no injected wallet");
      return;
    }
    try {
      const provider = new ethers.BrowserProvider(window.ethereum);
      const signer = await provider.getSigner();
      const network = await provider.getNetwork();
      if (network.chainId !== 8453n) {
        setOpenStatus(`Wrong network. Please switch to Base mainnet (8453). Current: ${network.chainId}`);
        log(`openBox: wrong network ${network.chainId}`);
        return;
      }
      const contract = new ethers.Contract(contractAddress, activeContract.abi, signer);
      log(`openBox: contract ${contractAddress}`);

      const isFlex = contractKey !== "v1" && openBoxType === "3";
      let value;
      if (isFlex) {
        value = ethers.parseEther(flexEth || "0");
        log(`openBox: flex value ${value.toString()} wei`);
      } else {
        const priceMap = {
          "0": readings.standardPrice,
          "1": readings.gnarlyPrice,
          "2": readings.epicPrice,
        };
        value = priceMap[openBoxType];
        if (!value) {
          setOpenStatus("Price not loaded. Click Refresh Readings first.");
          log("openBox: price not loaded");
          return;
        }
        log(`openBox: boxType ${openBoxType} value ${value.toString()} wei`);
      }

      if (!forceSend) {
        // Static call to surface revert reason before signing.
        try {
          if (isFlex) {
            await contract.openFlexBox.staticCall({ value });
          } else {
            await contract.openBox.staticCall(parseInt(openBoxType, 10), { value });
          }
          log("openBox: staticCall ok");
        } catch (err) {
          const msg = err.shortMessage || err.reason || err.message || "staticCall failed";
          log(`openBox: staticCall revert: ${msg}`);
          setOpenStatus(`OpenBox blocked (staticCall): ${msg}`);
          return;
        }
      } else {
        log("openBox: force send enabled (skipping staticCall)");
      }

      setOpenStatus("Submitting openBox... confirm in wallet.");
      const tx = isFlex
        ? await contract.openFlexBox({ value })
        : await contract.openBox(parseInt(openBoxType, 10), { value });
      log(`openBox: tx submitted ${tx.hash}`);
      setOpenStatus(`Submitted: ${tx.hash}`);
      await tx.wait();
      log(`openBox: tx confirmed ${tx.hash}`);
      setOpenStatus(`Confirmed: ${tx.hash}`);
    } catch (err) {
      console.error(err);
      setOpenStatus(`OpenBox error: ${err.message || err}`);
      log(`openBox error: ${err.shortMessage || err.message || err}`);
    }
  };

  const deploy = async () => {
    log("deploy: click");
    if (!window.ethereum) {
      setStatus("No injected wallet found (try MetaMask/Rabby on http://localhost).");
      log("deploy: no injected wallet");
      return;
    }
    if (!isReady) {
      setStatus("Fill all fields first.");
      log("deploy: not ready");
      return;
    }

    try {
      log("deploy: starting");
      const provider = new ethers.BrowserProvider(window.ethereum);
      const signer = await provider.getSigner();
      const network = await provider.getNetwork();
      if (network.chainId !== 8453n) {
        setStatus(`Wrong network. Please switch to Base mainnet (8453). Current: ${network.chainId}`);
        log(`deploy: wrong network ${network.chainId}`);
        return;
      }
      setStatus("Deploying confirm in wallet.");
      log("deploy: building tx");
      const factory = new ethers.ContractFactory(activeContract.abi, activeContract.bytecode, signer);
      const coordinator = ethers.getAddress(form.coordinator.toLowerCase());
      const treasury = ethers.getAddress(form.treasury.toLowerCase());
      const owner = ethers.getAddress(form.owner.toLowerCase());
      const subId = BigInt(form.subId);

      const deployArgs = contractKey !== "v1"
        ? [
            coordinator,
            subId,
            form.keyHash,
            treasury,
            owner,
            ethers.getAddress(form.gnarsToken.toLowerCase()),
            BigInt(form.gnarsUnit),
          ]
        : [coordinator, subId, form.keyHash, treasury, owner];

      const deployTx = await factory.getDeployTransaction(...deployArgs);
      // Some RPCs fail to estimate gas for large initcode; set a safe manual limit.
      deployTx.gasLimit = BigInt(form.gasLimit);

      log(`deploy: sending tx (gasLimit=${deployTx.gasLimit})`);
      const sent = await signer.sendTransaction(deployTx);
      setStatus(`Submitted: ${sent.hash}\nWaiting for confirmation`);
      log(`deploy: submitted ${sent.hash}`);
      const receipt = await sent.wait();
      const addr = receipt.contractAddress;
      setStatus(
        `Deployed at ${addr}\nTx: ${sent.hash}\nReminder: add this address as a consumer in Chainlink VRF UI.`
      );
      log(`deploy: confirmed ${addr}`);
    } catch (err) {
      console.error(err);
      setStatus(`Error: ${err.message || err}`);
      log(`deploy error: ${err.shortMessage || err.message || err}`);
    }
  };

  const isFlexSelected = contractKey !== "v1" && openBoxType === "3";

  return (
    <div className="page">
      <header className="header">
        <div>
          <div className="eyebrow">Gnars Lootbox</div>
          <h1>Base VRF Deploy</h1>
          <p className="muted">
            Deploy with your injected wallet. After deploy, add the contract as a consumer in Chainlink VRF.
          </p>
        </div>
        <ConnectButton />
      </header>

      <section className="panel">
        <div className="pill">Base chainId: 8453</div>
        <div className="pill">VRF v2.5 native payment</div>
        <div className="pill warn">Set a valid treasury address</div>
      </section>

      <section className="form">
        <div className="tabs">
          <button
            className={`tab ${activeTab === "deploy" ? "active" : ""}`}
            onClick={() => setActiveTab("deploy")}
          >
            Deploy
          </button>
          <button
            className={`tab ${activeTab === "test" ? "active" : ""}`}
            onClick={() => setActiveTab("test")}
          >
            Test
          </button>
        </div>
      </section>

      {activeTab === "deploy" && (
        <section className="form">
          <div className="grid">
            <div>
              <label>Contract Version</label>
              <select value={contractKey} onChange={(e) => setContractKey(e.target.value)}>
                <option value="v1">V1</option>
                <option value="v2">V2</option>
                <option value="v3">V3</option>
              </select>
            </div>
            <div>
              <label>Lootbox Contract</label>
              <input value={contractAddress} onChange={(e) => setContractAddress(e.target.value)} />
            </div>
          </div>
          <div className="grid">
            <div>
              <label>VRF Coordinator (Base)</label>
              <input name="coordinator" value={form.coordinator} onChange={onChange} />
            </div>
            <div>
              <label>Subscription ID</label>
              <input name="subId" value={form.subId} onChange={onChange} />
            </div>
            <div>
              <label>Key Hash</label>
              <input name="keyHash" value={form.keyHash} onChange={onChange} />
            </div>
            <div>
              <label>Treasury</label>
              <div className="stack">
                <select value={treasuryPreset} onChange={onTreasuryPresetChange}>
                  <option value="test">Test wallet</option>
                  <option value="gnars">Gnars treasury</option>
                  <option value="custom">Custom</option>
                </select>
                <input name="treasury" value={form.treasury} onChange={onChange} placeholder="0x..." />
              </div>
            </div>
            <div>
              <label>Initial Owner</label>
              <input name="owner" value={form.owner} onChange={onChange} />
            </div>
            {contractKey !== "v1" && (
              <>
                <div>
                  <label>GNARS Token</label>
                  <input name="gnarsToken" value={form.gnarsToken} onChange={onChange} placeholder="0x..." />
                </div>
                <div>
                  <label>GNARS Unit (wei)</label>
                  <input name="gnarsUnit" value={form.gnarsUnit} onChange={onChange} />
                </div>
              </>
            )}
            <div>
              <label>Gas Limit (deploy)</label>
              <input name="gasLimit" value={form.gasLimit} onChange={onChange} />
            </div>
          </div>
          <div className="actions">
            <button className="primary"  onClick={deploy}>
              {isConnected ? `Deploy GnarsLootbox${contractKey.toUpperCase()}` : "Connect wallet first"}
            </button>
            <div className="muted small">
              Connected: {isConnected ? address : "not connected"}
            </div>
            {deployIssues.length > 0 && (
              <div className="muted small">
                Fix fields: {deployIssues.join(", ")}
              </div>
            )}
          </div>
        </section>
      )}

      {activeTab === "test" && (
        <section className="form">
          <div className="grid">
            <div>
              <label>Contract Version</label>
              <select value={contractKey} onChange={(e) => setContractKey(e.target.value)}>
                <option value="v1">V1</option>
                <option value="v2">V2</option>
                <option value="v3">V3</option>
              </select>
            </div>
            <div>
              <label>Lootbox Contract</label>
              <input value={contractAddress} onChange={(e) => setContractAddress(e.target.value)} />
            </div>
          </div>
          <div className="actions">
            <button className="secondary" onClick={readContract}>
              Refresh Readings
            </button>
          </div>
          <div className="readings">
            <div><span>standardPrice</span><strong>{readings.standardPrice ? ethers.formatEther(readings.standardPrice) + " ETH" : "-"}</strong></div>
            <div><span>gnarlyPrice</span><strong>{readings.gnarlyPrice ? ethers.formatEther(readings.gnarlyPrice) + " ETH" : "-"}</strong></div>
            <div><span>epicPrice</span><strong>{readings.epicPrice ? ethers.formatEther(readings.epicPrice) + " ETH" : "-"}</strong></div>
            <div><span>treasury</span><strong>{readings.treasury || "-"}</strong></div>
            <div><span>paused</span><strong>{readings.paused === null ? "-" : readings.paused.toString()}</strong></div>
            <div><span>subscriptionId</span><strong>{readings.subscriptionId ? readings.subscriptionId.toString() : "-"}</strong></div>
            <div><span>keyHash</span><strong>{readings.keyHash || "-"}</strong></div>
            <div><span>coordinator</span><strong>{readings.coordinator || "-"}</strong></div>
            {contractKey !== "v1" && (
              <>
                <div><span>minFlexEth</span><strong>{readings.minFlexEth ? ethers.formatEther(readings.minFlexEth) + " ETH" : "-"}</strong></div>
                <div>
                  <span>flexBalances</span>
                  <strong>
                    {readings.flexBalances
                      ? `nftsAvailable=${readings.flexBalances[0].toString()} / availableGnars=${formatGnars(
                          readings.flexBalances[1]
                        )} / reservedGnars=${formatGnars(readings.flexBalances[2])}`
                      : "-"}
                  </strong>
                </div>
                <div><span>gnarsToken</span><strong>{readings.gnarsToken || "-"}</strong></div>
                <div><span>gnarsUnit</span><strong>{readings.gnarsUnit ? readings.gnarsUnit.toString() : "-"}</strong></div>
                <div><span>flexNothingBps</span><strong>{readings.flexNothingBps !== null ? readings.flexNothingBps.toString() : "-"}</strong></div>
                {contractKey === "v2" && (
                  <div><span>flexNftBps</span><strong>{readings.flexNftBps !== null ? readings.flexNftBps.toString() : "-"}</strong></div>
                )}
                {contractKey === "v3" && (
                  <>
                    <div><span>flexNftBpsMin</span><strong>{readings.flexNftBpsMin !== null ? readings.flexNftBpsMin.toString() : "-"}</strong></div>
                    <div><span>flexNftBpsMax</span><strong>{readings.flexNftBpsMax !== null ? readings.flexNftBpsMax.toString() : "-"}</strong></div>
                    <div><span>flexNftBpsPerEth</span><strong>{readings.flexNftBpsPerEth !== null ? readings.flexNftBpsPerEth.toString() : "-"}</strong></div>
                  </>
                )}
                <div><span>flexGnarsBase</span><strong>{readings.flexGnarsBase ? readings.flexGnarsBase.toString() : "-"}</strong></div>
                <div><span>flexGnarsPerEth</span><strong>{readings.flexGnarsPerEth ? readings.flexGnarsPerEth.toString() : "-"}</strong></div>
                <div><span>totalReservedGnars</span><strong>{readings.totalReservedGnars ? readings.totalReservedGnars.toString() : "-"}</strong></div>
                {contractKey === "v3" && (
                  <div>
                    <span>flexPreview</span>
                    <strong>
                      {readings.flexPreview
                        ? `nothingBps=${readings.flexPreview[0].toString()} / nftBps=${readings.flexPreview[1].toString()} / gnars=${formatGnars(
                            readings.flexPreview[2]
                          )}`
                        : "-"}
                    </strong>
                  </div>
                )}
              </>
            )}
          </div>
        </section>
      )}

      {activeTab === "test" && contractKey !== "v1" && (
        <section className="form">
          <h2>Admin (V2/V3)</h2>
          <div className="grid">
            <div>
              <label>Standard Price (ETH)</label>
              <input name="standardPriceEth" value={adminForm.standardPriceEth} onChange={handleAdminChange} />
            </div>
            <div>
              <label>Gnarly Price (ETH)</label>
              <input name="gnarlyPriceEth" value={adminForm.gnarlyPriceEth} onChange={handleAdminChange} />
            </div>
            <div>
              <label>Epic Price (ETH)</label>
              <input name="epicPriceEth" value={adminForm.epicPriceEth} onChange={handleAdminChange} />
            </div>
          </div>
          <div className="actions">
            <button className="secondary" onClick={setPrices}>Set Prices</button>
          </div>

          <div className="grid">
            <div>
              <label>Set Treasury</label>
              <input name="newTreasury" value={adminForm.newTreasury} onChange={handleAdminChange} />
            </div>
            <div>
              <label>ERC721 Allowlist</label>
              <div className="stack">
                <input name="allowedNft" value={adminForm.allowedNft} onChange={handleAdminChange} placeholder="NFT address" />
                <select name="allowedValue" value={adminForm.allowedValue} onChange={handleAdminChange}>
                  <option value="true">Allow</option>
                  <option value="false">Block</option>
                </select>
              </div>
            </div>
          </div>
          <div className="actions">
            <button className="secondary" onClick={setTreasury}>Set Treasury</button>
            <button className="secondary" onClick={setAllowedERC721}>Update Allowlist</button>
          </div>

          <div className="grid">
            <div>
              <label>Callback Gas Limit</label>
              <input name="callbackGasLimit" value={adminForm.callbackGasLimit} onChange={handleAdminChange} />
            </div>
            <div>
              <label>Request Confirmations</label>
              <input name="requestConfirmations" value={adminForm.requestConfirmations} onChange={handleAdminChange} />
            </div>
            <div>
              <label>Num Words</label>
              <input name="numWords" value={adminForm.numWords} onChange={handleAdminChange} />
            </div>
            <div>
              <label>VRF Key Hash</label>
              <input name="vrfKeyHash" value={adminForm.vrfKeyHash} onChange={handleAdminChange} />
            </div>
          </div>
          <div className="actions">
            <button className="secondary" onClick={setVrfConfig}>Set VRF Config</button>
          </div>
          {contractKey === "v3" && (
            <>
              <div className="grid">
                <div>
                  <label>Subscription ID (V3)</label>
                  <input name="newSubscriptionId" value={adminForm.newSubscriptionId} onChange={handleAdminChange} />
                </div>
              </div>
              <div className="actions">
                <button className="secondary" onClick={setSubscriptionId}>Set Subscription ID</button>
              </div>
            </>
          )}

          <div className="grid">
            <div>
              <label>Min Flex ETH</label>
              <input name="minFlexEth" value={adminForm.minFlexEth} onChange={handleAdminChange} />
            </div>
            <div>
              <label>Flex Nothing Bps</label>
              <input name="flexNothingBps" value={adminForm.flexNothingBps} onChange={handleAdminChange} />
            </div>
            {contractKey === "v2" && (
              <div>
                <label>Flex NFT Bps</label>
                <input name="flexNftBps" value={adminForm.flexNftBps} onChange={handleAdminChange} />
              </div>
            )}
            {contractKey === "v3" && (
              <>
                <div>
                  <label>Flex NFT Bps Min</label>
                  <input name="flexNftBpsMin" value={adminForm.flexNftBpsMin} onChange={handleAdminChange} />
                </div>
                <div>
                  <label>Flex NFT Bps Max</label>
                  <input name="flexNftBpsMax" value={adminForm.flexNftBpsMax} onChange={handleAdminChange} />
                </div>
                <div>
                  <label>Flex NFT Bps Per ETH</label>
                  <input name="flexNftBpsPerEth" value={adminForm.flexNftBpsPerEth} onChange={handleAdminChange} />
                </div>
              </>
            )}
            <div>
              <label>Flex GNARS Base (tokens)</label>
              <input name="flexGnarsBase" value={adminForm.flexGnarsBase} onChange={handleAdminChange} />
            </div>
            <div>
              <label>Flex GNARS per 1 ETH (tokens)</label>
              <input name="flexGnarsPerEth" value={adminForm.flexGnarsPerEth} onChange={handleAdminChange} />
            </div>
          </div>
          <div className="actions">
            <button className="secondary" onClick={setFlexConfig}>Set Flex Config</button>
            <button className="secondary" onClick={pauseContract}>Pause</button>
            <button className="secondary" onClick={unpauseContract}>Unpause</button>
          </div>

          <div className="grid">
            <div>
              <label>Approve ERC20 (token)</label>
              <input name="approveErc20Token" value={adminForm.approveErc20Token} onChange={handleAdminChange} />
            </div>
            <div>
              <label>Approve ERC20 (spender)</label>
              <input name="approveErc20Spender" value={adminForm.approveErc20Spender} onChange={handleAdminChange} placeholder={`Default: ${contractAddress}`} />
            </div>
            <div>
              <label>Approve ERC20 Amount (tokens)</label>
              <input name="approveErc20Amount" value={adminForm.approveErc20Amount} onChange={handleAdminChange} />
            </div>
          </div>
          <div className="actions">
            <button className="secondary" onClick={approveErc20}>Approve ERC20</button>
          </div>

          <div className="grid">
            <div>
              <label>Approve ERC721 (token)</label>
              <input name="approveErc721Token" value={adminForm.approveErc721Token} onChange={handleAdminChange} />
            </div>
            <div>
              <label>Approve ERC721 (spender)</label>
              <input name="approveErc721Spender" value={adminForm.approveErc721Spender} onChange={handleAdminChange} placeholder={`Default: ${contractAddress}`} />
            </div>
            <div>
              <label>Approve ERC721 Token ID</label>
              <input name="approveErc721TokenId" value={adminForm.approveErc721TokenId} onChange={handleAdminChange} />
            </div>
            <div>
              <label>Approval For All (operator)</label>
              <input name="approveErc721Operator" value={adminForm.approveErc721Operator} onChange={handleAdminChange} placeholder={`Default: ${contractAddress}`} />
            </div>
            <div>
              <label>Approval For All (approved)</label>
              <select name="approveErc721Approved" value={adminForm.approveErc721Approved} onChange={handleAdminChange}>
                <option value="true">true</option>
                <option value="false">false</option>
              </select>
            </div>
          </div>
          <div className="actions">
            <button className="secondary" onClick={approveErc721}>Approve ERC721</button>
            <button className="secondary" onClick={approveErc721ForAll}>Approve ERC721 (All)</button>
          </div>

          <div className="grid">
            <div>
              <label>Deposit GNARS (tokens)</label>
              <input name="depositGnarsAmount" value={adminForm.depositGnarsAmount} onChange={handleAdminChange} />
            </div>
            <div>
              <label>Deposit Flex NFT (address)</label>
              <input name="flexNftAddress" value={adminForm.flexNftAddress} onChange={handleAdminChange} />
            </div>
            <div>
              <label>Deposit Flex NFT (tokenId)</label>
              <input name="flexNftTokenId" value={adminForm.flexNftTokenId} onChange={handleAdminChange} />
            </div>
          </div>
          <div className="actions">
            <button className="secondary" onClick={depositGnars}>Deposit GNARS</button>
            <button className="secondary" onClick={depositFlexNft}>Deposit Flex NFT</button>
          </div>

          <div className="grid">
            <div>
              <label>Bundle Box Type</label>
              <select name="bundleBoxType" value={adminForm.bundleBoxType} onChange={handleAdminChange}>
                <option value="0">Standard</option>
                <option value="1">Gnarly</option>
                <option value="2">Epic</option>
              </select>
            </div>
            <div>
              <label>Bundle Weight</label>
              <input name="bundleWeight" value={adminForm.bundleWeight} onChange={handleAdminChange} />
            </div>
            <div>
              <label>Bundle GNARS Amount (tokens)</label>
              <input name="bundleGnarsAmount" value={adminForm.bundleGnarsAmount} onChange={handleAdminChange} />
            </div>
            <div>
              <label>Bundle NFT Contracts (CSV)</label>
              <input name="bundleNftContracts" value={adminForm.bundleNftContracts} onChange={handleAdminChange} placeholder="0xabc...,0xdef..." />
            </div>
            <div>
              <label>Bundle NFT IDs (CSV)</label>
              <input name="bundleNftIds" value={adminForm.bundleNftIds} onChange={handleAdminChange} placeholder="1,2,3" />
            </div>
          </div>
          <div className="actions">
            <button className="secondary" onClick={depositBundle}>Deposit Bundle</button>
          </div>

          <div className="grid">
            <div>
              <label>Pool Box Type</label>
              <select name="poolBoxType" value={adminForm.poolBoxType} onChange={handleAdminChange}>
                <option value="0">Standard</option>
                <option value="1">Gnarly</option>
                <option value="2">Epic</option>
              </select>
            </div>
          </div>
          <div className="actions">
            <button className="secondary" onClick={fetchPoolBalances}>Get Pool Balances</button>
            <button className="secondary" onClick={fetchAllPoolBalances}>Get All Pools</button>
          </div>
          <div className="statusBox">
            <div className="label">Pool Balances</div>
            <pre>
              {poolBalances
                ? `Box ${poolBalances.boxType}: ${poolBalances.balances.map((v) => v.toString()).join(" / ")}`
                : "-"}
            </pre>
            <div className="muted small">
              Fields: totalGnars / totalNfts / remainingBundles / totalWeight.
            </div>
          </div>
          {poolBalancesAll && (
            <div className="statusBox">
              <div className="label">All Pools</div>
              <pre>
                {`Standard: ${poolBalancesAll.standard.map((v) => v.toString()).join(" / ")}\n`}
                {`Gnarly:   ${poolBalancesAll.gnarly.map((v) => v.toString()).join(" / ")}\n`}
                {`Epic:     ${poolBalancesAll.epic.map((v) => v.toString()).join(" / ")}`}
              </pre>
              <div className="muted small">
                Fields: totalGnars / totalNfts / remainingBundles / totalWeight.
              </div>
            </div>
          )}
          <div className="statusBox">
            <div className="label">Admin Status</div>
            <pre>{adminStatus}</pre>
          </div>
        </section>
      )}

      {activeTab === "test" && (
        <>
          <section className="form">
            <h2>Open Box</h2>
            <div className="grid">
              <div>
                <label>Box Type</label>
                <select value={openBoxType} onChange={(e) => setOpenBoxType(e.target.value)}>
                  <option value="0">Standard</option>
                  <option value="1">Gnarly</option>
                  <option value="2">Epic</option>
                  {contractKey !== "v1" && <option value="3">Flex</option>}
                </select>
              </div>
              {isFlexSelected && (
                <div>
                  <label>Flex ETH</label>
                  <input value={flexEth} onChange={(e) => setFlexEth(e.target.value)} />
                </div>
              )}
            </div>
            {isFlexSelected && contractKey === "v3" && (
              <div className="muted small">
                Preview: {readings.flexPreview
                  ? `nothing=${readings.flexPreview[0].toString()} bps / nft=${readings.flexPreview[1].toString()} bps / gnars=${formatGnars(
                      readings.flexPreview[2]
                    )}`
                  : "click Preview Flex Odds"}
              </div>
            )}
            <div className="actions">
              <button className="primary"  onClick={() => openBox(false)}>
                {isFlexSelected ? "Open Flex Box" : "Open Box (uses on-chain price)"}
              </button>
              {isFlexSelected && contractKey === "v3" && (
                <button className="secondary" onClick={previewFlex}>
                  Preview Flex Odds
                </button>
              )}
              <button className="secondary" onClick={() => openBox(true)}>
                Force Send (skip static call)
              </button>
            </div>
            <div className="statusBox">
              <div className="label">OpenBox Status</div>
              <pre>{openStatus}</pre>
            </div>
          </section>

          <section className="statusBox">
            <div className="label">Status</div>
            <pre>{status}</pre>
          </section>
          <section className="statusBox">
            <div className="label">Debug Log</div>
            <pre>{debugLog.join("\n")}</pre>
          </section>
        </>
      )}
    </div>
  );
}

export default App;
