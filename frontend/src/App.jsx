import { useState, useMemo } from "react";
import { ConnectButton } from "@rainbow-me/rainbowkit";
import { useAccount } from "wagmi";
import { ethers } from "ethers";
import "./App.css";

const DEFAULTS = {
  coordinator: "0x4E9E5e66c848105eA570185D1CfDa53F5B961Fd1",
  keyHash: "0x8308bdbb793c1d399e7d1757b8750a608b0ca6e73b386cd5b48fd3248970cde6",
  subId: "99565515620834636304250522028617269923610402981851221983571694477234087866635",
  owner: "0x8Bf5941d27176242745B716251943Ae4892a3C26",
};

// ABI from forge inspect (constructor + read/openBox subset).
const ABI = [
  {
    type: "constructor",
    inputs: [
      { name: "vrfCoordinator", type: "address" },
      { name: "_subscriptionId", type: "uint256" },
      { name: "_keyHash", type: "bytes32" },
      { name: "_treasury", type: "address" },
      { name: "initialOwner", type: "address" },
    ],
  },
  { type: "function", name: "standardPrice", inputs: [], outputs: [{ type: "uint256" }], stateMutability: "view" },
  { type: "function", name: "gnarlyPrice", inputs: [], outputs: [{ type: "uint256" }], stateMutability: "view" },
  { type: "function", name: "epicPrice", inputs: [], outputs: [{ type: "uint256" }], stateMutability: "view" },
  { type: "function", name: "treasury", inputs: [], outputs: [{ type: "address" }], stateMutability: "view" },
  { type: "function", name: "paused", inputs: [], outputs: [{ type: "bool" }], stateMutability: "view" },
  { type: "function", name: "subscriptionId", inputs: [], outputs: [{ type: "uint256" }], stateMutability: "view" },
  { type: "function", name: "keyHash", inputs: [], outputs: [{ type: "bytes32" }], stateMutability: "view" },
  { type: "function", name: "s_vrfCoordinator", inputs: [], outputs: [{ type: "address" }], stateMutability: "view" },
  { type: "function", name: "openBox", inputs: [{ name: "boxType", type: "uint8" }], outputs: [{ type: "uint256" }], stateMutability: "payable" },
];

// Bytecode from forge build (same as deploy.html version).
const BYTECODE =
  "0x608060405266470de4df820000600f5566b1a2bc2ec5000060105567016345785d8a000060115562061a8060155f6101000a81548163ffffffff021916908363ffffffff1602179055506003601560046101000a81548161ffff021916908361ffff1602179055506001601560066101000a81548163ffffffff021916908363ffffffff160217905550348015610094575f5ffd5b506040516141b93803806141b983398181016040528101906100b69190610658565b8433805f5f73ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff1603610128576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161011f90610729565b60405180910390fd5b815f5f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505f73ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff16146101aa576101a98161037e60201b60201c565b5b5050505f73ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1603610212576040517fd92e233d00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b8060025f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550505f600260146101000a81548160ff02191690831515021790555060016003819055505f73ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff16036102e3576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016102da90610791565b60405180910390fd5b3373ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff161461032657610325816104a960201b60201c565b5b83601381905550826014819055508160125f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550505050505061087f565b3373ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff16036103ec576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016103e3906107f9565b60405180910390fd5b8060015f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508073ffffffffffffffffffffffffffffffffffffffff165f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff167fed8889f560326eb138920d842192f0eb3dd22b4f139c87a2c57538e05bae127860405160405180910390a350565b6104b76104c960201b60201c565b6104c68161037e60201b60201c565b50565b5f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610557576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161054e90610861565b60405180910390fd5b565b5f5ffd5b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f6105868261055d565b9050919050565b6105968161057c565b81146105a0575f5ffd5b50565b5f815190506105b18161058d565b92915050565b5f819050919050565b6105c9816105b7565b81146105d3575f5ffd5b50565b5f815190506105e4816105c0565b92915050565b5f819050919050565b6105fc816105ea565b8114610606575f5ffd5b50565b5f81519050610617816105f3565b92915050565b5f6106278261055d565b9050919050565b6106378161061d565b8114610641575f5ffd5b50565b5f815190506106528161062e565b92915050565b5f5f5f5f5f60a0868803121561067157610670610559565b5b5f61067e888289016105a3565b955050602061068f888289016105d6565b94505060406106a088828901610609565b93505060606106b188828901610644565b92505060806106c2888289016105a3565b9150509295509295909350565b5f82825260208201905092915050565b7f43616e6e6f7420736574206f776e657220746f207a65726f00000000000000005f82015250565b5f6107136018836106cf565b915061071e826106df565b602082019050919050565b5f6020820190508181035f83015261074081610707565b9050919050565b7f6f776e65723d30000000000000000000000000000000000000000000000000005f82015250565b5f61077b6007836106cf565b915061078682610747565b602082019050919050565b5f6020820190508181035f8301526107a88161076f565b9050919050565b7f43616e6e6f74207472616e7366657220746f2073656c660000000000000000005f82015250565b5f6107e36017836106cf565b91506107ee826107af565b602082019050919050565b5f6020820190508181035f830152610810816107d7565b9050919050565b7f4f6e6c792063616c6c61626c65206279206f776e6572000000000000000000005f82015250565b5f61084b6016836106cf565b915061085682610817565b602082019050919050565b5f6020820190508181035f8301526108788161083f565b9050919050565b61392d8061088c5f395ff3fe60806040526004361061019f575f3560e01c80637ccfd7fc116100eb578063a88fe42d11610089578063d50b378111610063578063d50b378114610540578063e75bd5551461057e578063f0f44260146105a6578063f2fde38b146105ce576101a6565b8063a88fe42d146104c4578063b0fb162f146104ec578063d0f8e81614610516576101a6565b80638ea98117116100c55780638ea98117146104205780639e9db57d146104485780639eccacf614610472578063a1bfb3071461049c576101a6565b80637ccfd7fc146103b65780638456cb59146103e05780638da5cb5b146103f6576101a6565b80632c96732c1161015857806361728f391161013257806361728f391461032457806361d027b31461034e578063776118f91461037857806379ba5097146103a0576101a6565b80632c96732c146102a85780633f4ba83a146102e45780635c975abb146102fa576101a6565b806309c1ba2e146101aa5780631f1525e2146101d45780631fe543e3146101fe578063235069b41461022657806324f746971461024e57806329ec7f1414610278576101a6565b366101a657005b5f5ffd5b3480156101b5575f5ffd5b506101be6105f6565b6040516101cb919061267b565b60405180910390f35b3480156101df575f5ffd5b506101e86105fc565b6040516101f5919061267b565b60405180910390f35b348015610209575f5ffd5b50610224600480360381019061021f9190612727565b610602565b005b348015610231575f5ffd5b5061024c60048036038101906102479190612827565b6106c6565b005b348015610259575f5ffd5b50610262610739565b60405161026f919061289a565b60405180910390f35b610292600480360381019061028d91906128d6565b61074e565b60405161029f919061267b565b60405180910390f35b3480156102b3575f5ffd5b506102ce60048036038101906102c9919061295b565b610b98565b6040516102db91906129a0565b60405180910390f35b3480156102ef575f5ffd5b506102f8610bb5565b005b348015610305575f5ffd5b5061030e610bc7565b60405161031b91906129a0565b60405180910390f35b34801561032f575f5ffd5b50610338610bdd565b60405161034591906129c8565b60405180910390f35b348015610359575f5ffd5b50610362610be3565b60405161036f9190612a01565b60405180910390f35b348015610383575f5ffd5b5061039e60048036038101906103999190612a1a565b610c08565b005b3480156103ab575f5ffd5b506103b4610eec565b005b3480156103c1575f5ffd5b506103ca61107b565b6040516103d7919061289a565b60405180910390f35b3480156103eb575f5ffd5b506103f4611091565b005b348015610401575f5ffd5b5061040a6110a3565b6040516104179190612a8d565b60405180910390f35b34801561042b575f5ffd5b506104466004803603810190610441919061295b565b6110ca565b005b348015610453575f5ffd5b5061045c6112a7565b604051610469919061267b565b60405180910390f35b34801561047d575f5ffd5b506104866112ad565b6040516104939190612b01565b60405180910390f35b3480156104a7575f5ffd5b506104c260048036038101906104bd9190612b44565b6112d2565b005b3480156104cf575f5ffd5b506104ea60048036038101906104e59190612b82565b611380565b005b3480156104f7575f5ffd5b506105006113a2565b60405161050d9190612be1565b60405180910390f35b348015610521575f5ffd5b5061052a6113b6565b604051610537919061267b565b60405180910390f35b34801561054b575f5ffd5b5061056660048036038101906105619190612bfa565b6113bc565b60405161057593929190612c98565b60405180910390f35b348015610589575f5ffd5b506105a4600480360381019061059f9190612a1a565b611419565b005b3480156105b1575f5ffd5b506105cc60048036038101906105c79190612cf7565b611781565b005b3480156105d9575f5ffd5b506105f460048036038101906105ef919061295b565b61180f565b005b60135481565b600f5481565b60025f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16146106b6573360025f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff166040517f1cf993f40000000000000000000000000000000000000000000000000000000081526004016106ad929190612d22565b60405180910390fd5b6106c1838383611823565b505050565b6106ce611d4a565b8360155f6101000a81548163ffffffff021916908363ffffffff16021790555082601560046101000a81548161ffff021916908361ffff16021790555081601560066101000a81548163ffffffff021916908363ffffffff1602179055508060148190555050505050565b60155f9054906101000a900463ffffffff1681565b5f610757611dda565b61075f611e20565b5f61076983611e61565b90508034146107ad576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016107a490612da3565b60405180910390fd5b5f6107b784611ed8565b90505f8160020154116107ff576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016107f690612e0b565b60405180910390fd5b5f816001015411610845576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161083c90612e73565b60405180910390fd5b5f60125f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163460405161088b90612ebe565b5f6040518083038185875af1925050503d805f81146108c5576040519150601f19603f3d011682016040523d82523d5f602084013e6108ca565b606091505b505090508061090e576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161090590612f1c565b60405180910390fd5b5f6040518060c0016040528060145481526020016013548152602001601560049054906101000a900461ffff1661ffff16815260200160155f9054906101000a900463ffffffff1663ffffffff168152602001601560069054906101000a900463ffffffff1663ffffffff168152602001610999604051806020016040528060011515815250611f4c565b815250905060025f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16639b1c385e826040518263ffffffff1660e01b81526004016109f8919061306c565b6020604051808303815f875af1158015610a14573d5f5f3e3d5ffd5b505050506040513d601f19601f82011682018060405250810190610a3891906130a0565b945060405180606001604052803373ffffffffffffffffffffffffffffffffffffffff168152602001876002811115610a7457610a73612c25565b5b81526020015f1515815250600d5f8781526020019081526020015f205f820151815f015f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506020820151815f0160146101000a81548160ff02191690836002811115610afe57610afd612c25565b5b02179055506040820151815f0160156101000a81548160ff021916908315150217905550905050856002811115610b3857610b37612c25565b5b3373ffffffffffffffffffffffffffffffffffffffff16867fc319f52a94c56a2b81382fbdb5f1cae77badc44ba465d4c9ceddfb6fadefe23787604051610b7f919061267b565b60405180910390a450505050610b93611fe4565b919050565b600e602052805f5260405f205f915054906101000a900460ff1681565b610bbd611d4a565b610bc5611fee565b565b5f600260149054906101000a900460ff16905090565b60145481565b60125f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b610c10611d4a565b5f8311610c52576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610c4990613115565b60405180910390fd5b5f8161ffff1611610c98576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610c8f9061317d565b60405180910390fd5b610cc53330858773ffffffffffffffffffffffffffffffffffffffff16612050909392919063ffffffff16565b5f610ccf83611ed8565b9050805f016040518060c001604052805f6001811115610cf257610cf1612c25565b5b81526020018773ffffffffffffffffffffffffffffffffffffffff1681526020018681526020015f81526020018461ffff1681526020015f1515815250908060018154018082558091505060019003905f5260205f2090600402015f909190919091505f820151815f015f6101000a81548160ff02191690836001811115610d7d57610d7c612c25565b5b02179055506020820151815f0160016101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555060408201518160010155606082015181600201556080820151816003015f6101000a81548161ffff021916908361ffff16021790555060a08201518160030160026101000a81548160ff02191690831515021790555050508161ffff16816001015f828254610e3791906131c8565b925050819055506001816002015f828254610e5291906131c8565b925050819055508473ffffffffffffffffffffffffffffffffffffffff165f6001811115610e8357610e82612c25565b5b846002811115610e9657610e95612c25565b5b7f63e2adde7dfe22281f94d83376f6a2fabce620c00bc32d8c6f68bc5abdecf6d3875f876001885f0180549050610ecd91906131fb565b604051610edd9493929190613267565b60405180910390a45050505050565b60015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610f7b576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610f72906132f4565b60405180910390fd5b5f5f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff169050335f5f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505f60015f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055503373ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e060405160405180910390a350565b601560069054906101000a900463ffffffff1681565b611099611d4a565b6110a16120d2565b565b5f5f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905090565b6110d26110a3565b73ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415801561115a575060025f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614155b156111c857336111686110a3565b60025f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff166040517f061db9c10000000000000000000000000000000000000000000000000000000081526004016111bf93929190613312565b60405180910390fd5b5f73ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff160361122d576040517fd92e233d00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b8060025f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055507fd1a6a14209a385a964d036e404cb5cfb71f4000cdb03c9366292430787261be68160405161129c9190612a8d565b60405180910390a150565b60115481565b60025f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6112da611d4a565b80600e5f8473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f6101000a81548160ff0219169083151502179055508173ffffffffffffffffffffffffffffffffffffffff167f125943306687bd440a419d5840696e2dec90955322a9f4a7fb614bec0329fe8f8260405161137491906129a0565b60405180910390a25050565b611388611d4a565b82600f819055508160108190555080601181905550505050565b601560049054906101000a900461ffff1681565b60105481565b600d602052805f5260405f205f91509050805f015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1690805f0160149054906101000a900460ff1690805f0160159054906101000a900460ff16905083565b611421611d4a565b600e5f8573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f9054906101000a900460ff166114aa576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016114a190613391565b60405180910390fd5b5f8161ffff16116114f0576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016114e79061317d565b60405180910390fd5b8373ffffffffffffffffffffffffffffffffffffffff166323b872dd3330866040518463ffffffff1660e01b815260040161152d939291906133af565b5f604051808303815f87803b158015611544575f5ffd5b505af1158015611556573d5f5f3e3d5ffd5b505050505f61156483611ed8565b9050805f016040518060c0016040528060018081111561158757611586612c25565b5b81526020018773ffffffffffffffffffffffffffffffffffffffff1681526020015f81526020018681526020018461ffff1681526020015f1515815250908060018154018082558091505060019003905f5260205f2090600402015f909190919091505f820151815f015f6101000a81548160ff0219169083600181111561161257611611612c25565b5b02179055506020820151815f0160016101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555060408201518160010155606082015181600201556080820151816003015f6101000a81548161ffff021916908361ffff16021790555060a08201518160030160026101000a81548160ff02191690831515021790555050508161ffff16816001015f8282546116cc91906131c8565b925050819055506001816002015f8282546116e791906131c8565b925050819055508473ffffffffffffffffffffffffffffffffffffffff1660018081111561171857611717612c25565b5b84600281111561172b5761172a612c25565b5b7f63e2adde7dfe22281f94d83376f6a2fabce620c00bc32d8c6f68bc5abdecf6d35f88876001885f018054905061176291906131fb565b60405161177294939291906133e4565b60405180910390a45050505050565b611789611d4a565b8060125f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508073ffffffffffffffffffffffffffffffffffffffff167f7dae230f18360d76a040c81f050aa14eb9d6dc7901b20fc5d855e2a20fe814d160405160405180910390a250565b611817611d4a565b61182081612135565b50565b5f600d5f8581526020019081526020015f2090505f73ffffffffffffffffffffffffffffffffffffffff16815f015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16036118c7576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016118be90613471565b60405180910390fd5b805f0160159054906101000a900460ff1615611918576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161190f906134d9565b60405180910390fd5b6001815f0160156101000a81548160ff0219169083151502179055505f61194e825f0160149054906101000a900460ff16611ed8565b90505f6119748286865f818110611968576119676134f7565b5b90506020020135612260565b90505f825f01828154811061198c5761198b6134f7565b5b905f5260205f20906004020190508060030160029054906101000a900460ff16156119ec576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016119e39061356e565b60405180910390fd5b60018160030160026101000a81548160ff0219169083151502179055506001836002015f828254611a1d91906131fb565b92505081905550806003015f9054906101000a900461ffff1661ffff16836001015f828254611a4c91906131fb565b925050819055505f6001811115611a6657611a65612c25565b5b815f015f9054906101000a900460ff166001811115611a8857611a87612c25565b5b03611bc957611b01845f015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff168260010154835f0160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166123599092919063ffffffff16565b835f0160149054906101000a900460ff166002811115611b2457611b23612c25565b5b845f015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16887f3259eb42ddebd6f17e7e881f47bd1a2c165cb4b1f11bb877865afb793e3498295f855f0160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff1686600101545f89604051611bbc9594939291906135d2565b60405180910390a4611d41565b805f0160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166342842e0e30865f015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1684600201546040518463ffffffff1660e01b8152600401611c4f939291906133af565b5f604051808303815f87803b158015611c66575f5ffd5b505af1158015611c78573d5f5f3e3d5ffd5b50505050835f0160149054906101000a900460ff166002811115611c9f57611c9e612c25565b5b845f015f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16887f3259eb42ddebd6f17e7e881f47bd1a2c165cb4b1f11bb877865afb793e3498296001855f0160019054906101000a900473ffffffffffffffffffffffffffffffffffffffff165f876002015489604051611d38959493929190613623565b60405180910390a45b50505050505050565b5f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614611dd8576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611dcf906136be565b60405180910390fd5b565b600260035403611e16576040517f3ee5aeb500000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b6002600381905550565b611e28610bc7565b15611e5f576040517fd93c066500000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b565b5f5f6002811115611e7557611e74612c25565b5b826002811115611e8857611e87612c25565b5b03611e9757600f549050611ed3565b60016002811115611eab57611eaa612c25565b5b826002811115611ebe57611ebd612c25565b5b03611ecd576010549050611ed3565b60115490505b919050565b5f5f6002811115611eec57611eeb612c25565b5b826002811115611eff57611efe612c25565b5b03611f0d5760049050611f47565b60016002811115611f2157611f20612c25565b5b826002811115611f3457611f33612c25565b5b03611f425760079050611f47565b600a90505b919050565b60607f92fd13387c7fe7befbc38d303d6468778fb9731bc4583f17d92989c6fcfdeaaa82604051602401611f809190613705565b604051602081830303815290604052907bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff83818316178352505050509050919050565b6001600381905550565b611ff66123d8565b5f600260146101000a81548160ff0219169083151502179055507f5db9ee0a495bf2e6ff9c91a7834c1ba4fdd244a5e8aa4e537bd38aeae4b073aa612039612418565b6040516120469190612a8d565b60405180910390a1565b6120cc848573ffffffffffffffffffffffffffffffffffffffff166323b872dd868686604051602401612085939291906133af565b604051602081830303815290604052915060e01b6020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff838183161783525050505061241f565b50505050565b6120da611e20565b6001600260146101000a81548160ff0219169083151502179055507f62e78cea01bee320cd4e420270b5ea74000d11b0c9f74754ebdbfc544b05a25861211e612418565b60405161212b9190612a8d565b60405180910390a1565b3373ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff16036121a3576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161219a90613768565b60405180910390fd5b8060015f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508073ffffffffffffffffffffffffffffffffffffffff165f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff167fed8889f560326eb138920d842192f0eb3dd22b4f139c87a2c57538e05bae127860405160405180910390a350565b5f5f83600101548361227291906137b3565b90505f5f90505f855f018054905090505f5f90505b81811015612317575f875f0182815481106122a5576122a46134f7565b5b905f5260205f20906004020190508060030160029054906101000a900460ff16156122d0575061230a565b806003015f9054906101000a900461ffff1661ffff16846122f191906131c8565b935083851015612308578195505050505050612353565b505b8080600101915050612287565b506040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161234a9061382d565b60405180910390fd5b92915050565b6123d3838473ffffffffffffffffffffffffffffffffffffffff1663a9059cbb858560405160240161238c92919061384b565b604051602081830303815290604052915060e01b6020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff838183161783525050505061241f565b505050565b6123e0610bc7565b612416576040517f8dfc202b00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b565b5f33905090565b5f612449828473ffffffffffffffffffffffffffffffffffffffff166124b490919063ffffffff16565b90505f81511415801561246d57508080602001905181019061246b9190613886565b155b156124af57826040517f5274afe70000000000000000000000000000000000000000000000000000000081526004016124a69190612a8d565b60405180910390fd5b505050565b60606124c183835f6124c9565b905092915050565b60608147101561251057306040517fcd7860590000000000000000000000000000000000000000000000000000000081526004016125079190612a8d565b60405180910390fd5b5f5f8573ffffffffffffffffffffffffffffffffffffffff16848660405161253891906138e1565b5f6040518083038185875af1925050503d805f8114612572576040519150601f19603f3d011682016040523d82523d5f602084013e612577565b606091505b5091509150612587868383612592565b925050509392505050565b6060826125a7576125a28261261f565b612617565b5f82511480156125cd57505f8473ffffffffffffffffffffffffffffffffffffffff163b145b1561260f57836040517f9996b3150000000000000000000000000000000000000000000000000000000081526004016126069190612a8d565b60405180910390fd5b819050612618565b5b9392505050565b5f815111156126315780518082602001fd5b6040517f1425ea4200000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b5f819050919050565b61267581612663565b82525050565b5f60208201905061268e5f83018461266c565b92915050565b5f5ffd5b5f5ffd5b6126a581612663565b81146126af575f5ffd5b50565b5f813590506126c08161269c565b92915050565b5f5ffd5b5f5ffd5b5f5ffd5b5f5f83601f8401126126e7576126e66126c6565b5b8235905067ffffffffffffffff811115612704576127036126ca565b5b6020830191508360208202830111156127205761271f6126ce565b5b9250929050565b5f5f5f6040848603121561273e5761273d612694565b5b5f61274b868287016126b2565b935050602084013567ffffffffffffffff81111561276c5761276b612698565b5b612778868287016126d2565b92509250509250925092565b5f63ffffffff82169050919050565b61279c81612784565b81146127a6575f5ffd5b50565b5f813590506127b781612793565b92915050565b5f61ffff82169050919050565b6127d3816127bd565b81146127dd575f5ffd5b50565b5f813590506127ee816127ca565b92915050565b5f819050919050565b612806816127f4565b8114612810575f5ffd5b50565b5f81359050612821816127fd565b92915050565b5f5f5f5f6080858703121561283f5761283e612694565b5b5f61284c878288016127a9565b945050602061285d878288016127e0565b935050604061286e878288016127a9565b925050606061287f87828801612813565b91505092959194509250565b61289481612784565b82525050565b5f6020820190506128ad5f83018461288b565b92915050565b600381106128bf575f5ffd5b50565b5f813590506128d0816128b3565b92915050565b5f602082840312156128eb576128ea612694565b5b5f6128f8848285016128c2565b91505092915050565b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f61292a82612901565b9050919050565b61293a81612920565b8114612944575f5ffd5b50565b5f8135905061295581612931565b92915050565b5f602082840312156129705761296f612694565b5b5f61297d84828501612947565b91505092915050565b5f8115159050919050565b61299a81612986565b82525050565b5f6020820190506129b35f830184612991565b92915050565b6129c2816127f4565b82525050565b5f6020820190506129db5f8301846129b9565b92915050565b5f6129eb82612901565b9050919050565b6129fb816129e1565b82525050565b5f602082019050612a145f8301846129f2565b92915050565b5f5f5f5f60808587031215612a3257612a31612694565b5b5f612a3f87828801612947565b9450506020612a50878288016126b2565b9350506040612a61878288016128c2565b9250506060612a72878288016127e0565b91505092959194509250565b612a8781612920565b82525050565b5f602082019050612aa05f830184612a7e565b92915050565b5f819050919050565b5f612ac9612ac4612abf84612901565b612aa6565b612901565b9050919050565b5f612ada82612aaf565b9050919050565b5f612aeb82612ad0565b9050919050565b612afb81612ae1565b82525050565b5f602082019050612b145f830184612af2565b92915050565b612b2381612986565b8114612b2d575f5ffd5b50565b5f81359050612b3e81612b1a565b92915050565b5f5f60408385031215612b5a57612b59612694565b5b5f612b6785828601612947565b9250506020612b7885828601612b30565b9150509250929050565b5f5f5f60608486031215612b9957612b98612694565b5b5f612ba6868287016126b2565b9350506020612bb7868287016126b2565b9250506040612bc8868287016126b2565b9150509250925092565b612bdb816127bd565b82525050565b5f602082019050612bf45f830184612bd2565b92915050565b5f60208284031215612c0f57612c0e612694565b5b5f612c1c848285016126b2565b91505092915050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52602160045260245ffd5b60038110612c6357612c62612c25565b5b50565b5f819050612c7382612c52565b919050565b5f612c8282612c66565b9050919050565b612c9281612c78565b82525050565b5f606082019050612cab5f830186612a7e565b612cb86020830185612c89565b612cc56040830184612991565b949350505050565b612cd6816129e1565b8114612ce0575f5ffd5b50565b5f81359050612cf181612ccd565b92915050565b5f60208284031215612d0c57612d0b612694565b5b5f612d1984828501612ce3565b91505092915050565b5f604082019050612d355f830185612a7e565b612d426020830184612a7e565b9392505050565b5f82825260208201905092915050565b7f77726f6e672070726963650000000000000000000000000000000000000000005f82015250565b5f612d8d600b83612d49565b9150612d9882612d59565b602082019050919050565b5f6020820190508181035f830152612dba81612d81565b9050919050565b7f656d70747920706f6f6c000000000000000000000000000000000000000000005f82015250565b5f612df5600a83612d49565b9150612e0082612dc1565b602082019050919050565b5f6020820190508181035f830152612e2281612de9565b9050919050565b7f6e6f2077656967687400000000000000000000000000000000000000000000005f82015250565b5f612e5d600983612d49565b9150612e6882612e29565b602082019050919050565b5f6020820190508181035f830152612e8a81612e51565b9050919050565b5f81905092915050565b50565b5f612ea95f83612e91565b9150612eb482612e9b565b5f82019050919050565b5f612ec882612e9e565b9150819050919050565b7f74726561737572792078666572206661696c65640000000000000000000000005f82015250565b5f612f06601483612d49565b9150612f1182612ed2565b602082019050919050565b5f6020820190508181035f830152612f3381612efa565b9050919050565b612f43816127f4565b82525050565b612f5281612663565b82525050565b612f61816127bd565b82525050565b612f7081612784565b82525050565b5f81519050919050565b5f82825260208201905092915050565b8281835e5f83830152505050565b5f601f19601f8301169050919050565b5f612fb882612f76565b612fc28185612f80565b9350612fd2818560208601612f90565b612fdb81612f9e565b840191505092915050565b5f60c083015f830151612ffb5f860182612f3a565b50602083015161300e6020860182612f49565b5060408301516130216040860182612f58565b5060608301516130346060860182612f67565b5060808301516130476080860182612f67565b5060a083015184820360a086015261305f8282612fae565b9150508091505092915050565b5f6020820190508181035f8301526130848184612fe6565b905092915050565b5f8151905061309a8161269c565b92915050565b5f602082840312156130b5576130b4612694565b5b5f6130c28482850161308c565b91505092915050565b7f616d6f756e743d300000000000000000000000000000000000000000000000005f82015250565b5f6130ff600883612d49565b915061310a826130cb565b602082019050919050565b5f6020820190508181035f83015261312c816130f3565b9050919050565b7f7765696768743d300000000000000000000000000000000000000000000000005f82015250565b5f613167600883612d49565b915061317282613133565b602082019050919050565b5f6020820190508181035f8301526131948161315b565b9050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601160045260245ffd5b5f6131d282612663565b91506131dd83612663565b92508282019050808211156131f5576131f461319b565b5b92915050565b5f61320582612663565b915061321083612663565b92508282039050818111156132285761322761319b565b5b92915050565b5f819050919050565b5f61325161324c6132478461322e565b612aa6565b612663565b9050919050565b61326181613237565b82525050565b5f60808201905061327a5f83018761266c565b6132876020830186613258565b6132946040830185612bd2565b6132a1606083018461266c565b95945050505050565b7f4d7573742062652070726f706f736564206f776e6572000000000000000000005f82015250565b5f6132de601683612d49565b91506132e9826132aa565b602082019050919050565b5f6020820190508181035f83015261330b816132d2565b9050919050565b5f6060820190506133255f830186612a7e565b6133326020830185612a7e565b61333f6040830184612a7e565b949350505050565b7f657263373231206e6f7420616c6c6f77656400000000000000000000000000005f82015250565b5f61337b601283612d49565b915061338682613347565b602082019050919050565b5f6020820190508181035f8301526133a88161336f565b9050919050565b5f6060820190506133c25f830186612a7e565b6133cf6020830185612a7e565b6133dc604083018461266c565b949350505050565b5f6080820190506133f75f830187613258565b613404602083018661266c565b6134116040830185612bd2565b61341e606083018461266c565b95945050505050565b7f756e6b6e6f776e207265717565737400000000000000000000000000000000005f82015250565b5f61345b600f83612d49565b915061346682613427565b602082019050919050565b5f6020820190508181035f8301526134888161344f565b9050919050565b7f616c72656164792066756c66696c6c65640000000000000000000000000000005f82015250565b5f6134c3601183612d49565b91506134ce8261348f565b602082019050919050565b5f6020820190508181035f8301526134f0816134b7565b9050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52603260045260245ffd5b7f636f6e73756d65640000000000000000000000000000000000000000000000005f82015250565b5f613558600883612d49565b915061356382613524565b602082019050919050565b5f6020820190508181035f8301526135858161354c565b9050919050565b6002811061359d5761359c612c25565b5b50565b5f8190506135ad8261358c565b919050565b5f6135bc826135a0565b9050919050565b6135cc816135b2565b82525050565b5f60a0820190506135e55f8301886135c3565b6135f26020830187612a7e565b6135ff604083018661266c565b61360c6060830185613258565b613619608083018461266c565b9695505050505050565b5f60a0820190506136365f8301886135c3565b6136436020830187612a7e565b6136506040830186613258565b61365d606083018561266c565b61366a608083018461266c565b9695505050505050565b7f4f6e6c792063616c6c61626c65206279206f776e6572000000000000000000005f82015250565b5f6136a8601683612d49565b91506136b382613674565b602082019050919050565b5f6020820190508181035f8301526136d58161369c565b9050919050565b6136e581612986565b82525050565b602082015f8201516136ff5f8501826136dc565b50505050565b5f6020820190506137185f8301846136eb565b92915050565b7f43616e6e6f74207472616e7366657220746f2073656c660000000000000000005f82015250565b5f613752601783612d49565b915061375d8261371e565b602082019050919050565b5f6020820190508181035f83015261377f81613746565b9050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601260045260245ffd5b5f6137bd82612663565b91506137c883612663565b9250826137d8576137d7613786565b5b828206905092915050565b7f73656c656374696f6e206661696c6564000000000000000000000000000000005f82015250565b5f613817601083612d49565b9150613822826137e3565b602082019050919050565b5f6020820190508181035f8301526138448161380b565b9050919050565b5f60408201905061385e5f830185612a7e565b61386b602083018461266c565b9392505050565b5f8151905061388081612b1a565b92915050565b5f6020828403121561389b5761389a612694565b5b5f6138a884828501613872565b91505092915050565b5f6138bb82612f76565b6138c58185612e91565b93506138d5818560208601612f90565b80840191505092915050565b5f6138ec82846138b1565b91508190509291505056fea26469706673582212208b3496d771bbb45b175ee57e4ba3672b6ae70275b251e4a47c660ff05e20851964736f6c634300081e0033";

function App() {
  const { address, isConnected } = useAccount();
  const [contractAddress, setContractAddress] = useState("0x5425186b0dd257130dc7d52ebba3673cf2a9a08f");
  const [form, setForm] = useState({
    coordinator: DEFAULTS.coordinator,
    subId: DEFAULTS.subId,
    keyHash: DEFAULTS.keyHash,
    treasury: "0x72ad986ebac0246d2b3c565ab2a1ce3a14ce6f88",
    owner: DEFAULTS.owner,
    gasLimit: "12000000",
  });
  const [status, setStatus] = useState("Status: idle");
  const [readings, setReadings] = useState({
    standardPrice: null,
    gnarlyPrice: null,
    epicPrice: null,
    treasury: null,
    paused: null,
    subscriptionId: null,
    keyHash: null,
    coordinator: null,
  });
  const [openBoxType, setOpenBoxType] = useState("0");
  const [openStatus, setOpenStatus] = useState("OpenBox: idle");
  const [debugLog, setDebugLog] = useState([]);

  const isReady = useMemo(
    () => form.coordinator && form.subId && form.keyHash && form.treasury && form.owner,
    [form]
  );

  const onChange = (e) => {
    const { name, value } = e.target;
    setForm((prev) => ({ ...prev, [name]: value }));
  };

  const log = (msg) => {
    setDebugLog((prev) => [...prev, `[${new Date().toISOString()}] ${msg}`].slice(-200));
  };

  const readContract = async () => {
    if (!window.ethereum) {
      setStatus("No injected wallet found (try MetaMask/Rabby on http://localhost).");
      log("read: no injected wallet");
      return;
    }
    try {
      const provider = new ethers.BrowserProvider(window.ethereum);
      const network = await provider.getNetwork();
      if (network.chainId !== 8453n) {
        setStatus(`Wrong network. Please switch to Base mainnet (8453). Current: ${network.chainId}`);
        log(`read: wrong network ${network.chainId}`);
        return;
      }
      log(`read: network ok ${network.chainId}`);
      log(`read: contract ${contractAddress}`);
      const contract = new ethers.Contract(contractAddress, ABI, provider);
      const [
        standardPrice,
        gnarlyPrice,
        epicPrice,
        treasury,
        paused,
        subscriptionId,
        keyHash,
        coordinator,
      ] = await Promise.all([
        contract.standardPrice(),
        contract.gnarlyPrice(),
        contract.epicPrice(),
        contract.treasury(),
        contract.paused(),
        contract.subscriptionId(),
        contract.keyHash(),
        contract.s_vrfCoordinator(),
      ]);
      setReadings({
        standardPrice,
        gnarlyPrice,
        epicPrice,
        treasury,
        paused,
        subscriptionId,
        keyHash,
        coordinator,
      });
      log(`read: standardPrice ${standardPrice.toString()}`);
      log(`read: treasury ${treasury}`);
      log(`read: paused ${paused}`);
      setStatus("Status: read ok");
    } catch (err) {
      console.error(err);
      setStatus(`Status error: ${err.message || err}`);
      log(`read error: ${err.shortMessage || err.message || err}`);
    }
  };

  const openBox = async (forceSend = false) => {
    if (!window.ethereum) {
      setOpenStatus("No injected wallet found.");
      log("openBox: no injected wallet");
      return;
    }
    try {
      const provider = new ethers.BrowserProvider(window.ethereum);
      const signer = await provider.getSigner();
      const network = await provider.getNetwork();
      if (network.chainId !== 8453n) {
        setOpenStatus(`Wrong network. Please switch to Base mainnet (8453). Current: ${network.chainId}`);
        log(`openBox: wrong network ${network.chainId}`);
        return;
      }
      const contract = new ethers.Contract(contractAddress, ABI, signer);
      const priceMap = {
        "0": readings.standardPrice,
        "1": readings.gnarlyPrice,
        "2": readings.epicPrice,
      };
      const value = priceMap[openBoxType];
      if (!value) {
        setOpenStatus("Price not loaded. Click Refresh Readings first.");
        log("openBox: price not loaded");
        return;
      }
      log(`openBox: contract ${contractAddress}`);
      log(`openBox: boxType ${openBoxType} value ${value.toString()} wei`);

      if (!forceSend) {
        // Static call to surface revert reason before signing.
        try {
          await contract.openBox.staticCall(parseInt(openBoxType, 10), { value });
          log("openBox: staticCall ok");
        } catch (err) {
          const msg = err.shortMessage || err.reason || err.message || "staticCall failed";
          log(`openBox: staticCall revert: ${msg}`);
          setOpenStatus(`OpenBox blocked (staticCall): ${msg}`);
          return;
        }
      } else {
        log("openBox: force send enabled (skipping staticCall)");
      }

      setOpenStatus("Submitting openBox... confirm in wallet.");
      const tx = await contract.openBox(parseInt(openBoxType, 10), { value });
      log(`openBox: tx submitted ${tx.hash}`);
      setOpenStatus(`Submitted: ${tx.hash}`);
      await tx.wait();
      log(`openBox: tx confirmed ${tx.hash}`);
      setOpenStatus(`Confirmed: ${tx.hash}`);
    } catch (err) {
      console.error(err);
      setOpenStatus(`OpenBox error: ${err.message || err}`);
      log(`openBox error: ${err.shortMessage || err.message || err}`);
    }
  };

  const deploy = async () => {
    if (!window.ethereum) {
      setStatus("No injected wallet found (try MetaMask/Rabby on http://localhost).");
      return;
    }
    if (!isReady) {
      setStatus("Fill all fields first.");
      return;
    }

    try {
      const provider = new ethers.BrowserProvider(window.ethereum);
      const signer = await provider.getSigner();
      const network = await provider.getNetwork();
      if (network.chainId !== 8453n) {
        setStatus(`Wrong network. Please switch to Base mainnet (8453). Current: ${network.chainId}`);
        return;
      }
      setStatus("Deploying… confirm in wallet.");
      const factory = new ethers.ContractFactory(ABI, BYTECODE, signer);
      const coordinator = ethers.getAddress(form.coordinator.toLowerCase());
      const treasury = ethers.getAddress(form.treasury.toLowerCase());
      const owner = ethers.getAddress(form.owner.toLowerCase());
      const subId = BigInt(form.subId);

      const deployTx = await factory.getDeployTransaction(
        coordinator,
        subId,
        form.keyHash,
        treasury,
        owner
      );
      // Some RPCs fail to estimate gas for large initcode; set a safe manual limit.
      deployTx.gasLimit = BigInt(form.gasLimit);

      const sent = await signer.sendTransaction(deployTx);
      setStatus(`Submitted: ${sent.hash}\nWaiting for confirmation…`);
      const receipt = await sent.wait();
      const addr = receipt.contractAddress;
      setStatus(
        `Deployed at ${addr}\nTx: ${sent.hash}\nReminder: add this address as a consumer in Chainlink VRF UI.`
      );
    } catch (err) {
      console.error(err);
      setStatus(`Error: ${err.message || err}`);
    }
  };

  return (
    <div className="page">
      <header className="header">
        <div>
          <div className="eyebrow">Gnars Lootbox V1</div>
          <h1>Base VRF Deploy</h1>
          <p className="muted">
            Deploy with your injected wallet. After deploy, add the contract as a consumer in Chainlink VRF.
          </p>
        </div>
        <ConnectButton />
      </header>

      <section className="panel">
        <div className="pill">Base chainId: 8453</div>
        <div className="pill">VRF v2.5 native payment</div>
        <div className="pill warn">Set a valid treasury address</div>
      </section>

        <section className="form">
          <div className="grid">
            <div>
              <label>Lootbox Contract</label>
              <input value={contractAddress} onChange={(e) => setContractAddress(e.target.value)} />
            </div>
          </div>
          <div className="actions">
            <button className="secondary" onClick={readContract}>
              Refresh Readings
            </button>
          </div>
          <div className="readings">
            <div><span>standardPrice</span><strong>{readings.standardPrice ? ethers.formatEther(readings.standardPrice) + " ETH" : "-"}</strong></div>
            <div><span>gnarlyPrice</span><strong>{readings.gnarlyPrice ? ethers.formatEther(readings.gnarlyPrice) + " ETH" : "-"}</strong></div>
            <div><span>epicPrice</span><strong>{readings.epicPrice ? ethers.formatEther(readings.epicPrice) + " ETH" : "-"}</strong></div>
            <div><span>treasury</span><strong>{readings.treasury || "-"}</strong></div>
            <div><span>paused</span><strong>{readings.paused === null ? "-" : readings.paused.toString()}</strong></div>
            <div><span>subscriptionId</span><strong>{readings.subscriptionId ? readings.subscriptionId.toString() : "-"}</strong></div>
            <div><span>keyHash</span><strong>{readings.keyHash || "-"}</strong></div>
            <div><span>coordinator</span><strong>{readings.coordinator || "-"}</strong></div>
          </div>
          <div className="grid">
            <div>
              <label>VRF Coordinator (Base)</label>
              <input name="coordinator" value={form.coordinator} onChange={onChange} />
            </div>
            <div>
              <label>Subscription ID</label>
              <input name="subId" value={form.subId} onChange={onChange} />
            </div>
            <div>
              <label>Key Hash</label>
              <input name="keyHash" value={form.keyHash} onChange={onChange} />
            </div>
            <div>
              <label>Treasury</label>
              <input name="treasury" value={form.treasury} onChange={onChange} placeholder="0x..." />
            </div>
            <div>
              <label>Initial Owner</label>
              <input name="owner" value={form.owner} onChange={onChange} />
            </div>
            <div>
              <label>Gas Limit (deploy)</label>
              <input name="gasLimit" value={form.gasLimit} onChange={onChange} />
            </div>
          </div>
          <div className="actions">
            <button className="primary" disabled={!isConnected || !isReady} onClick={deploy}>
              {isConnected ? "Deploy GnarsLootboxV1" : "Connect wallet first"}
            </button>
            <div className="muted small">
              Connected: {isConnected ? address : "not connected"}
            </div>
          </div>
        </section>

      <section className="form">
        <h2>Open Box</h2>
        <div className="grid">
          <div>
            <label>Box Type</label>
            <select value={openBoxType} onChange={(e) => setOpenBoxType(e.target.value)}>
              <option value="0">Standard</option>
              <option value="1">Gnarly</option>
              <option value="2">Epic</option>
            </select>
          </div>
        </div>
        <div className="actions">
          <button className="primary" disabled={!isConnected} onClick={() => openBox(false)}>
            Open Box (uses on-chain price)
          </button>
          <button className="secondary" disabled={!isConnected} onClick={() => openBox(true)}>
            Force Send (skip static call)
          </button>
        </div>
        <div className="statusBox">
          <div className="label">OpenBox Status</div>
          <pre>{openStatus}</pre>
        </div>
      </section>

      <section className="statusBox">
        <div className="label">Status</div>
        <pre>{status}</pre>
      </section>
      <section className="statusBox">
        <div className="label">Debug Log</div>
        <pre>{debugLog.join("\n")}</pre>
      </section>
    </div>
  );
}

export default App;
